<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: ExecNE.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>ExecNE.C</h1><a href="ExecNE_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright 2008 Lawrence Livermore National Security, LLC */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="sage3basic_8h.html">sage3basic.h</a>"</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">// Added to support RTI support in ROSE (not implemented)</span>
<a name="l00006"></a><a class="code" href="ExecNE_8C.html#a8e12dde9d3bf0b883757d5e4ef3d52f">00006</a> std::ostream &amp; <a class="code" href="Cxx__Grammar_8h.html#db4215b461ab8236ea979e9ab81c61ff">operator&lt;&lt; </a>( std::ostream &amp; os, <span class="keyword">const</span> <a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html">SgAsmNERelocEntry::iref_type</a> &amp; x )
<a name="l00007"></a>00007    {
<a name="l00008"></a>00008      printf (<span class="stringliteral">"Error: operator&lt;&lt; not implemented! \n"</span>);
<a name="l00009"></a>00009      ROSE_ASSERT(<span class="keyword">false</span>);
<a name="l00010"></a>00010 
<a name="l00011"></a>00011      <span class="keywordflow">return</span> os;
<a name="l00012"></a>00012    }
<a name="l00013"></a>00013    
<a name="l00014"></a><a class="code" href="ExecNE_8C.html#526b8e03e48b4c11bc175802780985f4">00014</a> std::ostream &amp; <a class="code" href="Cxx__Grammar_8h.html#db4215b461ab8236ea979e9ab81c61ff">operator&lt;&lt; </a>( std::ostream &amp; os, <span class="keyword">const</span> <a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html">SgAsmNERelocEntry::iord_type</a> &amp; x )
<a name="l00015"></a>00015    {
<a name="l00016"></a>00016      <span class="keywordflow">return</span> os;
<a name="l00017"></a>00017    }
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="ExecNE_8C.html#9ed26ea0309871b8aa72e81b42eb0042">00019</a> std::ostream &amp; <a class="code" href="Cxx__Grammar_8h.html#db4215b461ab8236ea979e9ab81c61ff">operator&lt;&lt; </a>( std::ostream &amp; os, <span class="keyword">const</span> <a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html">SgAsmNERelocEntry::iname_type</a> &amp; x )
<a name="l00020"></a>00020    {
<a name="l00021"></a>00021      <span class="keywordflow">return</span> os;
<a name="l00022"></a>00022    }
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="ExecNE_8C.html#d636631f0b03ce41178f38875ddaa681">00024</a> std::ostream &amp; <a class="code" href="Cxx__Grammar_8h.html#db4215b461ab8236ea979e9ab81c61ff">operator&lt;&lt; </a>( std::ostream &amp; os, <span class="keyword">const</span> <a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html">SgAsmNERelocEntry::osfixup_type</a> &amp; x )
<a name="l00025"></a>00025    {
<a name="l00026"></a>00026      <span class="keywordflow">return</span> os;
<a name="l00027"></a>00027    }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#b4b039bc4aa7ae7b8fd1affea49011f8">00030</a> <a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#b4b039bc4aa7ae7b8fd1affea49011f8">SgAsmNERelocEntry::iref_type::iref_type</a>()
<a name="l00031"></a>00031    {
<a name="l00032"></a>00032      <a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#730170bb99a38d43e594bd420842c09f">sect_idx</a>   = 0;
<a name="l00033"></a>00033      <a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#76255a676fee11019e8d96f49b1b7494">res1</a>       = 0;
<a name="l00034"></a>00034      <a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#7a9322bcdf228e39359bb006c75519bc">tgt_offset</a> = 0;
<a name="l00035"></a>00035    }
<a name="l00036"></a>00036    
<a name="l00037"></a><a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#5c55fda7c5c71f18c98ba02821490789">00037</a> <a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#5c55fda7c5c71f18c98ba02821490789">SgAsmNERelocEntry::iord_type::iord_type</a>()
<a name="l00038"></a>00038    {
<a name="l00039"></a>00039      <a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#eb39b345f35ee585baebc1424a019d90">modref</a>  = 0;
<a name="l00040"></a>00040      <a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#8765ef482a5415f92965f83e9d43d1b9">ordinal</a> = 0;
<a name="l00041"></a>00041      <a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a>  = 0;
<a name="l00042"></a>00042    }
<a name="l00043"></a>00043    
<a name="l00044"></a><a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#2742046aab9ffb997a3498ffccb40cbb">00044</a> <a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#2742046aab9ffb997a3498ffccb40cbb">SgAsmNERelocEntry::iname_type::iname_type</a>()
<a name="l00045"></a>00045    {
<a name="l00046"></a>00046      <a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#440aa60d6c0a8b3d629aa2e8ea590a14">modref</a> = 0;
<a name="l00047"></a>00047      <a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#8c6a10c5a89e0bce3bc648eb6dc8188c">nm_off</a> = 0;
<a name="l00048"></a>00048      <a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a> = 0;
<a name="l00049"></a>00049    }
<a name="l00050"></a>00050    
<a name="l00051"></a><a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1d03738c75a2f89d9a786308bbf707bc">00051</a> <a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1d03738c75a2f89d9a786308bbf707bc">SgAsmNERelocEntry::osfixup_type::osfixup_type</a>()
<a name="l00052"></a>00052    {
<a name="l00053"></a>00053      <a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#6ac941dbd3789b725fbdf7cf68c5213b">type</a> = 0;
<a name="l00054"></a>00054      <a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1c881a17a6afa19971c607a382e77bbb">res3</a> = 0;
<a name="l00055"></a>00055    }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00059"></a>00059 <span class="comment">// NE File Header</span>
<a name="l00061"></a>00061 <span class="comment"></span>    
<a name="l00062"></a>00062 <span class="keywordtype">void</span>
<a name="l00063"></a><a class="code" href="classSgAsmNEFileHeader.html#f5af98eea3962d207d3c28d2c6b3fb40">00063</a> <a class="code" href="classSgAsmGenericHeader.html#8fd18c23683d2162068b30fd26a32fc0">SgAsmNEFileHeader::ctor</a>(<a class="code" href="classSgAsmGenericFile.html">SgAsmGenericFile</a> *f, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(offset);
<a name="l00066"></a>00066     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html">NEFileHeader_disk</a>));
<a name="l00067"></a>00067     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE File Header"</span>));
<a name="l00070"></a>00070     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00071"></a>00071     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073  <span class="comment">// DQ (8/16/2008): Added code to set SgAsmPEFileHeader as parent of input SgAsmGenericFile</span>
<a name="l00074"></a>00074     f-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(<span class="keyword">this</span>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     NEFileHeader_disk fh;
<a name="l00077"></a>00077     <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(0, &amp;fh, <span class="keyword">sizeof</span> fh);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="comment">/* Check magic number early */</span>
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (fh.e_magic[0] != <span class="charliteral">'N'</span> || fh.e_magic[1] != <span class="charliteral">'E'</span>)
<a name="l00081"></a>00081         <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"Bad NE magic number"</span>);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="comment">/* Decode file header */</span>
<a name="l00084"></a>00084     <a class="code" href="classSgAsmNEFileHeader.html#a0b606a841d85218eb7842214e6bc61d">p_e_linker_major</a>         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_linker_major);
<a name="l00085"></a>00085     <a class="code" href="classSgAsmNEFileHeader.html#179e52003605a683bede3a8a8dd4d5fd">p_e_linker_minor</a>         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_linker_minor);
<a name="l00086"></a>00086     <a class="code" href="classSgAsmNEFileHeader.html#44f2d97f1f0e55ed9276f727c32bb5db">p_e_entrytab_rfo</a>         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_entrytab_rfo);
<a name="l00087"></a>00087     <a class="code" href="classSgAsmNEFileHeader.html#2612c13585fb4dae0f14942a59850563">p_e_entrytab_size</a>        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_entrytab_size);
<a name="l00088"></a>00088     <a class="code" href="classSgAsmNEFileHeader.html#91fff3f1d185a396ed3156b9d0174494">p_e_checksum</a>             = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_checksum);
<a name="l00089"></a>00089     <a class="code" href="classSgAsmNEFileHeader.html#c0dea9542ba83777ccdbb2ef579eb74a">p_e_flags1</a>               = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_flags1);
<a name="l00090"></a>00090     <a class="code" href="classSgAsmNEFileHeader.html#50d65a81fc22c8aa0c4f6f13c9622ebb">p_e_autodata_sn</a>          = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_autodata_sn);
<a name="l00091"></a>00091     <a class="code" href="classSgAsmNEFileHeader.html#1efd542a9e6cbe18490ec7b858348ac1">p_e_bss_size</a>             = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_bss_size);
<a name="l00092"></a>00092     <a class="code" href="classSgAsmNEFileHeader.html#905810c3431652434b5924e0436c512d">p_e_stack_size</a>           = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_stack_size);
<a name="l00093"></a>00093     <a class="code" href="classSgAsmNEFileHeader.html#311cff5238d213b67ab3e5c031679293">p_e_csip</a>                 = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_csip);
<a name="l00094"></a>00094     <a class="code" href="classSgAsmNEFileHeader.html#5ae5c3a15a5ffd4f8e98bdcf49327c76">p_e_sssp</a>                 = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_sssp);
<a name="l00095"></a>00095     <a class="code" href="classSgAsmNEFileHeader.html#936f068c5554e01cb477cd61f6fe91a1">p_e_nsections</a>            = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nsections);
<a name="l00096"></a>00096     <a class="code" href="classSgAsmNEFileHeader.html#9a162738d606c4636b8053654fc359c7">p_e_nmodrefs</a>             = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nmodrefs);
<a name="l00097"></a>00097     <a class="code" href="classSgAsmNEFileHeader.html#3f31e7ee4b6d53570ae2b46a3a2491cb">p_e_nnonresnames</a>         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nnonresnames);
<a name="l00098"></a>00098     <a class="code" href="classSgAsmNEFileHeader.html#0dbc49b1fba1c4cc65be50e980542977">p_e_sectab_rfo</a>           = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_sectab_rfo);
<a name="l00099"></a>00099     <a class="code" href="classSgAsmNEFileHeader.html#f7ad1c474d7db1050dc3f5cd3ffa1119">p_e_rsrctab_rfo</a>          = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_rsrctab_rfo);
<a name="l00100"></a>00100     <a class="code" href="classSgAsmNEFileHeader.html#91685321f9bc5ce175b2ee2ad5cfcda4">p_e_resnametab_rfo</a>       = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_resnametab_rfo);
<a name="l00101"></a>00101     <a class="code" href="classSgAsmNEFileHeader.html#2455050c40d652146dfb49d4d802adeb">p_e_modreftab_rfo</a>        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_modreftab_rfo);
<a name="l00102"></a>00102     <a class="code" href="classSgAsmNEFileHeader.html#631c97501ebc513d4d31fecdde44a7c0">p_e_importnametab_rfo</a>    = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_importnametab_rfo);
<a name="l00103"></a>00103     <a class="code" href="classSgAsmNEFileHeader.html#dea723ca2521b359644f82878670bdc3">p_e_nonresnametab_offset</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nonresnametab_offset);
<a name="l00104"></a>00104     <a class="code" href="classSgAsmNEFileHeader.html#85e9ec19a1bc4aad11c84a600d1521b8">p_e_nmovable_entries</a>     = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nmovable_entries);
<a name="l00105"></a>00105     <a class="code" href="classSgAsmNEFileHeader.html#fdd0804b19333689fa9929f5331fa315">p_e_sector_align</a>         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_sector_align);
<a name="l00106"></a>00106     <a class="code" href="classSgAsmNEFileHeader.html#a5cb27a6adfcf2d1b497f69d8a72db64">p_e_nresources</a>           = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_nresources);
<a name="l00107"></a>00107     <a class="code" href="classSgAsmNEFileHeader.html#bd6f0a2c205ff3f0fc274d0b75ba9824">p_e_exetype</a>              = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_exetype);
<a name="l00108"></a>00108     <a class="code" href="classSgAsmNEFileHeader.html#98af7359d1b4a017a09035315fec873c">p_e_flags2</a>               = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_flags2); 
<a name="l00109"></a>00109     <a class="code" href="classSgAsmNEFileHeader.html#822e6aab6b36db902758bd7019059d26">p_e_fastload_sector</a>      = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_fastload_sector);
<a name="l00110"></a>00110     <a class="code" href="classSgAsmNEFileHeader.html#5e976e3dc37b822f641f8443f7d15caf">p_e_fastload_nsectors</a>    = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_fastload_nsectors);
<a name="l00111"></a>00111     <a class="code" href="classSgAsmNEFileHeader.html#6c50ce109f97c618fe407d3c7c810819">p_e_res1</a>                 = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_res1);
<a name="l00112"></a>00112     <a class="code" href="classSgAsmNEFileHeader.html#cffe8889a847ea774929db3cb5449064">p_e_winvers</a>              = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(fh.e_winvers);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="comment">/* Magic number */</span>
<a name="l00115"></a>00115     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <span class="keyword">sizeof</span>(fh.e_magic); ++i)
<a name="l00116"></a>00116         <a class="code" href="classSgAsmGenericHeader.html#fc5d1866f72ecd33566a749ffa8d44ac">p_magic</a>.push_back(fh.e_magic[i]);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">/* File format */</span>
<a name="l00119"></a>00119     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#bdd67d98afed0bc8d6ecd4530e352faa">set_family</a>( <a class="code" href="classSgAsmExecutableFileFormat.html#a4a1858391921731cd54cf531fcfa65d511d3b87524cd2707b487b55ac11b21b">FAMILY_NE</a> );
<a name="l00120"></a>00120     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#3c56f9b0b777a7f6ad2493ec8858d105">set_purpose</a>( <a class="code" href="classSgAsmNEFileHeader.html#c0dea9542ba83777ccdbb2ef579eb74a">p_e_flags1</a> &amp; <a class="code" href="classSgAsmNEFileHeader.html#2b8152385617cf122867021bbf94fa935246374601d0690206c19ceb1bb3c5ec">HF1_LIBRARY</a> ? <a class="code" href="classSgAsmExecutableFileFormat.html#27fc70e134433bff16d86749ed5c732ad7e3c4a113111aaaa3e777fc34b8695d">PURPOSE_LIBRARY</a> : <a class="code" href="classSgAsmExecutableFileFormat.html#27fc70e134433bff16d86749ed5c732a5cc69aef26eb1c6f0c09d2fe5d26bbec">PURPOSE_EXECUTABLE</a> );
<a name="l00121"></a>00121     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#ade4f17f6e9e885f2e187e1ca21fe48c">set_sex</a>( <a class="code" href="classSgAsmExecutableFileFormat.html#9f34e9e7666815ddeee9be5df5573a8091735fb4441f9caf9effbd171df1bf76">ORDER_LSB</a> );
<a name="l00122"></a>00122     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#5de00f845013202fcd9e9ad23abb6118">set_abi</a>( <a class="code" href="classSgAsmExecutableFileFormat.html#8624b5b893e68f75dceec02588a4cd17cf377c6370ef00694e9936f91c454527">ABI_NT</a> );
<a name="l00123"></a>00123     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#427cbeb1efb90a0c1300289357cde79e">set_abi_version</a>( 0 );
<a name="l00124"></a>00124     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#a8e3c59a6cbf21cc680b565e47f2284f">set_word_size</a>( 2 );
<a name="l00125"></a>00125     ROSE_ASSERT(<a class="code" href="classSgAsmNEFileHeader.html#a0b606a841d85218eb7842214e6bc61d">p_e_linker_major</a> &lt;= 0xff &amp;&amp; <a class="code" href="classSgAsmNEFileHeader.html#179e52003605a683bede3a8a8dd4d5fd">p_e_linker_minor</a> &lt;= 0xff);
<a name="l00126"></a>00126     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#05e0fc79c01ac29ef161ff48703cad49">set_version</a>( (<a class="code" href="classSgAsmNEFileHeader.html#a0b606a841d85218eb7842214e6bc61d">p_e_linker_major</a>&lt;&lt;8) | <a class="code" href="classSgAsmNEFileHeader.html#179e52003605a683bede3a8a8dd4d5fd">p_e_linker_minor</a> );
<a name="l00127"></a>00127     <a class="code" href="classSgAsmGenericHeader.html#d5604947cfe0f8295c4e17c184f9e153">p_exec_format</a>-&gt;<a class="code" href="classSgAsmGenericFormat.html#daee8324a5e214825f81b1724fbf3a50">set_is_current_version</a>( <span class="keyword">true</span> ); <span class="comment">/*FIXME*/</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="comment">/* Target architecture */</span>
<a name="l00130"></a>00130     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNEFileHeader.html#bd6f0a2c205ff3f0fc274d0b75ba9824">p_e_exetype</a>) {
<a name="l00131"></a>00131       <span class="keywordflow">case</span> 0:
<a name="l00132"></a>00132         <a class="code" href="classSgAsmGenericHeader.html#409833992bfb436254333293383af434">set_isa</a>(<a class="code" href="classSgAsmExecutableFileFormat.html#e83545a0f1393e82be1225c168ba5224061502eb9ac07accd0def0e21645d692">ISA_UNSPECIFIED</a>);
<a name="l00133"></a>00133         <span class="keywordflow">break</span>;
<a name="l00134"></a>00134       <span class="keywordflow">case</span> 1:
<a name="l00135"></a>00135         <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"use of reserved value for Windows NE header e_exetype"</span>);
<a name="l00136"></a>00136       <span class="keywordflow">case</span> 2:
<a name="l00137"></a>00137         <a class="code" href="classSgAsmGenericHeader.html#409833992bfb436254333293383af434">set_isa</a>(<a class="code" href="classSgAsmExecutableFileFormat.html#e83545a0f1393e82be1225c168ba52248d1f60a24fc227948a5cb39299408255">ISA_IA32_386</a>);
<a name="l00138"></a>00138         <span class="keywordflow">break</span>;
<a name="l00139"></a>00139       <span class="keywordflow">case</span> 3:
<a name="l00140"></a>00140       <span class="keywordflow">case</span> 4:
<a name="l00141"></a>00141         <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"use of reserved value for Windows NE header e_exetype"</span>);
<a name="l00142"></a>00142       <span class="keywordflow">default</span>:
<a name="l00143"></a>00143         <a class="code" href="classSgAsmGenericHeader.html#409833992bfb436254333293383af434">set_isa</a>(<a class="code" href="classSgAsmExecutableFileFormat.html#e83545a0f1393e82be1225c168ba522478cd05aac8651d850b331dd1fd399dc0">ISA_OTHER</a>);
<a name="l00144"></a>00144         <span class="keywordflow">break</span>;
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">/* Entry point */</span>
<a name="l00148"></a>00148 <span class="comment">//    entry_rva = e_entrypoint_rva; /*FIXME*/</span>
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00154"></a>00154 <span class="keywordtype">bool</span>
<a name="l00155"></a><a class="code" href="classSgAsmNEFileHeader.html#560ac9a565d9b981e9cf274c5ed8b2cb">00155</a> <a class="code" href="classSgAsmNEFileHeader.html#560ac9a565d9b981e9cf274c5ed8b2cb">SgAsmNEFileHeader::is_NE</a>(<a class="code" href="classSgAsmGenericFile.html">SgAsmGenericFile</a> *file)
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157     <span class="comment">/* Turn off byte reference tracking for the duration of this function. We don't want our testing the file contents to</span>
<a name="l00158"></a>00158 <span class="comment">     * affect the list of bytes that we've already referenced or which we might reference later. */</span>
<a name="l00159"></a>00159     <span class="keywordtype">bool</span> was_tracking = file-&gt;<a class="code" href="classSgAsmGenericFile.html#840f5e7a6c331a12ec572be161e3fb92">get_tracking_references</a>();
<a name="l00160"></a>00160     file-&gt;<a class="code" href="classSgAsmGenericFile.html#726172a6521dd95a9e8f7015eab98d93">set_tracking_references</a>(<span class="keyword">false</span>);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">try</span> {
<a name="l00163"></a>00163         <span class="comment">/* Check DOS File Header magic number at beginning of the file */</span>
<a name="l00164"></a>00164         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dos_magic[2];
<a name="l00165"></a>00165         file-&gt;<a class="code" href="classSgAsmGenericFile.html#6a3034de86aa77155a720eb6aa636a64">read_content</a>(0, dos_magic, <span class="keyword">sizeof</span> dos_magic);
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (<span class="charliteral">'M'</span>!=dos_magic[0] || <span class="charliteral">'Z'</span>!=dos_magic[1])
<a name="l00167"></a>00167             <span class="keywordflow">throw</span> 1;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="comment">/* Read four-byte offset of potential PE File Header at offset 0x3c */</span>
<a name="l00170"></a>00170         uint32_t lfanew_disk;
<a name="l00171"></a>00171         file-&gt;<a class="code" href="classSgAsmGenericFile.html#6a3034de86aa77155a720eb6aa636a64">read_content</a>(0x3c, &amp;lfanew_disk, <span class="keyword">sizeof</span> lfanew_disk);
<a name="l00172"></a>00172         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> ne_offset = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(lfanew_disk);
<a name="l00173"></a>00173         
<a name="l00174"></a>00174         <span class="comment">/* Look for the NE File Header magic number */</span>
<a name="l00175"></a>00175         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ne_magic[2];
<a name="l00176"></a>00176         file-&gt;<a class="code" href="classSgAsmGenericFile.html#6a3034de86aa77155a720eb6aa636a64">read_content</a>(ne_offset, ne_magic, <span class="keyword">sizeof</span> ne_magic);
<a name="l00177"></a>00177         <span class="keywordflow">if</span> (<span class="charliteral">'N'</span>!=ne_magic[0] || <span class="charliteral">'E'</span>!=ne_magic[1])
<a name="l00178"></a>00178             <span class="keywordflow">throw</span> 1;
<a name="l00179"></a>00179     } <span class="keywordflow">catch</span> (...) {
<a name="l00180"></a>00180         file-&gt;<a class="code" href="classSgAsmGenericFile.html#726172a6521dd95a9e8f7015eab98d93">set_tracking_references</a>(was_tracking);
<a name="l00181"></a>00181         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183     
<a name="l00184"></a>00184     file-&gt;<a class="code" href="classSgAsmGenericFile.html#726172a6521dd95a9e8f7015eab98d93">set_tracking_references</a>(was_tracking);
<a name="l00185"></a>00185     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">/* Encode the NE header into disk format */</span>
<a name="l00189"></a>00189 <span class="keywordtype">void</span> *
<a name="l00190"></a><a class="code" href="classSgAsmNEFileHeader.html#5469b4803308847aa1ac1d902e935c83">00190</a> <a class="code" href="classSgAsmNEFileHeader.html#5469b4803308847aa1ac1d902e935c83">SgAsmNEFileHeader::encode</a>(<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html">SgAsmNEFileHeader::NEFileHeader_disk</a> *disk)<span class="keyword"> const</span>
<a name="l00191"></a>00191 <span class="keyword"></span>{
<a name="l00192"></a>00192     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="Cxx__Grammar_8h.html#bd4cc535ac947fbfc75e7feb7dd9b948">NELMTS</a>(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#15a286e06e5ff97f91c8ee9f716e7f03">e_magic</a>); i++)
<a name="l00193"></a>00193         disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#15a286e06e5ff97f91c8ee9f716e7f03">e_magic</a>[i] = <a class="code" href="classSgAsmGenericHeader.html#27807563d01fe7bb516fa28db6e4839f">get_magic</a>()[i];
<a name="l00194"></a>00194     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#a0b606a841d85218eb7842214e6bc61d">p_e_linker_major</a>,         &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#e1337abac3b73c53f8d9afa8d44dc207">e_linker_major</a>));
<a name="l00195"></a>00195     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#179e52003605a683bede3a8a8dd4d5fd">p_e_linker_minor</a>,         &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#933a455cc7d6a81e32b7ce05626283dd">e_linker_minor</a>));
<a name="l00196"></a>00196     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#44f2d97f1f0e55ed9276f727c32bb5db">p_e_entrytab_rfo</a>,         &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#1bfa9d2bf20b19a3f328526e2c4537ff">e_entrytab_rfo</a>));
<a name="l00197"></a>00197     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#2612c13585fb4dae0f14942a59850563">p_e_entrytab_size</a>,        &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#1b932552be697ff4ad1e716ffae532d4">e_entrytab_size</a>));
<a name="l00198"></a>00198     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#91fff3f1d185a396ed3156b9d0174494">p_e_checksum</a>,             &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#fdbce76e6286b0d1c8b4d1f5210af79c">e_checksum</a>));
<a name="l00199"></a>00199     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#c0dea9542ba83777ccdbb2ef579eb74a">p_e_flags1</a>,               &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#4fa78ba2e95c61d4514c902136e7bdc2">e_flags1</a>));
<a name="l00200"></a>00200     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#50d65a81fc22c8aa0c4f6f13c9622ebb">p_e_autodata_sn</a>,          &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#8cc76173efe40e0e8751477c92978898">e_autodata_sn</a>));
<a name="l00201"></a>00201     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#1efd542a9e6cbe18490ec7b858348ac1">p_e_bss_size</a>,             &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#dcba00cdcf66180fca9324ce82e16877">e_bss_size</a>));
<a name="l00202"></a>00202     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#905810c3431652434b5924e0436c512d">p_e_stack_size</a>,           &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#cbe2300e4a23597aa6e7f934c2939a2a">e_stack_size</a>));
<a name="l00203"></a>00203     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#311cff5238d213b67ab3e5c031679293">p_e_csip</a>,                 &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#fd60c7c97141b674df89c626527668ef">e_csip</a>));
<a name="l00204"></a>00204     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#5ae5c3a15a5ffd4f8e98bdcf49327c76">p_e_sssp</a>,                 &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#92974eeb54fcfbcc63ebf63686404cf6">e_sssp</a>));
<a name="l00205"></a>00205     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#936f068c5554e01cb477cd61f6fe91a1">p_e_nsections</a>,            &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#63c160a75fd50764b22a43230932d04d">e_nsections</a>));
<a name="l00206"></a>00206     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#9a162738d606c4636b8053654fc359c7">p_e_nmodrefs</a>,             &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#58102af0678039a61fba825dad183413">e_nmodrefs</a>));
<a name="l00207"></a>00207     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#3f31e7ee4b6d53570ae2b46a3a2491cb">p_e_nnonresnames</a>,         &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#640b37a257bd6843442a27e2cba5f915">e_nnonresnames</a>));
<a name="l00208"></a>00208     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#0dbc49b1fba1c4cc65be50e980542977">p_e_sectab_rfo</a>,           &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#afea5d84e08fa0dbba51b445904d9edd">e_sectab_rfo</a>));
<a name="l00209"></a>00209     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#f7ad1c474d7db1050dc3f5cd3ffa1119">p_e_rsrctab_rfo</a>,          &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#080b79acc4a2675f205b1d506fc1dd77">e_rsrctab_rfo</a>));
<a name="l00210"></a>00210     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#91685321f9bc5ce175b2ee2ad5cfcda4">p_e_resnametab_rfo</a>,       &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#818a4f73c6489021fd23c1390c7a0c64">e_resnametab_rfo</a>));
<a name="l00211"></a>00211     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#2455050c40d652146dfb49d4d802adeb">p_e_modreftab_rfo</a>,        &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#e1950c5aa152b2f943dc8c5503703109">e_modreftab_rfo</a>));
<a name="l00212"></a>00212     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#631c97501ebc513d4d31fecdde44a7c0">p_e_importnametab_rfo</a>,    &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#e2c0ae4f3184daf559e494117eef5fc6">e_importnametab_rfo</a>));
<a name="l00213"></a>00213     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#dea723ca2521b359644f82878670bdc3">p_e_nonresnametab_offset</a>, &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#cbe926cec37de25fea9228ba6ada2119">e_nonresnametab_offset</a>));
<a name="l00214"></a>00214     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#85e9ec19a1bc4aad11c84a600d1521b8">p_e_nmovable_entries</a>,     &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#f86fcfaa7279dcc54cefcf5bf821aa6f">e_nmovable_entries</a>));
<a name="l00215"></a>00215     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#fdd0804b19333689fa9929f5331fa315">p_e_sector_align</a>,         &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#866598af28ac2348a7c2fc2791d8be7e">e_sector_align</a>));
<a name="l00216"></a>00216     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#a5cb27a6adfcf2d1b497f69d8a72db64">p_e_nresources</a>,           &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#bd7ed8d4d3597f55e9726c2f48b969f7">e_nresources</a>));
<a name="l00217"></a>00217     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#bd6f0a2c205ff3f0fc274d0b75ba9824">p_e_exetype</a>,              &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#e5684408a127463ec3fa629cde072699">e_exetype</a>));
<a name="l00218"></a>00218     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#98af7359d1b4a017a09035315fec873c">p_e_flags2</a>,               &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#38309f6b9f0dc4abf0611675785f902a">e_flags2</a>));
<a name="l00219"></a>00219     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#822e6aab6b36db902758bd7019059d26">p_e_fastload_sector</a>,      &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#059cf3e395023c48652b8432aff86c8a">e_fastload_sector</a>));
<a name="l00220"></a>00220     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#5e976e3dc37b822f641f8443f7d15caf">p_e_fastload_nsectors</a>,    &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#6a2d8148300c29521551afba731ee525">e_fastload_nsectors</a>));
<a name="l00221"></a>00221     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#6c50ce109f97c618fe407d3c7c810819">p_e_res1</a>,                 &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#efc8d886949c0620d2ac255468e6c6ec">e_res1</a>));
<a name="l00222"></a>00222     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEFileHeader.html#cffe8889a847ea774929db3cb5449064">p_e_winvers</a>,              &amp;(disk-&gt;<a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html#679e4b035293e78095d6cd2f7740aa4a">e_winvers</a>));
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">return</span> disk;
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">/* Write the NE file header back to disk and all that it references */</span>
<a name="l00228"></a>00228 <span class="keywordtype">void</span>
<a name="l00229"></a><a class="code" href="classSgAsmNEFileHeader.html#359c6f647bf2338170eeea5b6be8fe37">00229</a> <a class="code" href="classSgAsmNEFileHeader.html#359c6f647bf2338170eeea5b6be8fe37">SgAsmNEFileHeader::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00230"></a>00230 <span class="keyword"></span>{
<a name="l00231"></a>00231     <a class="code" href="structSgAsmNEFileHeader_1_1NEFileHeader__disk.html">NEFileHeader_disk</a> fh;
<a name="l00232"></a>00232     <a class="code" href="classSgAsmNEFileHeader.html#5469b4803308847aa1ac1d902e935c83">encode</a>(&amp;fh);
<a name="l00233"></a>00233     <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, 0, <span class="keyword">sizeof</span> fh, &amp;fh);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="comment">/* The extended DOS header */</span>
<a name="l00236"></a>00236     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#768d80e6af76b794618fb516a1f12ac8">p_dos2_header</a>)
<a name="l00237"></a>00237         <a class="code" href="classSgAsmNEFileHeader.html#768d80e6af76b794618fb516a1f12ac8">p_dos2_header</a>-&gt;<a class="code" href="classSgAsmDOSExtendedHeader.html#350c2976619b2065a2c076200568a11b">unparse</a>(f);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">/* The section table and all the non-synthesized sections */</span>
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#dd0452312f6873100175c838b2f9c091">p_section_table</a>)
<a name="l00241"></a>00241         <a class="code" href="classSgAsmNEFileHeader.html#dd0452312f6873100175c838b2f9c091">p_section_table</a>-&gt;<a class="code" href="classSgAsmNESectionTable.html#8f473ac455881caada223c280a497903">unparse</a>(f);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">/* Sections defined in the NE file header */</span>
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#3934ab64d1a45aa5f4666c1b5d14249e">p_resname_table</a>)
<a name="l00245"></a>00245         <a class="code" href="classSgAsmNEFileHeader.html#3934ab64d1a45aa5f4666c1b5d14249e">p_resname_table</a>-&gt;<a class="code" href="classSgAsmNENameTable.html#1d6abb67923937bd41779b06f2eafe41">unparse</a>(f);
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#211e006b7232820fbf529f1065ab4bea">p_nonresname_table</a>)
<a name="l00247"></a>00247         <a class="code" href="classSgAsmNEFileHeader.html#211e006b7232820fbf529f1065ab4bea">p_nonresname_table</a>-&gt;<a class="code" href="classSgAsmNENameTable.html#1d6abb67923937bd41779b06f2eafe41">unparse</a>(f);
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#8e85fec41bc494065bba52f0e080b532">p_module_table</a>)
<a name="l00249"></a>00249         <a class="code" href="classSgAsmNEFileHeader.html#8e85fec41bc494065bba52f0e080b532">p_module_table</a>-&gt;<a class="code" href="classSgAsmNEModuleTable.html#131008145b95a1f9917527afcf84ab18">unparse</a>(f);
<a name="l00250"></a>00250     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#b46b12e3e79080132ce97065eae3e936">p_entry_table</a>)
<a name="l00251"></a>00251         <a class="code" href="classSgAsmNEFileHeader.html#b46b12e3e79080132ce97065eae3e936">p_entry_table</a>-&gt;<a class="code" href="classSgAsmNEEntryTable.html#6a254cfd3aa5e61a77d4bc7181dd726b">unparse</a>(f);
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253     
<a name="l00254"></a>00254 <span class="comment">/* Print some debugging information */</span>
<a name="l00255"></a>00255 <span class="keywordtype">void</span>
<a name="l00256"></a><a class="code" href="classSgAsmNEFileHeader.html#dfec491c68a10325e14639316aa1d4e2">00256</a> <a class="code" href="classSgAsmNEFileHeader.html#dfec491c68a10325e14639316aa1d4e2">SgAsmNEFileHeader::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00257"></a>00257 <span class="keyword"></span>{
<a name="l00258"></a>00258     <span class="keywordtype">char</span> p[4096];
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00260"></a>00260         sprintf(p, <span class="stringliteral">"%sNEFileHeader[%zd]."</span>, prefix, idx);
<a name="l00261"></a>00261     } <span class="keywordflow">else</span> {
<a name="l00262"></a>00262         sprintf(p, <span class="stringliteral">"%sNEFileHeader."</span>, prefix);
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <a class="code" href="classSgAsmGenericHeader.html#4937a32d872d6ddb77ca5b0ba695f676">SgAsmGenericHeader::dump</a>(f, p, -1);
<a name="l00268"></a>00268     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_linker_major"</span>,         <a class="code" href="classSgAsmNEFileHeader.html#a0b606a841d85218eb7842214e6bc61d">p_e_linker_major</a>);
<a name="l00269"></a>00269     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_linker_minor"</span>,         <a class="code" href="classSgAsmNEFileHeader.html#179e52003605a683bede3a8a8dd4d5fd">p_e_linker_minor</a>);
<a name="l00270"></a>00270     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_entrytab_rfo"</span>,      
<a name="l00271"></a>00271                                                        <a class="code" href="classSgAsmNEFileHeader.html#44f2d97f1f0e55ed9276f727c32bb5db">p_e_entrytab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#44f2d97f1f0e55ed9276f727c32bb5db">p_e_entrytab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00272"></a>00272     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" bytes\n"</span>,           p, w, <span class="stringliteral">"e_entrytab_size"</span>,        <a class="code" href="classSgAsmNEFileHeader.html#2612c13585fb4dae0f14942a59850563">p_e_entrytab_size</a>);
<a name="l00273"></a>00273     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08x\n"</span>,                    p, w, <span class="stringliteral">"e_checksum"</span>,             <a class="code" href="classSgAsmNEFileHeader.html#91fff3f1d185a396ed3156b9d0174494">p_e_checksum</a>);
<a name="l00274"></a>00274     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>,                    p, w, <span class="stringliteral">"e_flags1"</span>,               <a class="code" href="classSgAsmNEFileHeader.html#c0dea9542ba83777ccdbb2ef579eb74a">p_e_flags1</a>);
<a name="l00275"></a>00275     fprintf(f, <span class="stringliteral">"%s%-*s = %u (1-origin)\n"</span>,             p, w, <span class="stringliteral">"e_autodata_sn"</span>,          <a class="code" href="classSgAsmNEFileHeader.html#50d65a81fc22c8aa0c4f6f13c9622ebb">p_e_autodata_sn</a>);
<a name="l00276"></a>00276     fprintf(f, <span class="stringliteral">"%s%-*s = %u bytes\n"</span>,                  p, w, <span class="stringliteral">"e_bss_size"</span>,             <a class="code" href="classSgAsmNEFileHeader.html#1efd542a9e6cbe18490ec7b858348ac1">p_e_bss_size</a>);
<a name="l00277"></a>00277     fprintf(f, <span class="stringliteral">"%s%-*s = %u bytes\n"</span>,                  p, w, <span class="stringliteral">"e_stack_size"</span>,           <a class="code" href="classSgAsmNEFileHeader.html#905810c3431652434b5924e0436c512d">p_e_stack_size</a>);
<a name="l00278"></a>00278     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08x\n"</span>,                    p, w, <span class="stringliteral">"e_csip"</span>,                 <a class="code" href="classSgAsmNEFileHeader.html#311cff5238d213b67ab3e5c031679293">p_e_csip</a>);
<a name="l00279"></a>00279     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08x\n"</span>,                    p, w, <span class="stringliteral">"e_sssp"</span>,                 <a class="code" href="classSgAsmNEFileHeader.html#5ae5c3a15a5ffd4f8e98bdcf49327c76">p_e_sssp</a>);
<a name="l00280"></a>00280     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_nsections"</span>,            <a class="code" href="classSgAsmNEFileHeader.html#936f068c5554e01cb477cd61f6fe91a1">p_e_nsections</a>);
<a name="l00281"></a>00281     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_nmodrefs"</span>,             <a class="code" href="classSgAsmNEFileHeader.html#9a162738d606c4636b8053654fc359c7">p_e_nmodrefs</a>);
<a name="l00282"></a>00282     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_nnonresnames"</span>,         <a class="code" href="classSgAsmNEFileHeader.html#3f31e7ee4b6d53570ae2b46a3a2491cb">p_e_nnonresnames</a>);
<a name="l00283"></a>00283     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_sectab_rfo"</span>,           
<a name="l00284"></a>00284                                                        <a class="code" href="classSgAsmNEFileHeader.html#0dbc49b1fba1c4cc65be50e980542977">p_e_sectab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#0dbc49b1fba1c4cc65be50e980542977">p_e_sectab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00285"></a>00285     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_rsrctab_rfo"</span>,
<a name="l00286"></a>00286                                                        <a class="code" href="classSgAsmNEFileHeader.html#f7ad1c474d7db1050dc3f5cd3ffa1119">p_e_rsrctab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#f7ad1c474d7db1050dc3f5cd3ffa1119">p_e_rsrctab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00287"></a>00287     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_resnametab_rfo"</span>,
<a name="l00288"></a>00288                                                        <a class="code" href="classSgAsmNEFileHeader.html#91685321f9bc5ce175b2ee2ad5cfcda4">p_e_resnametab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#91685321f9bc5ce175b2ee2ad5cfcda4">p_e_resnametab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00289"></a>00289     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_modreftab_rfo"</span>,
<a name="l00290"></a>00290                                                        <a class="code" href="classSgAsmNEFileHeader.html#2455050c40d652146dfb49d4d802adeb">p_e_modreftab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#2455050c40d652146dfb49d4d802adeb">p_e_modreftab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00291"></a>00291     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" abs)\n"</span>, p, w, <span class="stringliteral">"e_importnametab_rfo"</span>,
<a name="l00292"></a>00292                                                        <a class="code" href="classSgAsmNEFileHeader.html#631c97501ebc513d4d31fecdde44a7c0">p_e_importnametab_rfo</a>, <a class="code" href="classSgAsmNEFileHeader.html#631c97501ebc513d4d31fecdde44a7c0">p_e_importnametab_rfo</a>+<a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l00293"></a>00293     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" byte offset\n"</span>,     p, w, <span class="stringliteral">"e_nonresnametab_offset"</span>, <a class="code" href="classSgAsmNEFileHeader.html#dea723ca2521b359644f82878670bdc3">p_e_nonresnametab_offset</a>);
<a name="l00294"></a>00294     fprintf(f, <span class="stringliteral">"%s%-*s = %u entries\n"</span>,                p, w, <span class="stringliteral">"e_nmovable_entries"</span>,     <a class="code" href="classSgAsmNEFileHeader.html#85e9ec19a1bc4aad11c84a600d1521b8">p_e_nmovable_entries</a>);
<a name="l00295"></a>00295     fprintf(f, <span class="stringliteral">"%s%-*s = %u (log2)\n"</span>,                 p, w, <span class="stringliteral">"e_sector_align"</span>,         <a class="code" href="classSgAsmNEFileHeader.html#fdd0804b19333689fa9929f5331fa315">p_e_sector_align</a>);
<a name="l00296"></a>00296     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_nresources"</span>,           <a class="code" href="classSgAsmNEFileHeader.html#a5cb27a6adfcf2d1b497f69d8a72db64">p_e_nresources</a>);
<a name="l00297"></a>00297     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,                        p, w, <span class="stringliteral">"e_exetype"</span>,              <a class="code" href="classSgAsmNEFileHeader.html#bd6f0a2c205ff3f0fc274d0b75ba9824">p_e_exetype</a>);
<a name="l00298"></a>00298     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%02x\n"</span>,                    p, w, <span class="stringliteral">"e_flags2"</span>,               <a class="code" href="classSgAsmNEFileHeader.html#98af7359d1b4a017a09035315fec873c">p_e_flags2</a>);
<a name="l00299"></a>00299     fprintf(f, <span class="stringliteral">"%s%-*s = sector %"</span>PRIu64<span class="stringliteral">"\n"</span>,          p, w, <span class="stringliteral">"e_fastload_sector"</span>,      <a class="code" href="classSgAsmNEFileHeader.html#822e6aab6b36db902758bd7019059d26">p_e_fastload_sector</a>); 
<a name="l00300"></a>00300     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" sectors\n"</span>,         p, w, <span class="stringliteral">"e_fastload_nsectors"</span>,    <a class="code" href="classSgAsmNEFileHeader.html#5e976e3dc37b822f641f8443f7d15caf">p_e_fastload_nsectors</a>); 
<a name="l00301"></a>00301     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>,                    p, w, <span class="stringliteral">"e_res1"</span>,                 <a class="code" href="classSgAsmNEFileHeader.html#6c50ce109f97c618fe407d3c7c810819">p_e_res1</a>);
<a name="l00302"></a>00302     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>,                    p, w, <span class="stringliteral">"e_winvers"</span>,              <a class="code" href="classSgAsmNEFileHeader.html#cffe8889a847ea774929db3cb5449064">p_e_winvers</a>);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#768d80e6af76b794618fb516a1f12ac8">p_dos2_header</a>) {
<a name="l00305"></a>00305         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"dos2_header"</span>,
<a name="l00306"></a>00306                 <a class="code" href="classSgAsmNEFileHeader.html#768d80e6af76b794618fb516a1f12ac8">p_dos2_header</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#768d80e6af76b794618fb516a1f12ac8">p_dos2_header</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00307"></a>00307     } <span class="keywordflow">else</span> {
<a name="l00308"></a>00308         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"dos2_header"</span>);
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#dd0452312f6873100175c838b2f9c091">p_section_table</a>) {
<a name="l00311"></a>00311         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"section_table"</span>,
<a name="l00312"></a>00312                 <a class="code" href="classSgAsmNEFileHeader.html#dd0452312f6873100175c838b2f9c091">p_section_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#dd0452312f6873100175c838b2f9c091">p_section_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00313"></a>00313     } <span class="keywordflow">else</span> {
<a name="l00314"></a>00314         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"section_table"</span>);
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#3934ab64d1a45aa5f4666c1b5d14249e">p_resname_table</a>) {
<a name="l00317"></a>00317         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"resname_table"</span>,
<a name="l00318"></a>00318                 <a class="code" href="classSgAsmNEFileHeader.html#3934ab64d1a45aa5f4666c1b5d14249e">p_resname_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#3934ab64d1a45aa5f4666c1b5d14249e">p_resname_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00319"></a>00319     } <span class="keywordflow">else</span> {
<a name="l00320"></a>00320         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"resname_table"</span>);
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#211e006b7232820fbf529f1065ab4bea">p_nonresname_table</a>) {
<a name="l00323"></a>00323         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"nonresname_table"</span>,
<a name="l00324"></a>00324                 <a class="code" href="classSgAsmNEFileHeader.html#211e006b7232820fbf529f1065ab4bea">p_nonresname_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#211e006b7232820fbf529f1065ab4bea">p_nonresname_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00325"></a>00325     } <span class="keywordflow">else</span> {
<a name="l00326"></a>00326         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"nonresname_table"</span>);
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#8e85fec41bc494065bba52f0e080b532">p_module_table</a>) {
<a name="l00329"></a>00329         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"module_table"</span>,
<a name="l00330"></a>00330                 <a class="code" href="classSgAsmNEFileHeader.html#8e85fec41bc494065bba52f0e080b532">p_module_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#8e85fec41bc494065bba52f0e080b532">p_module_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00331"></a>00331     } <span class="keywordflow">else</span> {
<a name="l00332"></a>00332         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"module_table"</span>);
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEFileHeader.html#b46b12e3e79080132ce97065eae3e936">p_entry_table</a>) {
<a name="l00335"></a>00335         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"entry_table"</span>,
<a name="l00336"></a>00336                 <a class="code" href="classSgAsmNEFileHeader.html#b46b12e3e79080132ce97065eae3e936">p_entry_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEFileHeader.html#b46b12e3e79080132ce97065eae3e936">p_entry_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00337"></a>00337     } <span class="keywordflow">else</span> {
<a name="l00338"></a>00338         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"entry_table"</span>);
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 
<a name="l00343"></a>00343 <span class="comment">// NE Section Table</span>
<a name="l00345"></a>00345 <span class="comment"></span>
<a name="l00346"></a>00346 <span class="keywordtype">void</span>
<a name="l00347"></a><a class="code" href="classSgAsmNESectionTableEntry.html#f7b82c03cff82e0ebe092db181a6ba6a">00347</a> <a class="code" href="classSgAsmNESectionTableEntry.html#f7b82c03cff82e0ebe092db181a6ba6a">SgAsmNESectionTableEntry::ctor</a>(<span class="keyword">const</span> <a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">NESectionTableEntry_disk</a> *disk)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     <a class="code" href="classSgAsmNESectionTableEntry.html#38726d8ad628e65d3321a1fccc749eb0">p_sector</a>          = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#17caa0b3ad84955ad38521140bb4b369">sector</a>);
<a name="l00350"></a>00350     <a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a>   = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#12ba8169b46f5ab2ed90e6c36f590319">physical_size</a>);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (0==<a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a> &amp;&amp; <a class="code" href="classSgAsmNESectionTableEntry.html#38726d8ad628e65d3321a1fccc749eb0">p_sector</a>!=0) <a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a> = 64*1024;
<a name="l00352"></a>00352     <a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a>           = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#6bf89ebee3af0814db501593bd0a2fb8">flags</a>);
<a name="l00353"></a>00353     <a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a>    = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#d43ef445ecb488e51f10b42374641219">virtual_size</a>);
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (0==<a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a>) <a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a> = 64*1024;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">/* Encodes a section table entry back into disk format. */</span>
<a name="l00358"></a>00358 <span class="keywordtype">void</span> *
<a name="l00359"></a><a class="code" href="classSgAsmNESectionTableEntry.html#dc8491162978cf8c3d1b8f6e1b12c0bd">00359</a> <a class="code" href="classSgAsmNESectionTableEntry.html#dc8491162978cf8c3d1b8f6e1b12c0bd">SgAsmNESectionTableEntry::encode</a>(<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">NESectionTableEntry_disk</a> *disk)<span class="keyword"> const</span>
<a name="l00360"></a>00360 <span class="keyword"></span>{
<a name="l00361"></a>00361     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNESectionTableEntry.html#38726d8ad628e65d3321a1fccc749eb0">p_sector</a>,          &amp;(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#17caa0b3ad84955ad38521140bb4b369">sector</a>));
<a name="l00362"></a>00362     <span class="keywordtype">unsigned</span> x_physical_size = <a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a>==64*1024 ? 0 : <a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a>;
<a name="l00363"></a>00363     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(x_physical_size, &amp;(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#12ba8169b46f5ab2ed90e6c36f590319">physical_size</a>));
<a name="l00364"></a>00364     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a>,           &amp;(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#6bf89ebee3af0814db501593bd0a2fb8">flags</a>));
<a name="l00365"></a>00365     <span class="keywordtype">unsigned</span> x_virtual_size = <a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a>==64*1024 ? 0 : <a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a>;
<a name="l00366"></a>00366     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(x_virtual_size,  &amp;(disk-&gt;<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html#d43ef445ecb488e51f10b42374641219">virtual_size</a>));
<a name="l00367"></a>00367     <span class="keywordflow">return</span> disk;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="comment">/* Prints some debugging info */</span>
<a name="l00371"></a>00371 <span class="keywordtype">void</span>
<a name="l00372"></a><a class="code" href="classSgAsmNESectionTableEntry.html#c56bd772d11fce151baeac42bb4cc4cb">00372</a> <a class="code" href="classSgAsmNESectionTableEntry.html#6c69e8c179d8731aaac33bb402906b56">SgAsmNESectionTableEntry::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx, <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr)<span class="keyword"> const</span>
<a name="l00373"></a>00373 <span class="keyword"></span>{
<a name="l00374"></a>00374     <span class="keywordtype">char</span> p[4096];
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00376"></a>00376         sprintf(p, <span class="stringliteral">"%sNESectionTableEntry[%zd]."</span>, prefix, idx);
<a name="l00377"></a>00377     } <span class="keywordflow">else</span> {
<a name="l00378"></a>00378         sprintf(p, <span class="stringliteral">"%sNESectionTableEntry."</span>, prefix);
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     fprintf(f, <span class="stringliteral">"%s%-*s = %u"</span>,                      p, w, <span class="stringliteral">"sector"</span>,          <a class="code" href="classSgAsmNESectionTableEntry.html#38726d8ad628e65d3321a1fccc749eb0">p_sector</a>);
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (fhdr)
<a name="l00386"></a>00386         fprintf(f, <span class="stringliteral">" (%"</span>PRIu64<span class="stringliteral">" byte offset)"</span>, (<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>) <a class="code" href="classSgAsmNESectionTableEntry.html#38726d8ad628e65d3321a1fccc749eb0">p_sector</a> &lt;&lt; fhdr-&gt;<a class="code" href="classSgAsmNEFileHeader.html#14f593cfdbf087fc4bbf29fa7e7183ab">get_e_sector_align</a>());
<a name="l00387"></a>00387     fputc(<span class="charliteral">'\n'</span>, f);
<a name="l00388"></a>00388     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" bytes\n"</span>,       p, w, <span class="stringliteral">"physical_size"</span>,   <a class="code" href="classSgAsmNESectionTableEntry.html#f21a8d76a6020b6f8157123f0501ccfa">p_physical_size</a>);
<a name="l00389"></a>00389     fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">" bytes\n"</span>,       p, w, <span class="stringliteral">"virtual_size"</span>,    <a class="code" href="classSgAsmNESectionTableEntry.html#697e6651c19f3519bedcbb76b0664bee">p_virtual_size</a>);
<a name="l00390"></a>00390     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08x"</span>,                  p, w, <span class="stringliteral">"flags"</span>,           <a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a>);
<a name="l00391"></a>00391     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29d7e41fcc027e47c20a359284c9c7ce04">SF_TYPE_MASK</a>) {
<a name="l00392"></a>00392       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29a4150ad50ab94cc163cc01215e761207">SF_CODE</a>:  fputs(<span class="stringliteral">" code"</span>, f);  <span class="keywordflow">break</span>;
<a name="l00393"></a>00393       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29176c597fd2b718c15380d7ad48bbaf7e">SF_DATA</a>:  fputs(<span class="stringliteral">" data"</span>, f);  <span class="keywordflow">break</span>;
<a name="l00394"></a>00394       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29e2dde0d11e9c751beaa6739aa03eb8fb">SF_ALLOC</a>: fputs(<span class="stringliteral">" alloc"</span>, f); <span class="keywordflow">break</span>;
<a name="l00395"></a>00395       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe291e1d7885ba7759c5c6197701936b1be7">SF_LOAD</a>:  fputs(<span class="stringliteral">" load"</span>, f);  <span class="keywordflow">break</span>;
<a name="l00396"></a>00396       <span class="keywordflow">default</span>: fprintf(f, <span class="stringliteral">" type=%u"</span>, <a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; SF_TYPE_MASK); <span class="keywordflow">break</span>;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe2976dcdf8f11dd460ed8b321befd055cbd">SF_MOVABLE</a>)      fputs(<span class="stringliteral">" movable"</span>,     f);
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe294128eb873c70486ff6173c14704d5ac2">SF_PURE</a>)         fputs(<span class="stringliteral">" pure"</span>,        f);
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29d96a6ce25aa8efa9f566dcbfb334233d">SF_PRELOAD</a>)      fputs(<span class="stringliteral">" preload"</span>,     f);
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29ae58f91fdd9fb055b954370eb6607811">SF_NOT_WRITABLE</a>) fputs(<span class="stringliteral">" const"</span>,       f);
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe2956b2605492b8fc84913bdacdb5fdb949">SF_RELOCINFO</a>)    fputs(<span class="stringliteral">" reloc"</span>,       f);
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe2905905c8d14d2477ddf9baabb082cb8d9">SF_DISCARDABLE</a>)  fputs(<span class="stringliteral">" discardable"</span>, f);
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29e99ac3ee56a8b9b6d7dfaedda2177bfc">SF_DISCARD</a>)      fputs(<span class="stringliteral">" discard"</span>,     f);
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESectionTableEntry.html#372b0232e77f5a80e2d4d7914e3f9bda">p_flags</a> &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe293924853ef618751a2185def01f31a05e">SF_RESERVED</a>)     fputs(<span class="stringliteral">" *"</span>,           f);
<a name="l00406"></a>00406     fputc(<span class="charliteral">'\n'</span>, f);
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="comment">/* Write section back to disk */</span>
<a name="l00410"></a>00410 <span class="keywordtype">void</span>
<a name="l00411"></a><a class="code" href="classSgAsmNESection.html#5cec1f5cf64ccbcfdc6602a57f4902ca">00411</a> <a class="code" href="classSgAsmNESection.html#5cec1f5cf64ccbcfdc6602a57f4902ca">SgAsmNESection::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00412"></a>00412 <span class="keyword"></span>{
<a name="l00413"></a>00413     <a class="code" href="classSgAsmGenericSection.html#7452213ee05e2fdc50589d10a57d7763">SgAsmGenericSection::unparse</a>(f);
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESection.html#4c09f0f8acee5cc922a064c68044ef61">p_reloc_table</a>)
<a name="l00415"></a>00415         <a class="code" href="classSgAsmNESection.html#4c09f0f8acee5cc922a064c68044ef61">p_reloc_table</a>-&gt;<a class="code" href="classSgAsmNERelocTable.html#036fe081247fd5be7079dc4f676279ae">unparse</a>(f);
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417     
<a name="l00418"></a>00418 <span class="comment">/* Print some debugging info. */</span>
<a name="l00419"></a>00419 <span class="keywordtype">void</span>
<a name="l00420"></a><a class="code" href="classSgAsmNESection.html#f99846396b0ac394d3306e95fb067f70">00420</a> <a class="code" href="classSgAsmNESection.html#f99846396b0ac394d3306e95fb067f70">SgAsmNESection::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00421"></a>00421 <span class="keyword"></span>{
<a name="l00422"></a>00422     <span class="keywordtype">char</span> p[4096];
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00424"></a>00424         sprintf(p, <span class="stringliteral">"%sNESection[%zd]."</span>, prefix, idx);
<a name="l00425"></a>00425     } <span class="keywordflow">else</span> {
<a name="l00426"></a>00426         sprintf(p, <span class="stringliteral">"%sNESection."</span>, prefix);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00432"></a>00432     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00433"></a>00433     <a class="code" href="classSgAsmNESection.html#545617f241d021c18a543319fde029fd">p_st_entry</a>-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#6c69e8c179d8731aaac33bb402906b56">dump</a>(f, p, -1, fhdr);
<a name="l00434"></a>00434     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNESection.html#4c09f0f8acee5cc922a064c68044ef61">p_reloc_table</a>) {
<a name="l00435"></a>00435         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"reloc_table"</span>,
<a name="l00436"></a>00436                 <a class="code" href="classSgAsmNESection.html#4c09f0f8acee5cc922a064c68044ef61">p_reloc_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNESection.html#4c09f0f8acee5cc922a064c68044ef61">p_reloc_table</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00437"></a>00437     } <span class="keywordflow">else</span> {
<a name="l00438"></a>00438         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"reloc_table"</span>);
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="comment">/* Constructor */</span>
<a name="l00443"></a>00443 <span class="keywordtype">void</span>
<a name="l00444"></a><a class="code" href="classSgAsmNESectionTable.html#3e42348610317abf33ac7aea5ca7466e">00444</a> <a class="code" href="classSgAsmNESectionTable.html#3e42348610317abf33ac7aea5ca7466e">SgAsmNESectionTable::ctor</a>()
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00447"></a>00447     ROSE_ASSERT(fhdr!=NULL);
<a name="l00448"></a>00448     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#3e9ca19a5d5de6d845adbdafd362bdae">get_end_offset</a>());
<a name="l00449"></a>00449     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(fhdr-&gt;<a class="code" href="classSgAsmNEFileHeader.html#86437e75da866792b9a0955ff927ad3e">get_e_nsections</a>() * <span class="keyword">sizeof</span>(<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">SgAsmNESectionTableEntry::NESectionTableEntry_disk</a>));
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00454"></a>00454     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Section Table"</span>));
<a name="l00455"></a>00455     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keyword">const</span> size_t entsize = <span class="keyword">sizeof</span>(<a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">SgAsmNESectionTableEntry::NESectionTableEntry_disk</a>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordflow">for</span> (size_t i = 0; i &lt; fhdr-&gt;<a class="code" href="classSgAsmNEFileHeader.html#86437e75da866792b9a0955ff927ad3e">get_e_nsections</a>(); i++) {
<a name="l00460"></a>00460         <span class="comment">/* Parse the section table entry */</span>
<a name="l00461"></a>00461         <a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">SgAsmNESectionTableEntry::NESectionTableEntry_disk</a> disk;
<a name="l00462"></a>00462         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(i*entsize, &amp;disk, entsize);
<a name="l00463"></a>00463         <a class="code" href="classSgAsmNESectionTableEntry.html">SgAsmNESectionTableEntry</a> *entry = <span class="keyword">new</span> <a class="code" href="classSgAsmNESectionTableEntry.html">SgAsmNESectionTableEntry</a>(&amp;disk);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="comment">/* The section */</span>
<a name="l00466"></a>00466         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> section_offset = entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#0f0709d08afa8c9f5cc3efc5a4c3bae0">get_sector</a>() &lt;&lt; fhdr-&gt;<a class="code" href="classSgAsmNEFileHeader.html#14f593cfdbf087fc4bbf29fa7e7183ab">get_e_sector_align</a>();
<a name="l00467"></a>00467         <a class="code" href="classSgAsmNESection.html">SgAsmNESection</a> *section = <span class="keyword">new</span> <a class="code" href="classSgAsmNESection.html">SgAsmNESection</a>(fhdr);
<a name="l00468"></a>00468         section-&gt;<a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(section_offset);
<a name="l00469"></a>00469         section-&gt;<a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(0==section_offset ? 0 : entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#920c47f35c55fb5fef5594247868e598">get_physical_size</a>());
<a name="l00470"></a>00470         section-&gt;<a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00471"></a>00471         section-&gt;<a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">false</span>);
<a name="l00472"></a>00472         section-&gt;<a class="code" href="classSgAsmGenericSection.html#52e9f6981456f7cd726ff2e3fe759ac9">set_id</a>(i+1); <span class="comment">/*numbered starting at 1, not zero*/</span>
<a name="l00473"></a>00473         section-&gt;<a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99bb01207376662e6874fa78f096efc00f3">SP_PROGRAM</a>);
<a name="l00474"></a>00474         section-&gt;<a class="code" href="classSgAsmNESection.html#ae478069bbdbbb0a67365e08f4dd92e8">set_st_entry</a>(entry);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="comment">/* All NE sections are mapped. Their desired address is apparently based on their file offset. */</span>
<a name="l00477"></a>00477         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> mapped_rva = section_offset - fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>();
<a name="l00478"></a>00478         section-&gt;<a class="code" href="classSgAsmGenericSection.html#6e6cab1e9039308526f86e8d43727473">set_mapped_preferred_rva</a>(mapped_rva);
<a name="l00479"></a>00479         section-&gt;<a class="code" href="classSgAsmGenericSection.html#db598a0f1a89918b3d7748c9e39f215a">set_mapped_actual_va</a>(0); <span class="comment">/*assigned by Loader*/</span>
<a name="l00480"></a>00480         section-&gt;<a class="code" href="classSgAsmGenericSection.html#be5685a58a633903a76aca2423e3b9da">set_mapped_size</a>(entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#078ae08b6d029a37587bf14d1d02c6d8">get_virtual_size</a>());
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <span class="keywordtype">unsigned</span> section_type = entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#923008154d4d63e06fa7b4406ea9385c">get_flags</a>() &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29d7e41fcc027e47c20a359284c9c7ce04">SgAsmNESectionTableEntry::SF_TYPE_MASK</a>;
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (0 == section_offset) {
<a name="l00484"></a>00484             section-&gt;<a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">".bss"</span>));
<a name="l00485"></a>00485             section-&gt;<a class="code" href="classSgAsmGenericSection.html#3a2c9dfd9d359523db1d416d240c6a26">set_mapped_rperm</a>(<span class="keyword">true</span>);
<a name="l00486"></a>00486             section-&gt;<a class="code" href="classSgAsmGenericSection.html#7deab31aa0c9acad0d4d9512c2b151de">set_mapped_wperm</a>(entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#923008154d4d63e06fa7b4406ea9385c">get_flags</a>() &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29ae58f91fdd9fb055b954370eb6607811">SgAsmNESectionTableEntry::SF_NOT_WRITABLE</a> ? <span class="keyword">false</span> : <span class="keyword">true</span>);
<a name="l00487"></a>00487             section-&gt;<a class="code" href="classSgAsmGenericSection.html#e86d1ee27cba377fc3e01b488706440a">set_mapped_xperm</a>(<span class="keyword">false</span>);
<a name="l00488"></a>00488         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == section_type) {
<a name="l00489"></a>00489             section-&gt;<a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">".text"</span>));
<a name="l00490"></a>00490             section-&gt;<a class="code" href="classSgAsmGenericSection.html#3a2c9dfd9d359523db1d416d240c6a26">set_mapped_rperm</a>(<span class="keyword">true</span>);
<a name="l00491"></a>00491             section-&gt;<a class="code" href="classSgAsmGenericSection.html#7deab31aa0c9acad0d4d9512c2b151de">set_mapped_wperm</a>(entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#923008154d4d63e06fa7b4406ea9385c">get_flags</a>() &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29ae58f91fdd9fb055b954370eb6607811">SgAsmNESectionTableEntry::SF_NOT_WRITABLE</a> ? <span class="keyword">false</span> : <span class="keyword">true</span>);
<a name="l00492"></a>00492             section-&gt;<a class="code" href="classSgAsmGenericSection.html#e86d1ee27cba377fc3e01b488706440a">set_mapped_xperm</a>(<span class="keyword">true</span>);
<a name="l00493"></a>00493         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (section_type &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29176c597fd2b718c15380d7ad48bbaf7e">SgAsmNESectionTableEntry::SF_DATA</a>) {
<a name="l00494"></a>00494             section-&gt;<a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">".data"</span>));
<a name="l00495"></a>00495             section-&gt;<a class="code" href="classSgAsmGenericSection.html#3a2c9dfd9d359523db1d416d240c6a26">set_mapped_rperm</a>(<span class="keyword">true</span>);
<a name="l00496"></a>00496             section-&gt;<a class="code" href="classSgAsmGenericSection.html#7deab31aa0c9acad0d4d9512c2b151de">set_mapped_wperm</a>(entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#923008154d4d63e06fa7b4406ea9385c">get_flags</a>() &amp; (<a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29d96a6ce25aa8efa9f566dcbfb334233d">SgAsmNESectionTableEntry::SF_PRELOAD</a> |
<a name="l00497"></a>00497                                                             <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe29ae58f91fdd9fb055b954370eb6607811">SgAsmNESectionTableEntry::SF_NOT_WRITABLE</a>) ? <span class="keyword">false</span> : <span class="keyword">true</span>);
<a name="l00498"></a>00498             section-&gt;<a class="code" href="classSgAsmGenericSection.html#e86d1ee27cba377fc3e01b488706440a">set_mapped_xperm</a>(<span class="keyword">false</span>);
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#923008154d4d63e06fa7b4406ea9385c">get_flags</a>() &amp; <a class="code" href="classSgAsmNESectionTableEntry.html#f022faa0864ed3fb887e15036246fe2956b2605492b8fc84913bdacdb5fdb949">SgAsmNESectionTableEntry::SF_RELOCINFO</a>) {
<a name="l00502"></a>00502             <a class="code" href="classSgAsmNERelocTable.html">SgAsmNERelocTable</a> *relocs = <span class="keyword">new</span> <a class="code" href="classSgAsmNERelocTable.html">SgAsmNERelocTable</a>(fhdr, section);
<a name="l00503"></a>00503             section-&gt;<a class="code" href="classSgAsmNESection.html#1376ccae055c37d78e4d3bc356ddc6c9">set_reloc_table</a>(relocs);
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="comment">/* Writes the section table back to disk along with each of the sections. */</span>
<a name="l00509"></a>00509 <span class="keywordtype">void</span>
<a name="l00510"></a><a class="code" href="classSgAsmNESectionTable.html#8f473ac455881caada223c280a497903">00510</a> <a class="code" href="classSgAsmNESectionTable.html#8f473ac455881caada223c280a497903">SgAsmNESectionTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00511"></a>00511 <span class="keyword"></span>{
<a name="l00512"></a>00512     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00513"></a>00513     ROSE_ASSERT(fhdr!=NULL);
<a name="l00514"></a>00514     <a class="code" href="Cxx__Grammar_8h.html#af7ee9051414ea5a9e6e9697fe2cc6e2">SgAsmGenericSectionPtrList</a> sections = fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#5cefae0c9db1832cd75642799bc33762">get_sections</a>()-&gt;<a class="code" href="classSgAsmGenericSectionList.html#239d407e4df928777b992e8fdfc6e685">get_sections</a>();
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (size_t i=0; i&lt;sections.size(); i++) {
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (sections[i]-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>()&gt;=0) {
<a name="l00518"></a>00518             <a class="code" href="classSgAsmNESection.html">SgAsmNESection</a> *section = dynamic_cast&lt;SgAsmNESection*&gt;(sections[i]);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520             <span class="comment">/* Write the table entry */</span>
<a name="l00521"></a>00521             ROSE_ASSERT(section-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>()&gt;0); <span class="comment">/*ID's are 1-origin in NE*/</span>
<a name="l00522"></a>00522             size_t slot = section-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>()-1;
<a name="l00523"></a>00523             <a class="code" href="classSgAsmNESectionTableEntry.html">SgAsmNESectionTableEntry</a> *shdr = section-&gt;<a class="code" href="classSgAsmNESection.html#951acf6196f270fe152485af6a2113b0">get_st_entry</a>();
<a name="l00524"></a>00524             <a class="code" href="structSgAsmNESectionTableEntry_1_1NESectionTableEntry__disk.html">SgAsmNESectionTableEntry::NESectionTableEntry_disk</a> disk;
<a name="l00525"></a>00525             shdr-&gt;<a class="code" href="classSgAsmNESectionTableEntry.html#dc8491162978cf8c3d1b8f6e1b12c0bd">encode</a>(&amp;disk);
<a name="l00526"></a>00526             <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, slot*<span class="keyword">sizeof</span>(disk), <span class="keyword">sizeof</span> disk, &amp;disk);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528             <span class="comment">/* Write the section and it's optional relocation table */</span>
<a name="l00529"></a>00529             section-&gt;<a class="code" href="classSgAsmNESection.html#5cec1f5cf64ccbcfdc6602a57f4902ca">unparse</a>(f);
<a name="l00530"></a>00530             <span class="keywordflow">if</span> (section-&gt;<a class="code" href="classSgAsmNESection.html#39b5c77531cc8c5cf08f15e0e5a86fff">get_reloc_table</a>())
<a name="l00531"></a>00531                 section-&gt;<a class="code" href="classSgAsmNESection.html#39b5c77531cc8c5cf08f15e0e5a86fff">get_reloc_table</a>()-&gt;<a class="code" href="classSgAsmNERelocTable.html#036fe081247fd5be7079dc4f676279ae">unparse</a>(f);
<a name="l00532"></a>00532         }
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <span class="comment">/* Prints some debugging info */</span>
<a name="l00537"></a>00537 <span class="keywordtype">void</span>
<a name="l00538"></a><a class="code" href="classSgAsmNESectionTable.html#91897a3d4f4f0cef2f7df44b1795b3dc">00538</a> <a class="code" href="classSgAsmNESectionTable.html#91897a3d4f4f0cef2f7df44b1795b3dc">SgAsmNESectionTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00539"></a>00539 <span class="keyword"></span>{
<a name="l00540"></a>00540     <span class="keywordtype">char</span> p[4096];
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00542"></a>00542         sprintf(p, <span class="stringliteral">"%sNESectionTable[%zd]."</span>, prefix, idx);
<a name="l00543"></a>00543     } <span class="keywordflow">else</span> {
<a name="l00544"></a>00544         sprintf(p, <span class="stringliteral">"%sNESectionTable."</span>, prefix);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00550"></a>00550 <span class="comment">// NE Resident and Non-Resident Name Tables</span>
<a name="l00552"></a>00552 <span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">/* Constructor assumes SgAsmGenericSection is zero bytes long so far */</span>
<a name="l00554"></a>00554 <span class="keywordtype">void</span>
<a name="l00555"></a><a class="code" href="classSgAsmNENameTable.html#930406708ea0e06ec06083ce1d21d8dc">00555</a> <a class="code" href="classSgAsmNENameTable.html#930406708ea0e06ec06083ce1d21d8dc">SgAsmNENameTable::ctor</a>(<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(offset);
<a name="l00558"></a>00558     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(0);
<a name="l00559"></a>00559     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00562"></a>00562     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Name Table"</span>));
<a name="l00563"></a>00563     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00566"></a>00566     ROSE_ASSERT(fhdr!=NULL);
<a name="l00567"></a>00567     
<a name="l00568"></a>00568     <span class="comment">/* Resident exported procedure names, until we hit a zero length name. The first name</span>
<a name="l00569"></a>00569 <span class="comment">     * is for the library itself and the corresponding ordinal has no meaning. */</span>
<a name="l00570"></a>00570     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at = 0;
<a name="l00571"></a>00571     <span class="keywordflow">while</span> (1) {
<a name="l00572"></a>00572         <a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(1);
<a name="l00573"></a>00573         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
<a name="l00574"></a>00574         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l00575"></a>00575         size_t length = byte;
<a name="l00576"></a>00576         <span class="keywordflow">if</span> (0==length) <span class="keywordflow">break</span>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(length);
<a name="l00579"></a>00579         <span class="keywordtype">char</span> *buf = <span class="keyword">new</span> <span class="keywordtype">char</span>[length];
<a name="l00580"></a>00580         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, buf, length);
<a name="l00581"></a>00581         <a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>.push_back(std::string(buf, length));
<a name="l00582"></a>00582         <span class="keyword">delete</span>[] buf;
<a name="l00583"></a>00583         at += length;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(2);
<a name="l00586"></a>00586         uint16_t u16_disk;
<a name="l00587"></a>00587         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l00588"></a>00588         <a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>.push_back(<a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk));
<a name="l00589"></a>00589         at += 2;
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="comment">/* Writes the section back to disk. */</span>
<a name="l00594"></a>00594 <span class="keywordtype">void</span>
<a name="l00595"></a><a class="code" href="classSgAsmNENameTable.html#1d6abb67923937bd41779b06f2eafe41">00595</a> <a class="code" href="classSgAsmNENameTable.html#1d6abb67923937bd41779b06f2eafe41">SgAsmNENameTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00596"></a>00596 <span class="keyword"></span>{
<a name="l00597"></a>00597     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos=0; <span class="comment">/*section offset*/</span>
<a name="l00598"></a>00598     ROSE_ASSERT(<a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>.size() == <a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>.size());
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>.size(); i++) {
<a name="l00601"></a>00601         <span class="comment">/* Name length */</span>
<a name="l00602"></a>00602         ROSE_ASSERT(<a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>[i].size() &lt;= 0xff);
<a name="l00603"></a>00603         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> len = <a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>[i].size();
<a name="l00604"></a>00604         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, len);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <span class="comment">/* Name */</span>
<a name="l00607"></a>00607         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>[i]);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609         <span class="comment">/* Ordinal */</span>
<a name="l00610"></a>00610         ROSE_ASSERT(<a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>[i]&lt;=0xffff);
<a name="l00611"></a>00611         uint16_t ordinal_le;
<a name="l00612"></a>00612         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>[i], &amp;ordinal_le);
<a name="l00613"></a>00613         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> ordinal_le, &amp;ordinal_le);
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615     
<a name="l00616"></a>00616     <span class="comment">/* Zero-terminated */</span>
<a name="l00617"></a>00617     <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="charliteral">'\0'</span>);
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 <span class="comment">/* Prints some debugging info */</span>
<a name="l00621"></a>00621 <span class="keywordtype">void</span>
<a name="l00622"></a><a class="code" href="classSgAsmNENameTable.html#d9396685567311b031f39c44da2a02e2">00622</a> <a class="code" href="classSgAsmNENameTable.html#d9396685567311b031f39c44da2a02e2">SgAsmNENameTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00623"></a>00623 <span class="keyword"></span>{
<a name="l00624"></a>00624     <span class="keywordtype">char</span> p[4096];
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00626"></a>00626         sprintf(p, <span class="stringliteral">"%sNENameTable[%zd]."</span>, prefix, idx);
<a name="l00627"></a>00627     } <span class="keywordflow">else</span> {
<a name="l00628"></a>00628         sprintf(p, <span class="stringliteral">"%sNENameTable."</span>, prefix);
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00634"></a>00634     ROSE_ASSERT(<a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>.size() == <a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>.size());
<a name="l00635"></a>00635     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>.size(); i++) {
<a name="l00636"></a>00636         fprintf(f, <span class="stringliteral">"%s%-*s = [%zd] \"%s\"\n"</span>, p, w, <span class="stringliteral">"names"</span>,    i, <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>[i]).c_str());
<a name="l00637"></a>00637         fprintf(f, <span class="stringliteral">"%s%-*s = [%zd] %u\n"</span>,     p, w, <span class="stringliteral">"ordinals"</span>, i, <a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>[i]);
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="comment">/* Returns all names associated with a particular ordinal */</span>
<a name="l00642"></a>00642 std::vector&lt;std::string&gt;
<a name="l00643"></a><a class="code" href="classSgAsmNENameTable.html#6d439d5920db01bf3c47609f267397de">00643</a> <a class="code" href="classSgAsmNENameTable.html#6d439d5920db01bf3c47609f267397de">SgAsmNENameTable::get_names_by_ordinal</a>(<span class="keywordtype">unsigned</span> ordinal)
<a name="l00644"></a>00644 {
<a name="l00645"></a>00645     std::vector&lt;std::string&gt; retval;
<a name="l00646"></a>00646     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>.size(); i++) {
<a name="l00647"></a>00647         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNENameTable.html#0bb6157028b023265135863cb5e7a1fc">p_ordinals</a>[i] == ordinal) {
<a name="l00648"></a>00648             retval.push_back(<a class="code" href="classSgAsmNENameTable.html#1cf87732618dd2f8135dfed30a9c063e">p_names</a>[i]);
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     <span class="keywordflow">return</span> retval;
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00655"></a>00655 <span class="comment">// NE Module Reference Table</span>
<a name="l00657"></a>00657 <span class="comment"></span>
<a name="l00658"></a>00658 <span class="comment">/* Constructor */</span>
<a name="l00659"></a>00659 <span class="keywordtype">void</span>
<a name="l00660"></a><a class="code" href="classSgAsmNEModuleTable.html#835257fbabdf36fed803735d8d6df896">00660</a> <a class="code" href="classSgAsmNEModuleTable.html#835257fbabdf36fed803735d8d6df896">SgAsmNEModuleTable::ctor</a>(<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> size)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(offset);
<a name="l00663"></a>00663     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(size);
<a name="l00664"></a>00664     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00667"></a>00667     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Module Reference Table"</span>));
<a name="l00668"></a>00668     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00671"></a>00671     ROSE_ASSERT(fhdr!=NULL);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     ROSE_ASSERT(NULL != <a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordflow">for</span> (<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at = 0; at &lt; <a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>(); at += 2) {
<a name="l00676"></a>00676         uint16_t u16_disk;
<a name="l00677"></a>00677         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l00678"></a>00678         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> name_offset = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l00679"></a>00679         <a class="code" href="classSgAsmNEModuleTable.html#92b503de49ec04869b0f1d3af56a95c2">p_name_offsets</a>.push_back(name_offset);
<a name="l00680"></a>00680         <a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>.push_back(<a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>-&gt;<a class="code" href="classSgAsmNEStringTable.html#90b1b4c724d8586ea1f9fa647e563b57">get_string</a>(name_offset));
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="comment">/* Add libraries to file header */</span>
<a name="l00684"></a>00684     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>.size(); i++) {
<a name="l00685"></a>00685         fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#d95455ca65afdb0a5b8af2c04bb8f709">add_dll</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmGenericDLL.html">SgAsmGenericDLL</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>[i])));
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">/* Writes the section back to disk. */</span>
<a name="l00690"></a>00690 <span class="keywordtype">void</span>
<a name="l00691"></a><a class="code" href="classSgAsmNEModuleTable.html#131008145b95a1f9917527afcf84ab18">00691</a> <a class="code" href="classSgAsmNEModuleTable.html#131008145b95a1f9917527afcf84ab18">SgAsmNEModuleTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00692"></a>00692 <span class="keyword"></span>{
<a name="l00693"></a>00693     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos = 0; <span class="comment">/*section offset*/</span>
<a name="l00694"></a>00694     <a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#7452213ee05e2fdc50589d10a57d7763">unparse</a>(f);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEModuleTable.html#92b503de49ec04869b0f1d3af56a95c2">p_name_offsets</a>.size(); i++) {
<a name="l00697"></a>00697         uint16_t name_offset_le;
<a name="l00698"></a>00698         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEModuleTable.html#92b503de49ec04869b0f1d3af56a95c2">p_name_offsets</a>[i], &amp;name_offset_le);
<a name="l00699"></a>00699         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> name_offset_le, &amp;name_offset_le);
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702     
<a name="l00703"></a>00703 <span class="comment">/* Prints some debugging info */</span>
<a name="l00704"></a>00704 <span class="keywordtype">void</span>
<a name="l00705"></a><a class="code" href="classSgAsmNEModuleTable.html#f46a06c34ad776e7670656366823c159">00705</a> <a class="code" href="classSgAsmNEModuleTable.html#f46a06c34ad776e7670656366823c159">SgAsmNEModuleTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00706"></a>00706 <span class="keyword"></span>{
<a name="l00707"></a>00707     <span class="keywordtype">char</span> p[4096];
<a name="l00708"></a>00708     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00709"></a>00709         sprintf(p, <span class="stringliteral">"%sNEModuleTable[%zd]."</span>, prefix, idx);
<a name="l00710"></a>00710     } <span class="keywordflow">else</span> {
<a name="l00711"></a>00711         sprintf(p, <span class="stringliteral">"%sNEModuleTable."</span>, prefix);
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>) {
<a name="l00719"></a>00719         fprintf(f, <span class="stringliteral">"%s%-*s = [%d] \"%s\"\n"</span>, p, w, <span class="stringliteral">"strtab"</span>,
<a name="l00720"></a>00720                 <a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(), <a class="code" href="classSgAsmNEModuleTable.html#6186de5a8e91d7ae09227ab53c8276c3">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00721"></a>00721     } <span class="keywordflow">else</span> {
<a name="l00722"></a>00722         fprintf(f, <span class="stringliteral">"%s%-*s = none\n"</span>, p, w, <span class="stringliteral">"strtab"</span>);
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>.size(); i++) {
<a name="l00726"></a>00726         fprintf(f, <span class="stringliteral">"%s%-*s = [%zu] (offset %"</span>PRIu64<span class="stringliteral">", %zu bytes) \"%s\"\n"</span>,
<a name="l00727"></a>00727                 p, w, <span class="stringliteral">"name"</span>, i, <a class="code" href="classSgAsmNEModuleTable.html#92b503de49ec04869b0f1d3af56a95c2">p_name_offsets</a>[i], <a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>[i].size(), <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmNEModuleTable.html#0eb45be18b991e920c03a8d7037e2c0e">p_names</a>[i]).c_str());
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00732"></a>00732 <span class="comment">// NE String Table</span>
<a name="l00734"></a>00734 <span class="comment"></span>
<a name="l00735"></a>00735 <span class="comment">/* Constructor. We don't parse out the strings here because we want to keep track of what strings are actually referenced by</span>
<a name="l00736"></a>00736 <span class="comment"> * other parts of the file. We can get that information with the congeal() method. */</span>
<a name="l00737"></a>00737 <span class="keywordtype">void</span>
<a name="l00738"></a><a class="code" href="classSgAsmNEStringTable.html#796bc5f0081765d330df416215caebe2">00738</a> <a class="code" href="classSgAsmNEStringTable.html#796bc5f0081765d330df416215caebe2">SgAsmNEStringTable::ctor</a>(<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> size)
<a name="l00739"></a>00739 {
<a name="l00740"></a>00740     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(offset);
<a name="l00741"></a>00741     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(size);
<a name="l00742"></a>00742     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00745"></a>00745     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE String Table"</span>));
<a name="l00746"></a>00746     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748     
<a name="l00749"></a>00749 <span class="comment">/* Returns the string whose size indicator is at the specified offset within the table. There's nothing that prevents OFFSET</span>
<a name="l00750"></a>00750 <span class="comment"> * from pointing to some random location within the string table (but we will throw an exception if offset or the described</span>
<a name="l00751"></a>00751 <span class="comment"> * following string falls outside the string table). */</span>
<a name="l00752"></a>00752 std::string
<a name="l00753"></a><a class="code" href="classSgAsmNEStringTable.html#90b1b4c724d8586ea1f9fa647e563b57">00753</a> <a class="code" href="classSgAsmNEStringTable.html#90b1b4c724d8586ea1f9fa647e563b57">SgAsmNEStringTable::get_string</a>(<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset)
<a name="l00754"></a>00754 {
<a name="l00755"></a>00755     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
<a name="l00756"></a>00756     <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(offset, &amp;byte, 1);
<a name="l00757"></a>00757     size_t length = byte;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordtype">char</span> *buf = <span class="keyword">new</span> <span class="keywordtype">char</span>[length];
<a name="l00760"></a>00760     <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(offset+1, buf, length);
<a name="l00761"></a>00761     std::string retval(buf, length);
<a name="l00762"></a>00762     <span class="keyword">delete</span>[] buf;
<a name="l00763"></a>00763     <span class="keywordflow">return</span> retval;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="comment">/* Prints some debugging info */</span>
<a name="l00767"></a>00767 <span class="keywordtype">void</span>
<a name="l00768"></a><a class="code" href="classSgAsmNEStringTable.html#798ea7281a379c4a08fcb6753f480b8b">00768</a> <a class="code" href="classSgAsmNEStringTable.html#798ea7281a379c4a08fcb6753f480b8b">SgAsmNEStringTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00769"></a>00769 <span class="keyword"></span>{
<a name="l00770"></a>00770     <span class="keywordtype">char</span> p[4096];
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00772"></a>00772         sprintf(p, <span class="stringliteral">"%sNEStringTable[%zd]."</span>, prefix, idx);
<a name="l00773"></a>00773     } <span class="keywordflow">else</span> {
<a name="l00774"></a>00774         sprintf(p, <span class="stringliteral">"%sNEStringTable."</span>, prefix);
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="preprocessor">#if 0 </span><span class="comment">/*Can't parse strings because it would affect the list of referenced bytes*/</span>
<a name="l00780"></a>00780     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00781"></a>00781     <span class="keywordtype">bool</span> was_congealed = get_congealed();
<a name="l00782"></a>00782     congeal();
<a name="l00783"></a>00783     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at=0;
<a name="l00784"></a>00784     <span class="keywordflow">for</span> (size_t i=0; at&lt;<a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>(); i++) {
<a name="l00785"></a>00785         std::string s = <a class="code" href="classSgAsmNEStringTable.html#90b1b4c724d8586ea1f9fa647e563b57">get_string</a>(at);
<a name="l00786"></a>00786         <span class="keywordtype">char</span> label[64];
<a name="l00787"></a>00787         sprintf(label, <span class="stringliteral">"string-at-%"</span>PRIu64, at);
<a name="l00788"></a>00788         fprintf(f, <span class="stringliteral">"%s%-*s = [%zu] (offset %"</span>PRIu64<span class="stringliteral">", %zu bytes) \"%s\"\n"</span>, p, w, <span class="stringliteral">"string"</span>, i, at, s.size(), s.c_str());
<a name="l00789"></a>00789         at += 1 + s.size();
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (!was_congealed)
<a name="l00792"></a>00792       uncongeal();
<a name="l00793"></a>00793 <span class="preprocessor">#endif</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span>}
<a name="l00795"></a>00795 
<a name="l00797"></a>00797 <span class="comment">// NE Entry Table</span>
<a name="l00799"></a>00799 <span class="comment"></span>
<a name="l00800"></a>00800 <span class="comment">/* Print some debugging info */</span>
<a name="l00801"></a>00801 <span class="keywordtype">void</span>
<a name="l00802"></a><a class="code" href="classSgAsmNEEntryPoint.html#a6a904a711ba930bbbb525dbaee5c123">00802</a> <a class="code" href="classSgAsmNEEntryPoint.html#a6a904a711ba930bbbb525dbaee5c123">SgAsmNEEntryPoint::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00803"></a>00803 <span class="keyword"></span>{
<a name="l00804"></a>00804     <span class="keywordtype">char</span> p[4096];
<a name="l00805"></a>00805     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00806"></a>00806         sprintf(p, <span class="stringliteral">"%sNEEntryPoint[%zd]."</span>, prefix, idx);
<a name="l00807"></a>00807     } <span class="keywordflow">else</span> {
<a name="l00808"></a>00808         sprintf(p, <span class="stringliteral">"%sNEEntryPoint."</span>, prefix);
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="keywordflow">if</span> (0 == <a class="code" href="classSgAsmNEEntryPoint.html#9f4b0e0216ed0027003dbefd280cd72f">p_section_idx</a>) {
<a name="l00814"></a>00814         fprintf(f, <span class="stringliteral">"%s%-*s = %s\n"</span>, p, w, <span class="stringliteral">"type"</span>, <span class="stringliteral">"unused"</span>);
<a name="l00815"></a>00815         ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d926811e1ea4e886749f0ac49d02f323088">SgAsmNEEntryPoint::EF_ZERO</a> == <a class="code" href="classSgAsmNEEntryPoint.html#cca30395ccffcb517a18a75b1a9a26e1">p_flags</a>);
<a name="l00816"></a>00816         ROSE_ASSERT(0 == <a class="code" href="classSgAsmNEEntryPoint.html#96b4c08638437f73c4e523a39561b24b">p_int3f</a>);
<a name="l00817"></a>00817         ROSE_ASSERT(0 == <a class="code" href="classSgAsmNEEntryPoint.html#5cbf76b0ddf170659a62f9dc07e7735c">p_section_offset</a>);
<a name="l00818"></a>00818     } <span class="keywordflow">else</span> {
<a name="l00819"></a>00819         fprintf(f, <span class="stringliteral">"%s%-*s = %s\n"</span>,         p, w, <span class="stringliteral">"type"</span>,           0 == <a class="code" href="classSgAsmNEEntryPoint.html#96b4c08638437f73c4e523a39561b24b">p_int3f</a> ? <span class="stringliteral">"fixed"</span> : <span class="stringliteral">"movable"</span>);
<a name="l00820"></a>00820         fprintf(f, <span class="stringliteral">"%s%-*s = 0x%02x"</span>,       p, w, <span class="stringliteral">"flags"</span>,          <a class="code" href="classSgAsmNEEntryPoint.html#cca30395ccffcb517a18a75b1a9a26e1">p_flags</a>);
<a name="l00821"></a>00821         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEEntryPoint.html#cca30395ccffcb517a18a75b1a9a26e1">p_flags</a> &amp; <a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92f98e9db8dfe3e22db075144dc202a126">EF_EXPORTED</a>) fputs(<span class="stringliteral">" exported"</span>, f);
<a name="l00822"></a>00822         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEEntryPoint.html#cca30395ccffcb517a18a75b1a9a26e1">p_flags</a> &amp; <a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d9217e1d998e952a09b3ce4692801ce5a76">EF_GLOBAL</a>)   fputs(<span class="stringliteral">" global"</span>,   f);
<a name="l00823"></a>00823         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEEntryPoint.html#cca30395ccffcb517a18a75b1a9a26e1">p_flags</a> &amp; <a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92d95df8a972809b2346369fcaf157eb42">EF_RESERVED</a>) fputs(<span class="stringliteral">" *"</span>,        f);
<a name="l00824"></a>00824         fputc(<span class="charliteral">'\n'</span>, f);
<a name="l00825"></a>00825         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEEntryPoint.html#96b4c08638437f73c4e523a39561b24b">p_int3f</a>)
<a name="l00826"></a>00826             fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>, p, w, <span class="stringliteral">"int3f"</span>,          <a class="code" href="classSgAsmNEEntryPoint.html#96b4c08638437f73c4e523a39561b24b">p_int3f</a>);
<a name="l00827"></a>00827         fprintf(f, <span class="stringliteral">"%s%-*s = %d\n"</span>,         p, w, <span class="stringliteral">"section_idx"</span>,    <a class="code" href="classSgAsmNEEntryPoint.html#9f4b0e0216ed0027003dbefd280cd72f">p_section_idx</a>);
<a name="l00828"></a>00828         fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>,     p, w, <span class="stringliteral">"section_offset"</span>, <a class="code" href="classSgAsmNEEntryPoint.html#5cbf76b0ddf170659a62f9dc07e7735c">p_section_offset</a>);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="comment">/* Constructor */</span>
<a name="l00833"></a>00833 <span class="keywordtype">void</span>
<a name="l00834"></a><a class="code" href="classSgAsmNEEntryTable.html#5a620aa70237dab211c11483dde0a94c">00834</a> <a class="code" href="classSgAsmNEEntryTable.html#5a620aa70237dab211c11483dde0a94c">SgAsmNEEntryTable::ctor</a>(<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> offset, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> size)
<a name="l00835"></a>00835 {
<a name="l00836"></a>00836     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(offset);
<a name="l00837"></a>00837     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(size);
<a name="l00838"></a>00838     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00841"></a>00841     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Entry Table"</span>));
<a name="l00842"></a>00842     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
<a name="l00845"></a>00845     uint16_t u16_disk;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at = 0;
<a name="l00848"></a>00848     <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l00849"></a>00849     size_t bundle_nentries = byte;
<a name="l00850"></a>00850     <span class="keywordflow">while</span> (bundle_nentries &gt; 0) {
<a name="l00851"></a>00851         <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>.push_back(bundle_nentries);
<a name="l00852"></a>00852         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l00853"></a>00853         <span class="keywordtype">unsigned</span> segment_indicator = byte;
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (0 == segment_indicator) {
<a name="l00855"></a>00855             <span class="comment">/* Unused entries */</span>
<a name="l00856"></a>00856             <span class="keywordflow">for</span> (size_t i = 0; i &lt; bundle_nentries; i++) {
<a name="l00857"></a>00857                 <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.push_back(<span class="keyword">new</span> <a class="code" href="classSgAsmNEEntryPoint.html">SgAsmNEEntryPoint</a>());
<a name="l00858"></a>00858             }
<a name="l00859"></a>00859         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xff == segment_indicator) {
<a name="l00860"></a>00860             <span class="comment">/* Movable segment entries. */</span>
<a name="l00861"></a>00861             <span class="keywordflow">for</span> (size_t i = 0; i &lt; bundle_nentries; i++, at+=6) {
<a name="l00862"></a>00862                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;byte, 1);
<a name="l00863"></a>00863                 <a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92">SgAsmNEEntryPoint::NEEntryFlags</a> flags = (<a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92">SgAsmNEEntryPoint::NEEntryFlags</a>)byte;
<a name="l00864"></a>00864                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+1, &amp;u16_disk, 2);
<a name="l00865"></a>00865                 <span class="keywordtype">unsigned</span> int3f = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l00866"></a>00866                 ROSE_ASSERT(int3f!=0); <span class="comment">/*because we use zero to indicate a fixed entry in unparse()*/</span>
<a name="l00867"></a>00867                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+3, &amp;byte, 1);
<a name="l00868"></a>00868                 <span class="keywordtype">unsigned</span> segno = byte;
<a name="l00869"></a>00869                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+4, &amp;u16_disk, 2);
<a name="l00870"></a>00870                 <span class="keywordtype">unsigned</span> segoffset = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l00871"></a>00871                 <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.push_back(<span class="keyword">new</span> <a class="code" href="classSgAsmNEEntryPoint.html">SgAsmNEEntryPoint</a>(flags, int3f, segno, segoffset));
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873         } <span class="keywordflow">else</span> {
<a name="l00874"></a>00874             <span class="comment">/* Fixed segment entries */</span>
<a name="l00875"></a>00875             <span class="keywordflow">for</span> (size_t i = 0; i &lt; bundle_nentries; i++, at+=3) {
<a name="l00876"></a>00876                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;byte, 1);
<a name="l00877"></a>00877                 <a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92">SgAsmNEEntryPoint::NEEntryFlags</a> flags = (<a class="code" href="classSgAsmNEEntryPoint.html#008c3d0564362b223945c0e6c4676d92">SgAsmNEEntryPoint::NEEntryFlags</a>)byte;
<a name="l00878"></a>00878                 <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+1, &amp;u16_disk, 2);
<a name="l00879"></a>00879                 <span class="keywordtype">unsigned</span> segoffset = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l00880"></a>00880                 <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.push_back(<span class="keyword">new</span> <a class="code" href="classSgAsmNEEntryPoint.html">SgAsmNEEntryPoint</a>(flags, 0, segment_indicator, segoffset));
<a name="l00881"></a>00881             }
<a name="l00882"></a>00882         }
<a name="l00883"></a>00883         
<a name="l00884"></a>00884         <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l00885"></a>00885         bundle_nentries = byte;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889 <span class="comment">/* Populates the entry_rvas vector of the NE header based on the contents of this Entry Table. The Section (Object) Table must</span>
<a name="l00890"></a>00890 <span class="comment"> * have already been parsed and nonsynthesized sections constructed. */</span>
<a name="l00891"></a>00891 <span class="keywordtype">void</span>
<a name="l00892"></a><a class="code" href="classSgAsmNEEntryTable.html#094c5c676c219475bff318a1a96cb982">00892</a> <a class="code" href="classSgAsmNEEntryTable.html#094c5c676c219475bff318a1a96cb982">SgAsmNEEntryTable::populate_entries</a>()
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894     <a class="code" href="classSgAsmGenericHeader.html">SgAsmGenericHeader</a> *fhdr = <a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>();
<a name="l00895"></a>00895     <span class="keywordflow">for</span> (size_t i=0; i &lt; <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.size(); i++) {
<a name="l00896"></a>00896         <span class="keyword">const</span> <a class="code" href="classSgAsmNEEntryPoint.html">SgAsmNEEntryPoint</a> &amp; entry = *(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[i]);
<a name="l00897"></a>00897         <a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *section = NULL;
<a name="l00898"></a>00898         <span class="keywordflow">if</span> (0 == entry.get_section_idx()) {
<a name="l00899"></a>00899             <span class="comment">/* Unused entry */</span>
<a name="l00900"></a>00900         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NULL == (section = <a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>()-&gt;get_section_by_id(entry.get_section_idx()))) {
<a name="l00901"></a>00901             fprintf(stderr, <span class="stringliteral">"Ignoring bad entry section_idx (FIXME)\n"</span>);
<a name="l00902"></a>00902             entry.dump(stderr, <span class="stringliteral">"      "</span>, i);
<a name="l00903"></a>00903         } <span class="keywordflow">else</span> {
<a name="l00904"></a>00904             ROSE_ASSERT(section-&gt;<a class="code" href="classSgAsmGenericSection.html#104f95720dd8a1b1cc458c8c651943cb">is_mapped</a>());
<a name="l00905"></a>00905             <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> entry_rva = section-&gt;<a class="code" href="classSgAsmGenericSection.html#5196f7cd5b28560a8b959b1e3228c079">get_mapped_preferred_rva</a>() + entry.get_section_offset();
<a name="l00906"></a>00906             fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#488298b68b8b6a28597ec75459d6a7ca">add_entry_rva</a>(entry_rva);
<a name="l00907"></a>00907 <span class="preprocessor">#if 0 </span><span class="comment">/*DEBUGGING*/</span>
<a name="l00908"></a>00908             <span class="comment">/* Entry points often have names. Here's how to get them. */</span>
<a name="l00909"></a>00909             <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *ne_header = dynamic_cast&lt;SgAsmNEFileHeader*&gt;(fhdr);
<a name="l00910"></a>00910             <a class="code" href="classSgAsmNENameTable.html">SgAsmNENameTable</a> *nametab = ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#7727dde8d058095f5b68589bd13fb601">get_nonresname_table</a>();
<a name="l00911"></a>00911             std::vector&lt;std::string&gt; names = nametab-&gt;<a class="code" href="classSgAsmNENameTable.html#6d439d5920db01bf3c47609f267397de">get_names_by_ordinal</a>(i+1);
<a name="l00912"></a>00912             fprintf(stderr, <span class="stringliteral">"ROBB: entry[%zu] (ordinal %zu)\n"</span>, i, i+1);
<a name="l00913"></a>00913             <span class="keywordflow">for</span> (size_t j = 0; j &lt; p_names.size(); j++) {
<a name="l00914"></a>00914                 fprintf(stderr, <span class="stringliteral">"ROBB:     name=\"%s\"\n"</span>, p_names[j].c_str());
<a name="l00915"></a>00915             }
<a name="l00916"></a>00916 <span class="preprocessor">#endif</span>
<a name="l00917"></a>00917 <span class="preprocessor"></span>        }
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="comment">/* Write section back to disk */</span>
<a name="l00922"></a>00922 <span class="keywordtype">void</span>
<a name="l00923"></a><a class="code" href="classSgAsmNEEntryTable.html#6a254cfd3aa5e61a77d4bc7181dd726b">00923</a> <a class="code" href="classSgAsmNEEntryTable.html#6a254cfd3aa5e61a77d4bc7181dd726b">SgAsmNEEntryTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00924"></a>00924 <span class="keyword"></span>{
<a name="l00925"></a>00925     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos=0; <span class="comment">/*section offset*/</span>
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="keywordflow">for</span> (size_t bi=0, ei=0; bi &lt; <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>.size(); ei += <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi++]) {
<a name="l00928"></a>00928         ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi] &gt; 0 &amp;&amp; <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi] &lt;= 0xff);
<a name="l00929"></a>00929         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> n = <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi];
<a name="l00930"></a>00930         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, n);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932         ROSE_ASSERT(ei + <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi] &lt;= <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.size());
<a name="l00933"></a>00933         <span class="keywordflow">if</span> (0 == <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei]-&gt;get_section_idx()) {
<a name="l00934"></a>00934             <span class="comment">/* Unused entries */</span>
<a name="l00935"></a>00935             spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="charliteral">'\0'</span>);
<a name="l00936"></a>00936         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei]-&gt;get_int3f()) {
<a name="l00937"></a>00937             <span class="comment">/* Fixed entries */</span>
<a name="l00938"></a>00938             ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei]-&gt;get_section_idx() &lt;= 0xff);
<a name="l00939"></a>00939             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> n = <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei]-&gt;get_section_idx();
<a name="l00940"></a>00940             spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, n);
<a name="l00941"></a>00941             <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi]; i++) {
<a name="l00942"></a>00942                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei]-&gt;get_section_idx() == <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_idx());
<a name="l00943"></a>00943                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_int3f() == 0);
<a name="l00944"></a>00944                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;<a class="code" href="classSgAsmGenericSection.html#8eeba6aae08fb5132388ce7d915b6cb6">get_flags</a>() &lt;= 0xff);
<a name="l00945"></a>00945                 n = <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_flags();
<a name="l00946"></a>00946                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, n);
<a name="l00947"></a>00947                 uint16_t eoff_le;
<a name="l00948"></a>00948                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_offset(), &amp;eoff_le);
<a name="l00949"></a>00949                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> eoff_le, &amp;eoff_le);
<a name="l00950"></a>00950             }
<a name="l00951"></a>00951         } <span class="keywordflow">else</span> {
<a name="l00952"></a>00952             <span class="comment">/* Movable entries */</span>
<a name="l00953"></a>00953             spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, '\377');
<a name="l00954"></a>00954             <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[bi]; i++) {
<a name="l00955"></a>00955                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_idx() &gt; 0);
<a name="l00956"></a>00956                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_int3f() != 0);
<a name="l00957"></a>00957                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;<a class="code" href="classSgAsmGenericSection.html#8eeba6aae08fb5132388ce7d915b6cb6">get_flags</a>() &lt;= 0xff);
<a name="l00958"></a>00958                 n = <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_flags();
<a name="l00959"></a>00959                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, n);
<a name="l00960"></a>00960                 uint16_t word;
<a name="l00961"></a>00961                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_int3f(), &amp;word);
<a name="l00962"></a>00962                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l00963"></a>00963                 ROSE_ASSERT(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_idx() &lt;= 0xff);
<a name="l00964"></a>00964                 n = <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_idx();
<a name="l00965"></a>00965                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, n);
<a name="l00966"></a>00966                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[ei+i]-&gt;get_section_offset(), &amp;word);
<a name="l00967"></a>00967                 spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l00968"></a>00968             }
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971     <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="charliteral">'\0'</span>);
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 <span class="comment">/* Print some debugging info */</span>
<a name="l00975"></a>00975 <span class="keywordtype">void</span>
<a name="l00976"></a><a class="code" href="classSgAsmNEEntryTable.html#bf429904622d2f4fbbe9b26323a79bd4">00976</a> <a class="code" href="classSgAsmNEEntryTable.html#bf429904622d2f4fbbe9b26323a79bd4">SgAsmNEEntryTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00977"></a>00977 <span class="keyword"></span>{
<a name="l00978"></a>00978     <span class="keywordtype">char</span> p[4096];
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00980"></a>00980         sprintf(p, <span class="stringliteral">"%sNEEntryTable[%zd]."</span>, prefix, idx);
<a name="l00981"></a>00981     } <span class="keywordflow">else</span> {
<a name="l00982"></a>00982         sprintf(p, <span class="stringliteral">"%sNEEntryTable."</span>, prefix);
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00988"></a>00988     fprintf(f, <span class="stringliteral">"%s%-*s = %zu bundles\n"</span>, p, w, <span class="stringliteral">"nbundles"</span>, <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>.size());
<a name="l00989"></a>00989     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>.size(); i++) {
<a name="l00990"></a>00990         fprintf(f, <span class="stringliteral">"%s%-*s = [%zu] %zu entries\n"</span>, p, w, <span class="stringliteral">"bundle_size"</span>, i, <a class="code" href="classSgAsmNEEntryTable.html#5b0fc02df4f9ce823b3c22be4ea4bc9e">p_bundle_sizes</a>[i]);
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>.size(); i++) {
<a name="l00993"></a>00993         <a class="code" href="classSgAsmNEEntryTable.html#cf07abef81291fe5baf358c783c16184">p_entries</a>[i]-&gt;<a class="code" href="classSgAsmNEEntryTable.html#bf429904622d2f4fbbe9b26323a79bd4">dump</a>(f, p, i);
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00998"></a>00998 <span class="comment">// NE Relocation Table</span>
<a name="l01000"></a>01000 <span class="comment"></span>
<a name="l01001"></a>01001 <span class="comment">/* Constructor. */</span>
<a name="l01002"></a>01002 <span class="keywordtype">void</span>
<a name="l01003"></a><a class="code" href="classSgAsmNERelocEntry.html#e66df8d608d815555836faf60d6b64ba">01003</a> <a class="code" href="classSgAsmNERelocEntry.html#e66df8d608d815555836faf60d6b64ba">SgAsmNERelocEntry::ctor</a>(<a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *relocs, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> *rec_size<span class="comment">/*out*/</span>)
<a name="l01004"></a>01004 {
<a name="l01005"></a>01005     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
<a name="l01006"></a>01006     uint16_t u16_disk;
<a name="l01007"></a>01007     uint32_t u32_disk;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> orig_at = at;
<a name="l01010"></a>01010     ROSE_ASSERT(at == relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>()); <span class="comment">/*the section is extended as we parse*/</span>
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     <span class="comment">/* Only the low nibble is used for source type; the high nibble is modifier bits */</span>
<a name="l01013"></a>01013     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(1);
<a name="l01014"></a>01014     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l01015"></a>01015     <span class="keywordtype">unsigned</span> n = byte;
<a name="l01016"></a>01016     <a class="code" href="classSgAsmNERelocEntry.html#07c20af975ae6e8d8c4d4d501f2b7aca">p_src_type</a> = (<a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466">SgAsmNERelocEntry::NERelocSrcType</a>)(n &amp; 0x0f);
<a name="l01017"></a>01017     <a class="code" href="classSgAsmNERelocEntry.html#5d4fe676d2458d6b69ad368dd3df8529">p_modifier</a> = (<a class="code" href="classSgAsmNERelocEntry.html#86b21c115cd4f74b6653619ae551e0ab">SgAsmNERelocEntry::NERelocModifiers</a>)(n&gt;&gt;8);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     <span class="comment">/* The target type (3 bits), additive flag (1 bit), and target flags */</span>
<a name="l01020"></a>01020     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(1);
<a name="l01021"></a>01021     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l01022"></a>01022     n = byte;
<a name="l01023"></a>01023     <a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a> = (<a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab2544429292">SgAsmNERelocEntry::NERelocTgtType</a>)(n &amp; 0x03);
<a name="l01024"></a>01024     <a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> = (<a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d8">SgAsmNERelocEntry::NERelocFlags</a>)(n&gt;&gt;2);
<a name="l01025"></a>01025     
<a name="l01026"></a>01026     <span class="comment">/* src_offset is the byte offset into the source section that needs to be patched. If this is an additive relocation then</span>
<a name="l01027"></a>01027 <span class="comment">     * the source will be patched by adding the target value to the value stored at the source. Otherwise the target value is</span>
<a name="l01028"></a>01028 <span class="comment">     * written to the source and the old contents of the source contains the next source offset, until we get 0xffff. */</span>
<a name="l01029"></a>01029     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(2);
<a name="l01030"></a>01030     relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01031"></a>01031     <a class="code" href="classSgAsmNERelocEntry.html#abb1ddcad468d9be5fcad2f69801a45e">p_src_offset</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01032"></a>01032     at += 2;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a>) {
<a name="l01035"></a>01035       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292922a71dbbe81021c9dd06445bce52033ab">RF_TGTTYPE_IREF</a>:
<a name="l01036"></a>01036         <span class="comment">/* Internal reference */</span>
<a name="l01037"></a>01037         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01038"></a>01038         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l01039"></a>01039         <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#730170bb99a38d43e594bd420842c09f">sect_idx</a> = byte;
<a name="l01040"></a>01040         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at++, &amp;byte, 1);
<a name="l01041"></a>01041         <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#76255a676fee11019e8d96f49b1b7494">res1</a>  = byte;
<a name="l01042"></a>01042         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01043"></a>01043         <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#7a9322bcdf228e39359bb006c75519bc">tgt_offset</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01044"></a>01044         at += 2;
<a name="l01045"></a>01045         <span class="keywordflow">break</span>;
<a name="l01046"></a>01046       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab254442929206dd95ee4fe9cb0c37d5915242c62653">RF_TGTTYPE_IORD</a>:
<a name="l01047"></a>01047         <span class="comment">/* Imported ordinal */</span>
<a name="l01048"></a>01048         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01049"></a>01049         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01050"></a>01050         <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#eb39b345f35ee585baebc1424a019d90">modref</a>  = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01051"></a>01051         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+2, &amp;u16_disk, 2);
<a name="l01052"></a>01052         <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#8765ef482a5415f92965f83e9d43d1b9">ordinal</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01053"></a>01053         at += 4;
<a name="l01054"></a>01054         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d831ac7f8620de937ad982af016ca86fe3">RF_2EXTRA</a>) {
<a name="l01055"></a>01055             <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d801a555cb7d557cfbe7f9aa3d652c5785">RF_32ADD</a>) {
<a name="l01056"></a>01056                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01057"></a>01057                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+8, &amp;u32_disk, 4);
<a name="l01058"></a>01058                 <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u32_disk);
<a name="l01059"></a>01059                 at += 4;
<a name="l01060"></a>01060             } <span class="keywordflow">else</span> {
<a name="l01061"></a>01061                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(2);
<a name="l01062"></a>01062                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+8, &amp;u16_disk, 2);
<a name="l01063"></a>01063                 <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01064"></a>01064                 at += 2;
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066         } <span class="keywordflow">else</span> {
<a name="l01067"></a>01067             <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a> = 0;
<a name="l01068"></a>01068         }
<a name="l01069"></a>01069         <span class="keywordflow">break</span>;
<a name="l01070"></a>01070       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292925654a04176f3ea275000b0233620fe0c">RF_TGTTYPE_INAME</a>:
<a name="l01071"></a>01071         <span class="comment">/* Imported name */</span>
<a name="l01072"></a>01072         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01073"></a>01073         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01074"></a>01074         <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#440aa60d6c0a8b3d629aa2e8ea590a14">modref</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01075"></a>01075         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+2, &amp;u16_disk, 2);
<a name="l01076"></a>01076         <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#8c6a10c5a89e0bce3bc648eb6dc8188c">nm_off</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01077"></a>01077         at += 4;
<a name="l01078"></a>01078         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; RF_2EXTRA) {
<a name="l01079"></a>01079             <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d801a555cb7d557cfbe7f9aa3d652c5785">RF_32ADD</a>) {
<a name="l01080"></a>01080                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01081"></a>01081                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+8, &amp;u32_disk, 4);
<a name="l01082"></a>01082                 <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u32_disk);
<a name="l01083"></a>01083                 at += 4;
<a name="l01084"></a>01084             } <span class="keywordflow">else</span> {
<a name="l01085"></a>01085                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(2);
<a name="l01086"></a>01086                 relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+8, &amp;u16_disk, 2);
<a name="l01087"></a>01087                 <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01088"></a>01088                 at += 2;
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090         } <span class="keywordflow">else</span> {
<a name="l01091"></a>01091             <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a> = 0;
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093         <span class="keywordflow">break</span>;
<a name="l01094"></a>01094       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292923f1f5874e757be4424c9035bcf8acba2">RF_TGTTYPE_OSFIXUP</a>:
<a name="l01095"></a>01095         <span class="comment">/* Operating system fixup */</span>
<a name="l01096"></a>01096         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(4);
<a name="l01097"></a>01097         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01098"></a>01098         <a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#6ac941dbd3789b725fbdf7cf68c5213b">type</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01099"></a>01099         relocs-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at+2, &amp;u16_disk, 2);
<a name="l01100"></a>01100         <a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1c881a17a6afa19971c607a382e77bbb">res3</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01101"></a>01101         at += 4;
<a name="l01102"></a>01102         <span class="keywordflow">break</span>;
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     <span class="keywordflow">if</span> (rec_size)
<a name="l01106"></a>01106         *rec_size = at - orig_at;
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 <span class="comment">/* Write entry back to disk at the specified section and section offset, returning new offset */</span>
<a name="l01110"></a>01110 <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>
<a name="l01111"></a><a class="code" href="classSgAsmNERelocEntry.html#c3e63bb7d168cf38f65db461ac5ecb7b">01111</a> <a class="code" href="classSgAsmNERelocEntry.html#c3e63bb7d168cf38f65db461ac5ecb7b">SgAsmNERelocEntry::unparse</a>(std::ostream &amp;f, <span class="keyword">const</span> <a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *section, <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos)<span class="keyword"> const</span>
<a name="l01112"></a>01112 <span class="keyword"></span>{
<a name="l01113"></a>01113     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
<a name="l01114"></a>01114     byte = (<a class="code" href="classSgAsmNERelocEntry.html#5d4fe676d2458d6b69ad368dd3df8529">p_modifier</a> &lt;&lt; 8) | (<a class="code" href="classSgAsmNERelocEntry.html#07c20af975ae6e8d8c4d4d501f2b7aca">p_src_type</a> &amp; 0x0f);
<a name="l01115"></a>01115     spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, byte);
<a name="l01116"></a>01116     byte = (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &lt;&lt; 2) | (<a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a> &amp; 0x03);
<a name="l01117"></a>01117     spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, byte);
<a name="l01118"></a>01118     
<a name="l01119"></a>01119     uint16_t word;
<a name="l01120"></a>01120     uint32_t dword;
<a name="l01121"></a>01121     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#abb1ddcad468d9be5fcad2f69801a45e">p_src_offset</a>, &amp;word);
<a name="l01122"></a>01122     spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01123"></a>01123     
<a name="l01124"></a>01124     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a>) {
<a name="l01125"></a>01125       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292922a71dbbe81021c9dd06445bce52033ab">RF_TGTTYPE_IREF</a>:
<a name="l01126"></a>01126         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#730170bb99a38d43e594bd420842c09f">sect_idx</a>, &amp;byte);
<a name="l01127"></a>01127         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, byte);
<a name="l01128"></a>01128         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#76255a676fee11019e8d96f49b1b7494">res1</a>, &amp;byte);
<a name="l01129"></a>01129         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, byte);
<a name="l01130"></a>01130         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#7a9322bcdf228e39359bb006c75519bc">tgt_offset</a>, &amp;word);
<a name="l01131"></a>01131         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01132"></a>01132         <span class="keywordflow">break</span>;
<a name="l01133"></a>01133       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab254442929206dd95ee4fe9cb0c37d5915242c62653">RF_TGTTYPE_IORD</a>:
<a name="l01134"></a>01134         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#eb39b345f35ee585baebc1424a019d90">modref</a>, &amp;word);
<a name="l01135"></a>01135         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01136"></a>01136         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#8765ef482a5415f92965f83e9d43d1b9">ordinal</a>, &amp;word);
<a name="l01137"></a>01137         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01138"></a>01138         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d831ac7f8620de937ad982af016ca86fe3">RF_2EXTRA</a>) {
<a name="l01139"></a>01139             <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d801a555cb7d557cfbe7f9aa3d652c5785">RF_32ADD</a>) {
<a name="l01140"></a>01140                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a>, &amp;dword);
<a name="l01141"></a>01141                 spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> dword, &amp;dword);
<a name="l01142"></a>01142             } <span class="keywordflow">else</span> {
<a name="l01143"></a>01143                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a>, &amp;word);
<a name="l01144"></a>01144                 spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01145"></a>01145             }
<a name="l01146"></a>01146         } <span class="keywordflow">else</span> {
<a name="l01147"></a>01147             ROSE_ASSERT(<a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a>==0);
<a name="l01148"></a>01148         }
<a name="l01149"></a>01149         <span class="keywordflow">break</span>;
<a name="l01150"></a>01150       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292925654a04176f3ea275000b0233620fe0c">RF_TGTTYPE_INAME</a>:
<a name="l01151"></a>01151         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#440aa60d6c0a8b3d629aa2e8ea590a14">modref</a>, &amp;word);
<a name="l01152"></a>01152         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01153"></a>01153         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#8c6a10c5a89e0bce3bc648eb6dc8188c">nm_off</a>, &amp;word);
<a name="l01154"></a>01154         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01155"></a>01155         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; RF_2EXTRA) {
<a name="l01156"></a>01156             <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d801a555cb7d557cfbe7f9aa3d652c5785">RF_32ADD</a>) {
<a name="l01157"></a>01157                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a>, &amp;dword);
<a name="l01158"></a>01158                 spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> dword, &amp;dword);
<a name="l01159"></a>01159             } <span class="keywordflow">else</span> {
<a name="l01160"></a>01160                 <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a>, &amp;word);
<a name="l01161"></a>01161                 spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01162"></a>01162             }
<a name="l01163"></a>01163         } <span class="keywordflow">else</span> {
<a name="l01164"></a>01164             ROSE_ASSERT(<a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a>==0);
<a name="l01165"></a>01165         }
<a name="l01166"></a>01166         <span class="keywordflow">break</span>;
<a name="l01167"></a>01167       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292923f1f5874e757be4424c9035bcf8acba2">RF_TGTTYPE_OSFIXUP</a>:
<a name="l01168"></a>01168         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#6ac941dbd3789b725fbdf7cf68c5213b">type</a>, &amp;word);
<a name="l01169"></a>01169         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01170"></a>01170         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1c881a17a6afa19971c607a382e77bbb">res3</a>, &amp;word);
<a name="l01171"></a>01171         spos = section-&gt;<a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> word, &amp;word);
<a name="l01172"></a>01172         <span class="keywordflow">break</span>;
<a name="l01173"></a>01173       <span class="keywordflow">default</span>:
<a name="l01174"></a>01174         ROSE_ASSERT(!<span class="stringliteral">"unknown relocation target type"</span>);
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176     <span class="keywordflow">return</span> spos;
<a name="l01177"></a>01177 }
<a name="l01178"></a>01178     
<a name="l01179"></a>01179 <span class="comment">/* Print some debugging info */</span>
<a name="l01180"></a>01180 <span class="keywordtype">void</span>
<a name="l01181"></a><a class="code" href="classSgAsmNERelocEntry.html#704daebd92cdc0c82cc9defc2de9d12a">01181</a> <a class="code" href="classSgAsmNERelocEntry.html#704daebd92cdc0c82cc9defc2de9d12a">SgAsmNERelocEntry::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l01182"></a>01182 <span class="keyword"></span>{
<a name="l01183"></a>01183     <span class="keywordtype">char</span> p[4096];
<a name="l01184"></a>01184     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l01185"></a>01185         sprintf(p, <span class="stringliteral">"%sRelocEntry[%zd]."</span>, prefix, idx);
<a name="l01186"></a>01186     } <span class="keywordflow">else</span> {
<a name="l01187"></a>01187         sprintf(p, <span class="stringliteral">"%sRelocEntry."</span>, prefix);
<a name="l01188"></a>01188     }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <span class="keyword">const</span> <span class="keywordtype">char</span> *s;
<a name="l01193"></a>01193     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#07c20af975ae6e8d8c4d4d501f2b7aca">p_src_type</a>) {
<a name="l01194"></a>01194       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466d9b4dcf194810ab81d8f3d627ac88437">RF_SRCTYPE_8OFF</a>:     s = <span class="stringliteral">"byte offset"</span>;     <span class="keywordflow">break</span>;
<a name="l01195"></a>01195       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e5834660f25e743951a8d30f9b587db47a6cc59">RF_SRCTYPE_WORDSEG</a>:  s = <span class="stringliteral">"16-bit selector"</span>; <span class="keywordflow">break</span>;
<a name="l01196"></a>01196       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e58346652d5c349a7a0df1775f57017e9ae8da6">RF_SRCTYPE_16PTR</a>:    s = <span class="stringliteral">"16-bit pointer"</span>;  <span class="keywordflow">break</span>;
<a name="l01197"></a>01197       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466d7c8f29e2930bbc3f91d0237aaf42295">RF_SRCTYPE_16OFF</a>:    s = <span class="stringliteral">"16-bit offset"</span>;   <span class="keywordflow">break</span>;
<a name="l01198"></a>01198       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466220e58f9fea1c83fa54c31043597ee6e">RF_SRCTYPE_32PTR</a>:    s = <span class="stringliteral">"32-bit pointer"</span>;  <span class="keywordflow">break</span>;
<a name="l01199"></a>01199       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466212562b3c3d115ce2d706deca22e1f38">RF_SRCTYPE_32OFF</a>:    s = <span class="stringliteral">"32-bit offset"</span>;   <span class="keywordflow">break</span>;
<a name="l01200"></a>01200       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466a4fb5188053948261d901cdbde73f531">RF_SRCTYPE_NEARCALL</a>: s = <span class="stringliteral">"near call/jump"</span>;  <span class="keywordflow">break</span>;
<a name="l01201"></a>01201       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e5834661fb2bfa5b5716dd1a7349cd018bc4311">RF_SRCTYPE_48PTR</a>:    s = <span class="stringliteral">"48-bit pointer"</span>;  <span class="keywordflow">break</span>;
<a name="l01202"></a>01202       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#d4879e56afdc089435123a283e583466eac4bb74cff741b75f637d9ea37c514c">RF_SRCTYPE_32OFF_b</a>:  s = <span class="stringliteral">"32-bit offset"</span>;   <span class="keywordflow">break</span>;
<a name="l01203"></a>01203       <span class="keywordflow">default</span>:                  s = <span class="stringliteral">"unknown"</span>;         <span class="keywordflow">break</span>;
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205     fprintf(f, <span class="stringliteral">"%s%-*s = %u (%s)\n"</span>, p, w, <span class="stringliteral">"src_type"</span>, <a class="code" href="classSgAsmNERelocEntry.html#07c20af975ae6e8d8c4d4d501f2b7aca">p_src_type</a>, s);
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#5d4fe676d2458d6b69ad368dd3df8529">p_modifier</a>) {
<a name="l01208"></a>01208       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#86b21c115cd4f74b6653619ae551e0ab08f2643d8b01259798b715adf7a822f3">RF_MODIFIER_SINGLE</a>:  s = <span class="stringliteral">"single"</span>;          <span class="keywordflow">break</span>;
<a name="l01209"></a>01209       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#86b21c115cd4f74b6653619ae551e0abe4f0194856079929c503b08eb441a28c">RF_MODIFIER_MULTI</a>:   s = <span class="stringliteral">"multiple"</span>;        <span class="keywordflow">break</span>;
<a name="l01210"></a>01210       <span class="keywordflow">default</span>:                  s = <span class="stringliteral">"unknown"</span>;         <span class="keywordflow">break</span>;
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04u (%s)\n"</span>, p, w, <span class="stringliteral">"modifier"</span>, <a class="code" href="classSgAsmNERelocEntry.html#5d4fe676d2458d6b69ad368dd3df8529">p_modifier</a>, s);
<a name="l01213"></a>01213     
<a name="l01214"></a>01214     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a>) {
<a name="l01215"></a>01215       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292922a71dbbe81021c9dd06445bce52033ab">RF_TGTTYPE_IREF</a>:    s = <span class="stringliteral">"internal reference"</span>; <span class="keywordflow">break</span>;
<a name="l01216"></a>01216       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab254442929206dd95ee4fe9cb0c37d5915242c62653">RF_TGTTYPE_IORD</a>:    s = <span class="stringliteral">"imported ordinal"</span>;   <span class="keywordflow">break</span>;
<a name="l01217"></a>01217       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292925654a04176f3ea275000b0233620fe0c">RF_TGTTYPE_INAME</a>:   s = <span class="stringliteral">"imported name"</span>;      <span class="keywordflow">break</span>;
<a name="l01218"></a>01218       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292923f1f5874e757be4424c9035bcf8acba2">RF_TGTTYPE_OSFIXUP</a>: s = <span class="stringliteral">"OS fixup"</span>;           <span class="keywordflow">break</span>;
<a name="l01219"></a>01219       <span class="keywordflow">default</span>:                 s = <span class="stringliteral">"unknown"</span>;            <span class="keywordflow">break</span>;
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221     fprintf(f, <span class="stringliteral">"%s%-*s = %u (%s)\n"</span>,       p, w, <span class="stringliteral">"tgt_type"</span>,   <a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a>, s);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x"</span>,          p, w, <span class="stringliteral">"flags"</span>, <a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a>);
<a name="l01224"></a>01224     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d8d756b37b9113f00754f73c0206110277">RF_ADDITIVE</a>)  fputs(<span class="stringliteral">" additive"</span>,  f);
<a name="l01225"></a>01225     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d831ac7f8620de937ad982af016ca86fe3">RF_2EXTRA</a>)    fputs(<span class="stringliteral">" 2-extra"</span>,   f);
<a name="l01226"></a>01226     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d801a555cb7d557cfbe7f9aa3d652c5785">RF_32ADD</a>)     fputs(<span class="stringliteral">" 32-add"</span>,    f);
<a name="l01227"></a>01227     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d89403d9b218f615c8073b923896e8af5c">RF_16SECTION</a>) fputs(<span class="stringliteral">" 16-sect"</span>,   f);
<a name="l01228"></a>01228     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNERelocEntry.html#a290baa52cacda7999e07957d035b7ef">p_flags</a> &amp; <a class="code" href="classSgAsmNERelocEntry.html#0eaf29d44fe8dd05ea33f287445a08d810f762cc1a105bfef4c98438f86b10d1">RF_8ORDINAL</a>)  fputs(<span class="stringliteral">" 8-ordinal"</span>, f);
<a name="l01229"></a>01229     fputc(<span class="charliteral">'\n'</span>, f);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08"</span>PRIx64<span class="stringliteral">"\n"</span>, p, w, <span class="stringliteral">"src_offset"</span>, <a class="code" href="classSgAsmNERelocEntry.html#abb1ddcad468d9be5fcad2f69801a45e">p_src_offset</a>);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmNERelocEntry.html#844ea90044a2e2404a250c2661a1a680">p_tgt_type</a>) {
<a name="l01234"></a>01234       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292922a71dbbe81021c9dd06445bce52033ab">RF_TGTTYPE_IREF</a>:
<a name="l01235"></a>01235         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"sect_idx"</span>,   <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#730170bb99a38d43e594bd420842c09f">sect_idx</a>);
<a name="l01236"></a>01236         fprintf(f, <span class="stringliteral">"%s%-*s = 0x%02x\n"</span>,        p, w, <span class="stringliteral">"res3"</span>,       <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#76255a676fee11019e8d96f49b1b7494">res1</a>);
<a name="l01237"></a>01237         fprintf(f, <span class="stringliteral">"%s%-*s = 0x%08"</span>PRIx64<span class="stringliteral">"\n"</span>, p, w, <span class="stringliteral">"tgt_offset"</span>, <a class="code" href="classSgAsmNERelocEntry.html#e2c332620dee7d9f44a3a0588e433fee">p_iref</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iref__type.html#7a9322bcdf228e39359bb006c75519bc">tgt_offset</a>);
<a name="l01238"></a>01238         <span class="keywordflow">break</span>;
<a name="l01239"></a>01239       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab254442929206dd95ee4fe9cb0c37d5915242c62653">RF_TGTTYPE_IORD</a>:
<a name="l01240"></a>01240         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"modref"</span>,     <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#eb39b345f35ee585baebc1424a019d90">modref</a>);
<a name="l01241"></a>01241         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"ordinal"</span>,    <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#8765ef482a5415f92965f83e9d43d1b9">ordinal</a>);
<a name="l01242"></a>01242         fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">"\n"</span>,     p, w, <span class="stringliteral">"addend"</span>,     <a class="code" href="classSgAsmNERelocEntry.html#2d66c714c67ae15b46f7139083b05538">p_iord</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iord__type.html#6c0abbbd68a19485147479689b9da929">addend</a>);
<a name="l01243"></a>01243         <span class="keywordflow">break</span>;
<a name="l01244"></a>01244       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292925654a04176f3ea275000b0233620fe0c">RF_TGTTYPE_INAME</a>:
<a name="l01245"></a>01245         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"modref"</span>,     <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#440aa60d6c0a8b3d629aa2e8ea590a14">modref</a>);
<a name="l01246"></a>01246         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"nm_off"</span>,     <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#8c6a10c5a89e0bce3bc648eb6dc8188c">nm_off</a>);
<a name="l01247"></a>01247         fprintf(f, <span class="stringliteral">"%s%-*s = %"</span>PRIu64<span class="stringliteral">"\n"</span>,     p, w, <span class="stringliteral">"addend"</span>,     <a class="code" href="classSgAsmNERelocEntry.html#d1a041577ca99d54033e96b6fede6c6d">p_iname</a>.<a class="code" href="structSgAsmNERelocEntry_1_1iname__type.html#20cad4c942b91f44520b1db5a62f23a2">addend</a>);
<a name="l01248"></a>01248         <span class="keywordflow">break</span>;
<a name="l01249"></a>01249       <span class="keywordflow">case</span> <a class="code" href="classSgAsmNERelocEntry.html#bce44bb90498a37380d0ab25444292923f1f5874e757be4424c9035bcf8acba2">RF_TGTTYPE_OSFIXUP</a>:
<a name="l01250"></a>01250         fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,            p, w, <span class="stringliteral">"type"</span>,       <a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#6ac941dbd3789b725fbdf7cf68c5213b">type</a>);
<a name="l01251"></a>01251         fprintf(f, <span class="stringliteral">"%s%-*s = 0x%04x\n"</span>,        p, w, <span class="stringliteral">"res3"</span>,       <a class="code" href="classSgAsmNERelocEntry.html#e04d39f8cb8dffe3bc5b03f22eac54f4">p_osfixup</a>.<a class="code" href="structSgAsmNERelocEntry_1_1osfixup__type.html#1c881a17a6afa19971c607a382e77bbb">res3</a>);
<a name="l01252"></a>01252         <span class="keywordflow">break</span>;
<a name="l01253"></a>01253       <span class="keywordflow">default</span>:
<a name="l01254"></a>01254         ROSE_ASSERT(!<span class="stringliteral">"unknown relocation target type"</span>);
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256 }
<a name="l01257"></a>01257     
<a name="l01258"></a>01258 <span class="comment">/* Constructor. We don't know how large the relocation table is until we're parsing it (specifically, after we've read the</span>
<a name="l01259"></a>01259 <span class="comment"> * number of entries stored in the first two bytes), therefore the section should have an initial size of zero and we extend</span>
<a name="l01260"></a>01260 <span class="comment"> * it as we parse it. */</span>
<a name="l01261"></a>01261 <span class="keywordtype">void</span>
<a name="l01262"></a><a class="code" href="classSgAsmNERelocTable.html#8d117a3cab62ec35c188fed46dc3af9a">01262</a> <a class="code" href="classSgAsmNERelocTable.html#8d117a3cab62ec35c188fed46dc3af9a">SgAsmNERelocTable::ctor</a>(<a class="code" href="classSgAsmNESection.html">SgAsmNESection</a> *section)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264     ROSE_ASSERT(section!=NULL);
<a name="l01265"></a>01265     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(section-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + section-&gt;<a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>()); <span class="comment">/*reloc section begins immediately after section payload*/</span>
<a name="l01266"></a>01266     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(0);
<a name="l01267"></a>01267     <a class="code" href="classSgAsmGenericSection.html#e82ca4d608878cb2c9d81974270519ed">grab_content</a>();
<a name="l01268"></a>01268 
<a name="l01269"></a>01269     <span class="keywordtype">char</span> name[64];
<a name="l01270"></a>01270     sprintf(name, <span class="stringliteral">"NE Relocation Table %"</span>PRIu64, <a class="code" href="classSgAsmGenericSection.html#78f45331fc440d15f6ba1adde6092447">p_offset</a>);
<a name="l01271"></a>01271     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l01272"></a>01272     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(name));
<a name="l01273"></a>01273     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     ROSE_ASSERT(0 == <a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>());
<a name="l01276"></a>01276 
<a name="l01277"></a>01277     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> at = 0, reloc_size = 0;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(2);
<a name="l01280"></a>01280     uint16_t u16_disk;
<a name="l01281"></a>01281     <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(at, &amp;u16_disk, 2);
<a name="l01282"></a>01282     size_t nrelocs = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(u16_disk);
<a name="l01283"></a>01283     at += 2;
<a name="l01284"></a>01284     
<a name="l01285"></a>01285     <span class="keywordflow">for</span> (size_t i = 0; i &lt; nrelocs; i++, at += reloc_size) {
<a name="l01286"></a>01286         <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>.push_back(<span class="keyword">new</span> <a class="code" href="classSgAsmNERelocEntry.html">SgAsmNERelocEntry</a>(<span class="keyword">this</span>, at, &amp;reloc_size));
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288 }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="comment">/* Write relocation table back to disk */</span>
<a name="l01291"></a>01291 <span class="keywordtype">void</span>
<a name="l01292"></a><a class="code" href="classSgAsmNERelocTable.html#036fe081247fd5be7079dc4f676279ae">01292</a> <a class="code" href="classSgAsmNERelocTable.html#036fe081247fd5be7079dc4f676279ae">SgAsmNERelocTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l01293"></a>01293 <span class="keyword"></span>{
<a name="l01294"></a>01294     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos=0; <span class="comment">/*section offset*/</span>
<a name="l01295"></a>01295     uint16_t size_le;
<a name="l01296"></a>01296     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>.size(), &amp;size_le);
<a name="l01297"></a>01297     spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <span class="keyword">sizeof</span> size_le, &amp;size_le);
<a name="l01298"></a>01298     
<a name="l01299"></a>01299     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>.size(); i++) {
<a name="l01300"></a>01300         spos = <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>[i]-&gt;<a class="code" href="classSgAsmNERelocTable.html#036fe081247fd5be7079dc4f676279ae">unparse</a>(f, <span class="keyword">this</span>, spos);
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302 }
<a name="l01303"></a>01303     
<a name="l01304"></a>01304 <span class="comment">/* Print some debugging info */</span>
<a name="l01305"></a>01305 <span class="keywordtype">void</span>
<a name="l01306"></a><a class="code" href="classSgAsmNERelocTable.html#943104a076d82bc02e1fb0c0bcd99f48">01306</a> <a class="code" href="classSgAsmNERelocTable.html#943104a076d82bc02e1fb0c0bcd99f48">SgAsmNERelocTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l01307"></a>01307 <span class="keyword"></span>{
<a name="l01308"></a>01308     <span class="keywordtype">char</span> p[4096];
<a name="l01309"></a>01309     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l01310"></a>01310         sprintf(p, <span class="stringliteral">"%sNERelocTable[%zd]."</span>, prefix, idx);
<a name="l01311"></a>01311     } <span class="keywordflow">else</span> {
<a name="l01312"></a>01312         sprintf(p, <span class="stringliteral">"%sNERelocTable."</span>, prefix);
<a name="l01313"></a>01313     }
<a name="l01314"></a>01314 
<a name="l01315"></a>01315     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l01318"></a>01318     fprintf(f, <span class="stringliteral">"%s%-*s = %zu entries\n"</span>, p, w, <span class="stringliteral">"size"</span>, <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>.size());
<a name="l01319"></a>01319     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>.size(); i++) {
<a name="l01320"></a>01320         <a class="code" href="classSgAsmNERelocTable.html#2c19b7da4ad253bb49d2ceaf8b242cd2">p_entries</a>[i]-&gt;<a class="code" href="classSgAsmNERelocTable.html#943104a076d82bc02e1fb0c0bcd99f48">dump</a>(f, p, i);
<a name="l01321"></a>01321     }
<a name="l01322"></a>01322 }
<a name="l01323"></a>01323     
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 <span class="comment">/* Parses the structure of an NE file and adds the information to the SgAsmGenericFile. */</span>
<a name="l01327"></a>01327 <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *
<a name="l01328"></a><a class="code" href="classSgAsmNEFileHeader.html#63752290dabf93d5f81a0d1d931b0859">01328</a> <a class="code" href="classSgAsmGenericSection.html#06e6f2a4c28be5858d6a0b92573908d7">SgAsmNEFileHeader::parse</a>(<a class="code" href="classSgAsmDOSFileHeader.html">SgAsmDOSFileHeader</a> *dos_header)
<a name="l01329"></a>01329 {
<a name="l01330"></a>01330     ROSE_ASSERT(dos_header);
<a name="l01331"></a>01331     <a class="code" href="classSgAsmGenericFile.html">SgAsmGenericFile</a> *ef = dos_header-&gt;<a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>();
<a name="l01332"></a>01332     ROSE_ASSERT(ef);
<a name="l01333"></a>01333 
<a name="l01334"></a>01334     <span class="comment">/* NE files extend the DOS header with some additional info */</span>
<a name="l01335"></a>01335     <a class="code" href="classSgAsmDOSExtendedHeader.html">SgAsmDOSExtendedHeader</a> *dos2_header = <span class="keyword">new</span> <a class="code" href="classSgAsmDOSExtendedHeader.html">SgAsmDOSExtendedHeader</a>(dos_header);
<a name="l01336"></a>01336     dos2_header-&gt;<a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(dos_header-&gt;<a class="code" href="classSgAsmGenericSection.html#4c0fa714119712ac19d50340d62ab8f1">get_size</a>());
<a name="l01337"></a>01337     dos2_header-&gt;<a class="code" href="classSgAsmDOSExtendedHeader.html#e4678b52b247dd2ee4ff0720324e1eed">parse</a>();
<a name="l01338"></a>01338     
<a name="l01339"></a>01339     <span class="comment">/* The NE header */</span>
<a name="l01340"></a>01340     <a class="code" href="classSgAsmNEFileHeader.html">SgAsmNEFileHeader</a> *ne_header = <span class="keyword">new</span> <a class="code" href="classSgAsmNEFileHeader.html#a1713d6c8adadec02073f7f83c601286">SgAsmNEFileHeader</a>(ef, dos2_header-&gt;<a class="code" href="classSgAsmDOSExtendedHeader.html#606bd9b0d4086abbda2542b8625cb3b0">get_e_lfanew</a>());
<a name="l01341"></a>01341     ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#c9bfb0a0acc2af5ba79b2c389feadec3">set_dos2_header</a>(dos2_header);
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="comment">/* Sections defined by the NE file header */</span>
<a name="l01344"></a>01344     <span class="keywordflow">if</span> (ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#dac78a75475e9153a400717b09c1631b">get_e_resnametab_rfo</a>() &gt; 0) {
<a name="l01345"></a>01345         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> resnames_offset = ne_header-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#dac78a75475e9153a400717b09c1631b">get_e_resnametab_rfo</a>();
<a name="l01346"></a>01346         <a class="code" href="classSgAsmNENameTable.html">SgAsmNENameTable</a> *resnames = <span class="keyword">new</span> <a class="code" href="classSgAsmNENameTable.html">SgAsmNENameTable</a>(ne_header, resnames_offset);
<a name="l01347"></a>01347         resnames-&gt;<a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Resident Name Table"</span>));
<a name="l01348"></a>01348         ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#4e9e725d872287c5fbb7a7b22a3ffa65">set_resname_table</a>(resnames);
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350     <span class="keywordflow">if</span> (ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#7dcd6a17a76173fefac41a831dec1bda">get_e_modreftab_rfo</a>() &gt; 0 &amp;&amp; ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>() &gt; ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#7dcd6a17a76173fefac41a831dec1bda">get_e_modreftab_rfo</a>()) {
<a name="l01351"></a>01351         <span class="comment">/* Imported Name Table must be read before the Module Reference Table since the latter references the former. However,</span>
<a name="l01352"></a>01352 <span class="comment">         * the Imported Name Table comes immediately after the Module Reference Table and before the Entry Table in the file. */</span>
<a name="l01353"></a>01353         ROSE_ASSERT(ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>() &gt; 0);
<a name="l01354"></a>01354         ROSE_ASSERT(ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#0512f2423e03892e0c22b7abea2b9c50">get_e_entrytab_rfo</a>() &gt; ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>());
<a name="l01355"></a>01355         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> strtab_offset = ne_header-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>();
<a name="l01356"></a>01356         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> strtab_size   = ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#0512f2423e03892e0c22b7abea2b9c50">get_e_entrytab_rfo</a>() - ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>();
<a name="l01357"></a>01357         <a class="code" href="classSgAsmNEStringTable.html">SgAsmNEStringTable</a> *strtab = <span class="keyword">new</span> <a class="code" href="classSgAsmNEStringTable.html">SgAsmNEStringTable</a>(ne_header, strtab_offset, strtab_size);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359         <span class="comment">/* Module reference table */</span>
<a name="l01360"></a>01360         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> modref_offset = ne_header-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#7dcd6a17a76173fefac41a831dec1bda">get_e_modreftab_rfo</a>();
<a name="l01361"></a>01361         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> modref_size   = ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d33fe894efc30d28b8a94916b5a9342c">get_e_importnametab_rfo</a>() - ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#7dcd6a17a76173fefac41a831dec1bda">get_e_modreftab_rfo</a>();
<a name="l01362"></a>01362         <a class="code" href="classSgAsmNEModuleTable.html">SgAsmNEModuleTable</a> *modtab = <span class="keyword">new</span> <a class="code" href="classSgAsmNEModuleTable.html">SgAsmNEModuleTable</a>(ne_header, strtab, modref_offset, modref_size);
<a name="l01363"></a>01363         ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#ec36310ff07ba5f4e8390ef5e62b8812">set_module_table</a>(modtab);
<a name="l01364"></a>01364     }
<a name="l01365"></a>01365     <span class="keywordflow">if</span> (ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#0512f2423e03892e0c22b7abea2b9c50">get_e_entrytab_rfo</a>() &gt; 0 &amp;&amp; ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d93768bac6f787d34819ce351bd6791a">get_e_entrytab_size</a>() &gt; 0) {
<a name="l01366"></a>01366         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> enttab_offset = ne_header-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#0512f2423e03892e0c22b7abea2b9c50">get_e_entrytab_rfo</a>();
<a name="l01367"></a>01367         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> enttab_size = ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#d93768bac6f787d34819ce351bd6791a">get_e_entrytab_size</a>();
<a name="l01368"></a>01368         <a class="code" href="classSgAsmNEEntryTable.html">SgAsmNEEntryTable</a> *enttab = <span class="keyword">new</span> <a class="code" href="classSgAsmNEEntryTable.html">SgAsmNEEntryTable</a>(ne_header, enttab_offset, enttab_size);
<a name="l01369"></a>01369         ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#a289e304670ffb2120f2eba3f311c738">set_entry_table</a>(enttab);
<a name="l01370"></a>01370     }
<a name="l01371"></a>01371     <span class="keywordflow">if</span> (ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#8678b02791569a500172305ea6fbf97c">get_e_nonresnametab_offset</a>() &gt; 0) {
<a name="l01372"></a>01372         <a class="code" href="classSgAsmNENameTable.html">SgAsmNENameTable</a> *nonres = <span class="keyword">new</span> <a class="code" href="classSgAsmNENameTable.html">SgAsmNENameTable</a>(ne_header, ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#8678b02791569a500172305ea6fbf97c">get_e_nonresnametab_offset</a>());
<a name="l01373"></a>01373         nonres-&gt;set_name(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"NE Non-Resident Name Table"</span>));
<a name="l01374"></a>01374         ne_header-&gt;set_nonresname_table(nonres);
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     <span class="comment">/* Construct the section table and its sections (non-synthesized sections) */</span>
<a name="l01378"></a>01378     ne_header-&gt;<a class="code" href="classSgAsmNEFileHeader.html#59a910a1666d340aacd126bb6eb6dfa2">set_section_table</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmNESectionTable.html">SgAsmNESectionTable</a>(ne_header));
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="comment">// DQ (11/8/2008): Note that "enttab" appears twice as a variable name in this function (in different nested scopes)</span>
<a name="l01381"></a>01381     <span class="comment">/* NE files have multiple entry points that are defined in the Entry Table */</span>
<a name="l01382"></a>01382     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmNEEntryTable.html">SgAsmNEEntryTable</a> *enttab = ne_header-&gt;get_entry_table())
<a name="l01383"></a>01383         enttab-&gt;populate_entries();
<a name="l01384"></a>01384     
<a name="l01385"></a>01385     <span class="keywordflow">return</span> ne_header;
<a name="l01386"></a>01386 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 20 Jan 2013 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
