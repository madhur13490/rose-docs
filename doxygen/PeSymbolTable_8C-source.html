<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: PeSymbolTable.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>PeSymbolTable.C</h1><a href="PeSymbolTable_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Windows PE COFF Symbol Tables (SgAsmCoffSymbolTable and related objects) */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="sage3basic_8h.html">sage3basic.h</a>"</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">/* Constructor reads symbol table entries beginning at entry 'i'. We can't pass an array of COFFSymbolEntry_disk structs</span>
<a name="l00006"></a>00006 <span class="comment"> * because the disk size is 18 bytes, which is not properly aligned according to the C standard. Therefore we pass the actual</span>
<a name="l00007"></a>00007 <span class="comment"> * section and table index. The symbol occupies the specified table slot and st_num_aux_entries additional slots. */</span>
<a name="l00008"></a>00008 <span class="keywordtype">void</span>
<a name="l00009"></a><a class="code" href="classSgAsmCoffSymbol.html#d3cf75af6618f434eaaffecd41abd09d">00009</a> <a class="code" href="classSgAsmGenericSymbol.html#861daf906462e7c26e699ff4ced69636">SgAsmCoffSymbol::ctor</a>(<a class="code" href="classSgAsmPEFileHeader.html">SgAsmPEFileHeader</a> *fhdr, <a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *symtab, <a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *strtab, size_t idx)
<a name="l00010"></a>00010 {
<a name="l00011"></a>00011     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> debug = <span class="keyword">false</span>;
<a name="l00012"></a>00012     <a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html">COFFSymbol_disk</a> disk;
<a name="l00013"></a>00013     symtab-&gt;<a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(idx * <a class="code" href="classSgAsmCoffSymbol.html#85c9d93350d1d1ef67888f729169a83d">COFFSymbol_disk_size</a>, &amp;disk, COFFSymbol_disk_size);
<a name="l00014"></a>00014     <span class="keywordflow">if</span> (disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#946adc0608ac1dbee52ab88aaa515c31">st_zero</a> == 0) {
<a name="l00015"></a>00015         <a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#3e98e089bbf38a4439bdf6e68482194a">st_offset</a>);
<a name="l00016"></a>00016         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a> &lt; 4) <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"name collides with size field"</span>);
<a name="l00017"></a>00017         std::string s = strtab-&gt;<a class="code" href="classSgAsmGenericSection.html#2643687ed82969ef936837628f5dea71">read_content_local_str</a>(<a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a>);
<a name="l00018"></a>00018         <a class="code" href="classSgAsmGenericSymbol.html#642ec2f0fbf79c6f2653b1fd3d761943">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(s));
<a name="l00019"></a>00019     } <span class="keywordflow">else</span> {
<a name="l00020"></a>00020         <span class="keywordtype">char</span> temp[9];
<a name="l00021"></a>00021         memcpy(temp, disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#9161b7b81ff0468a0e52a1b6b0fb241c">st_name</a>, 8);
<a name="l00022"></a>00022         temp[8] = <span class="charliteral">'\0'</span>;
<a name="l00023"></a>00023         <a class="code" href="classSgAsmGenericSymbol.html#642ec2f0fbf79c6f2653b1fd3d761943">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(temp));
<a name="l00024"></a>00024         <a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a> = 0;
<a name="l00025"></a>00025     }
<a name="l00026"></a>00026 
<a name="l00027"></a>00027     <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>            = <a class="code" href="classSgAsmGenericSymbol.html#8cef0d96af06bb5e741df6a332c67e2c">get_name</a>()-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>();
<a name="l00028"></a>00028     <a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>     = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#32bbe59329652cae4ad6b1dae7a31047">st_section_num</a>);
<a name="l00029"></a>00029     <a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a>            = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#1024651741bdd5d0cce04ccbb941568d">st_type</a>);
<a name="l00030"></a>00030     <a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>   = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#c6dbce0aa5d6f05f011cdd74829e0097">st_storage_class</a>);
<a name="l00031"></a>00031     <a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#093817fdd62a95b2e900cb82309f89fd">st_num_aux_entries</a>);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     <span class="comment">/* Bind to section number. We can do this now because we've already parsed the PE Section Table */</span>
<a name="l00034"></a>00034     ROSE_ASSERT(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#6858c3658f2c9d6ffd0f8fcd247e8ca5">get_section_table</a>()!=NULL);
<a name="l00035"></a>00035     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a> &gt; 0) {
<a name="l00036"></a>00036         <a class="code" href="classSgAsmGenericSymbol.html#ec7af0082e18bfd94b69af77dcd4af57">p_bound</a> = fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>()-&gt;<a class="code" href="classSgAsmGenericFile.html#f674c04c2cb2acbb64183be4d7457989">get_section_by_id</a>(<a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>);
<a name="l00037"></a>00037         ROSE_ASSERT(<a class="code" href="classSgAsmGenericSymbol.html#ec7af0082e18bfd94b69af77dcd4af57">p_bound</a> != NULL);
<a name="l00038"></a>00038     }
<a name="l00039"></a>00039     
<a name="l00040"></a>00040     <span class="comment">/* Make initial guesses for storage class, type, and definition state. We'll adjust them after reading aux entries. */</span>
<a name="l00041"></a>00041     <a class="code" href="classSgAsmGenericSymbol.html#a044bbe0b7b989c70f60be19822d4fd1">p_value</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(disk.<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#fa59fcbed0658fccfcebccdfe8abac83">st_value</a>);
<a name="l00042"></a>00042     <a class="code" href="classSgAsmGenericSymbol.html#e207395ed850b12adb9c80c7ba4bd8c7">p_def_state</a> = <a class="code" href="classSgAsmGenericSymbol.html#e64e9dd59a83e83566671d7cad4432ef16df55db1f93a2213909c5106c310824">SYM_DEFINED</a>;
<a name="l00043"></a>00043     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>) {
<a name="l00044"></a>00044       <span class="keywordflow">case</span> 0:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0b900ce7d9f4dd3a05479e18bdf6556d3">SYM_NO_BINDING</a>; <span class="keywordflow">break</span>; <span class="comment">/*none*/</span>
<a name="l00045"></a>00045       <span class="keywordflow">case</span> 1:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*stack*/</span>
<a name="l00046"></a>00046       <span class="keywordflow">case</span> 2:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*extern*/</span>
<a name="l00047"></a>00047       <span class="keywordflow">case</span> 3:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*static*/</span>
<a name="l00048"></a>00048       <span class="keywordflow">case</span> 4:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*register*/</span>
<a name="l00049"></a>00049       <span class="keywordflow">case</span> 5:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*extern def*/</span>
<a name="l00050"></a>00050       <span class="keywordflow">case</span> 6:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*label*/</span>
<a name="l00051"></a>00051       <span class="keywordflow">case</span> 7:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*label(undef)*/</span>
<a name="l00052"></a>00052       <span class="keywordflow">case</span> 8:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*struct member*/</span>
<a name="l00053"></a>00053       <span class="keywordflow">case</span> 9:    <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*formal arg*/</span>
<a name="l00054"></a>00054       <span class="keywordflow">case</span> 10:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*struct tag*/</span>
<a name="l00055"></a>00055       <span class="keywordflow">case</span> 11:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*union member*/</span>
<a name="l00056"></a>00056       <span class="keywordflow">case</span> 12:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*union tag*/</span>
<a name="l00057"></a>00057       <span class="keywordflow">case</span> 13:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*typedef*/</span>
<a name="l00058"></a>00058       <span class="keywordflow">case</span> 14:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*static(undef)*/</span>
<a name="l00059"></a>00059       <span class="keywordflow">case</span> 15:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*enum tag*/</span>
<a name="l00060"></a>00060       <span class="keywordflow">case</span> 16:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*enum member*/</span>
<a name="l00061"></a>00061       <span class="keywordflow">case</span> 17:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*register param*/</span>
<a name="l00062"></a>00062       <span class="keywordflow">case</span> 18:   <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*bit field*/</span>
<a name="l00063"></a>00063       <span class="keywordflow">case</span> 100:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*block(bb or eb)*/</span>
<a name="l00064"></a>00064       <span class="keywordflow">case</span> 101:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*function*/</span>
<a name="l00065"></a>00065       <span class="keywordflow">case</span> 102:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*struct end*/</span>
<a name="l00066"></a>00066       <span class="keywordflow">case</span> 103:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*file*/</span>
<a name="l00067"></a>00067       <span class="keywordflow">case</span> 104:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*section*/</span>
<a name="l00068"></a>00068       <span class="keywordflow">case</span> 105:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c00d7c5f0c368b014a3c762f7ad408eabd">SYM_WEAK</a>;       <span class="keywordflow">break</span>; <span class="comment">/*weak extern*/</span>
<a name="l00069"></a>00069       <span class="keywordflow">case</span> 107:  <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c0935271c2154bab6d974640f5747a3d62">SYM_LOCAL</a>;      <span class="keywordflow">break</span>; <span class="comment">/*CLR token*/</span>
<a name="l00070"></a>00070       <span class="keywordflow">case</span> 0xff: <a class="code" href="classSgAsmGenericSymbol.html#736967670733bff5e285d3573da86b00">p_binding</a> = <a class="code" href="classSgAsmGenericSymbol.html#4957aa9672fd1498b565c12b6691d5c08187ddfe7bf87dc7f6e9433600581890">SYM_GLOBAL</a>;     <span class="keywordflow">break</span>; <span class="comment">/*end of function*/</span>
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &amp; 0xf0) {
<a name="l00073"></a>00073       <span class="keywordflow">case</span> 0x00: <a class="code" href="classSgAsmGenericSymbol.html#e5b4b4cbd8de040fe00464945cd83497">p_type</a> = <a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955c5d0720b6b3a52db7abd6ba5fda50922d">SYM_NO_TYPE</a>; <span class="keywordflow">break</span>;     <span class="comment">/*none*/</span>
<a name="l00074"></a>00074       <span class="keywordflow">case</span> 0x10: <a class="code" href="classSgAsmGenericSymbol.html#e5b4b4cbd8de040fe00464945cd83497">p_type</a> = <a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955cbceb4b8a069eb6191c2429afcae7d9fc">SYM_DATA</a>;    <span class="keywordflow">break</span>;     <span class="comment">/*ptr*/</span>
<a name="l00075"></a>00075       <span class="keywordflow">case</span> 0x20: <a class="code" href="classSgAsmGenericSymbol.html#e5b4b4cbd8de040fe00464945cd83497">p_type</a> = <a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955cf63811b9d936e39b907895e2565b553f">SYM_FUNC</a>;    <span class="keywordflow">break</span>;     <span class="comment">/*function*/</span>
<a name="l00076"></a>00076       <span class="keywordflow">case</span> 0x30: <a class="code" href="classSgAsmGenericSymbol.html#e5b4b4cbd8de040fe00464945cd83497">p_type</a> = <a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955c617865e29fe81be2b10464652d0233d4">SYM_ARRAY</a>;   <span class="keywordflow">break</span>;     <span class="comment">/*array*/</span>
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     
<a name="l00079"></a>00079     <span class="comment">/* Read additional aux entries. We keep this as 'char' to avoid alignment problems. */</span>
<a name="l00080"></a>00080     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a> &gt; 0) {
<a name="l00081"></a>00081         <a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a> = symtab-&gt;<a class="code" href="classSgAsmGenericSection.html#d28198dd7017a9d5f40f63890152de1e">read_content_local_ucl</a>((idx+1)*COFFSymbol_disk_size, <a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a> * COFFSymbol_disk_size);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmGenericSymbol.html#5e8431a123f40b27833d7926a2f59cde">get_type</a>() == <a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955cf63811b9d936e39b907895e2565b553f">SYM_FUNC</a> &amp;&amp; <a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a> &gt; 0) {
<a name="l00084"></a>00084             <span class="comment">/* Function */</span>
<a name="l00085"></a>00085             <span class="keywordtype">unsigned</span> bf_idx      = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0]));
<a name="l00086"></a>00086             <span class="keywordtype">unsigned</span> size        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[4]));
<a name="l00087"></a>00087             <span class="keywordtype">unsigned</span> lnum_ptr    = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[8]));
<a name="l00088"></a>00088             <span class="keywordtype">unsigned</span> next_fn_idx = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[12]));
<a name="l00089"></a>00089             <span class="keywordtype">unsigned</span> res1        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[16]));
<a name="l00090"></a>00090             <a class="code" href="classSgAsmGenericSymbol.html#0de7f40193a7986ac67bfe8686fb22d0">set_size</a>(size);
<a name="l00091"></a>00091             <span class="keywordflow">if</span> (debug) {
<a name="l00092"></a>00092                 fprintf(stderr, <span class="stringliteral">"COFF aux func %s: bf_idx=%u, size=%u, lnum_ptr=%u, next_fn_idx=%u, res1=%u\n"</span>, 
<a name="l00093"></a>00093                         <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str(), bf_idx, size, lnum_ptr, next_fn_idx, res1);
<a name="l00094"></a>00094             }
<a name="l00095"></a>00095             
<a name="l00096"></a>00096         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a> == 101 <span class="comment">/*function*/</span> &amp;&amp; (0 == <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.compare(<span class="stringliteral">".bf"</span>) || 0 == <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.compare(<span class="stringliteral">".ef"</span>))) {
<a name="l00097"></a>00097             <span class="comment">/* Beginning/End of function */</span>
<a name="l00098"></a>00098             <span class="keywordtype">unsigned</span> res1        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0]));
<a name="l00099"></a>00099             <span class="keywordtype">unsigned</span> lnum        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[4])); <span class="comment">/*line num within source file*/</span>
<a name="l00100"></a>00100             <span class="keywordtype">unsigned</span> res2        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[6]));
<a name="l00101"></a>00101             <span class="keywordtype">unsigned</span> res3        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[8]));
<a name="l00102"></a>00102             <span class="keywordtype">unsigned</span> next_bf     = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[12])); <span class="comment">/*only for .bf; reserved in .ef*/</span>
<a name="l00103"></a>00103             <span class="keywordtype">unsigned</span> res4        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[16]));
<a name="l00104"></a>00104             <span class="keywordflow">if</span> (debug) {
<a name="l00105"></a>00105                 fprintf(stderr, <span class="stringliteral">"COFF aux %s: res1=%u, lnum=%u, res2=%u, res3=%u, next_bf=%u, res4=%u\n"</span>, 
<a name="l00106"></a>00106                         <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str(), res1, lnum, res2, res3, next_bf, res4);
<a name="l00107"></a>00107             }
<a name="l00108"></a>00108             
<a name="l00109"></a>00109         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a> == 2<span class="comment">/*external*/</span> &amp;&amp; <a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a> == 0<span class="comment">/*undef*/</span> &amp;&amp; <a class="code" href="classSgAsmGenericSymbol.html#8064321abd72e56a26566584fc4879a6">get_value</a>()==0) {
<a name="l00110"></a>00110             <span class="comment">/* Weak External */</span>
<a name="l00111"></a>00111             <span class="keywordtype">unsigned</span> sym2_idx    = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0]));
<a name="l00112"></a>00112             <span class="keywordtype">unsigned</span> flags       = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[4]));
<a name="l00113"></a>00113             <span class="keywordtype">unsigned</span> res1        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[8]));
<a name="l00114"></a>00114             <span class="keywordtype">unsigned</span> res2        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[12]));
<a name="l00115"></a>00115             <span class="keywordtype">unsigned</span> res3        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[16]));
<a name="l00116"></a>00116             <span class="keywordflow">if</span> (debug) {
<a name="l00117"></a>00117                 fprintf(stderr, <span class="stringliteral">"COFF aux weak %s: sym2_idx=%u, flags=%u, res1=%u, res2=%u, res3=%u\n"</span>,
<a name="l00118"></a>00118                         <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str(), sym2_idx, flags, res1, res2, res3);
<a name="l00119"></a>00119             }
<a name="l00120"></a>00120             
<a name="l00121"></a>00121         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a> == 103<span class="comment">/*file*/</span> &amp;&amp; 0 == <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.compare(<span class="stringliteral">".file"</span>)) {
<a name="l00122"></a>00122             <span class="comment">/* This symbol is a file. The file name is stored in the aux data as either the name itself or an offset</span>
<a name="l00123"></a>00123 <span class="comment">             * into the string table. Replace the fake ".file" with the real file name. */</span>
<a name="l00124"></a>00124             <span class="keyword">const</span> <a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html">COFFSymbol_disk</a> *d = (<span class="keyword">const</span> <a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html">COFFSymbol_disk</a>*) &amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0]);
<a name="l00125"></a>00125             <span class="keywordflow">if</span> (0 == d-&gt;st_zero) {
<a name="l00126"></a>00126                 <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> fname_offset = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(d-&gt;st_offset);
<a name="l00127"></a>00127                 <span class="keywordflow">if</span> (fname_offset &lt; 4) <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"name collides with size field"</span>);
<a name="l00128"></a>00128                 <a class="code" href="classSgAsmGenericSymbol.html#642ec2f0fbf79c6f2653b1fd3d761943">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(strtab-&gt;<a class="code" href="classSgAsmGenericSection.html#2643687ed82969ef936837628f5dea71">read_content_local_str</a>(fname_offset)));
<a name="l00129"></a>00129                 <span class="keywordflow">if</span> (debug) {
<a name="l00130"></a>00130                     fprintf(stderr, <span class="stringliteral">"COFF aux file: offset=%"</span>PRIu64<span class="stringliteral">", name=\"%s\"\n"</span>,
<a name="l00131"></a>00131                             fname_offset, <a class="code" href="classSgAsmGenericSymbol.html#8cef0d96af06bb5e741df6a332c67e2c">get_name</a>()-&gt;get_string(<span class="keyword">true</span>).c_str());
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133             } <span class="keywordflow">else</span> {
<a name="l00134"></a>00134                 <span class="comment">/* Aux data contains a NUL-padded name; the NULs (if any) are not part of the name. */</span>
<a name="l00135"></a>00135                 ROSE_ASSERT(<a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a> == 1);
<a name="l00136"></a>00136                 <span class="keywordtype">char</span> fname[COFFSymbol_disk_size+1];
<a name="l00137"></a>00137                 memcpy(fname, &amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0]), COFFSymbol_disk_size);
<a name="l00138"></a>00138                 fname[COFFSymbol_disk_size] = <span class="charliteral">'\0'</span>;
<a name="l00139"></a>00139                 <a class="code" href="classSgAsmGenericSymbol.html#642ec2f0fbf79c6f2653b1fd3d761943">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(fname));
<a name="l00140"></a>00140                 <span class="keywordflow">if</span> (debug)
<a name="l00141"></a>00141                     fprintf(stderr, <span class="stringliteral">"COFF aux file: inline-name=\"%s\"\n"</span>, <a class="code" href="classSgAsmGenericSymbol.html#8cef0d96af06bb5e741df6a332c67e2c">get_name</a>()-&gt;get_string(<span class="keyword">true</span>).c_str());
<a name="l00142"></a>00142             }
<a name="l00143"></a>00143             <a class="code" href="classSgAsmGenericSymbol.html#6afe0d50ff4edae6288f7ae86ec94c6f">set_type</a>(<a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955cee2d029e092b140b5c12e099704a40d0">SYM_FILE</a>);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a> == 3<span class="comment">/*static*/</span> &amp;&amp; NULL != fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>()-&gt;<a class="code" href="classSgAsmGenericFile.html#759b63e0c3ed5edd2d91b392f78f60cc">get_section_by_name</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>, <span class="charliteral">'$'</span>)) {
<a name="l00146"></a>00146             <span class="comment">/* Section */</span>
<a name="l00147"></a>00147             <span class="keywordtype">unsigned</span> size         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(<a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>[0])); <span class="comment">/*same as section header SizeOfRawData */</span>
<a name="l00148"></a>00148             <span class="keywordtype">unsigned</span> nrel         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[4])); <span class="comment">/*number of relocations*/</span>
<a name="l00149"></a>00149             <span class="keywordtype">unsigned</span> nln_ents     = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[6])); <span class="comment">/*number of line number entries */</span>
<a name="l00150"></a>00150             <span class="keywordtype">unsigned</span> cksum        = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint32_t*)&amp;(p_aux_data[8]));
<a name="l00151"></a>00151             <span class="keywordtype">unsigned</span> sect_id      = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[12])); <span class="comment">/*1-base index into section table*/</span>
<a name="l00152"></a>00152             <span class="keywordtype">unsigned</span> comdat       = p_aux_data[14]; <span class="comment">/*comdat selection number if section is a COMDAT section*/</span>
<a name="l00153"></a>00153             <span class="keywordtype">unsigned</span> res1         = p_aux_data[15];
<a name="l00154"></a>00154             <span class="keywordtype">unsigned</span> res2         = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(*(uint16_t*)&amp;(p_aux_data[16]));
<a name="l00155"></a>00155             <a class="code" href="classSgAsmGenericSymbol.html#0de7f40193a7986ac67bfe8686fb22d0">set_size</a>(size);
<a name="l00156"></a>00156             <a class="code" href="classSgAsmGenericSymbol.html#6afe0d50ff4edae6288f7ae86ec94c6f">set_type</a>(<a class="code" href="classSgAsmGenericSymbol.html#25348ff5aed9d9e7c581db9d610f955c9b546b1cac735bd442ea55958de07954">SYM_SECTION</a>);
<a name="l00157"></a>00157             <span class="keywordflow">if</span> (debug) {
<a name="l00158"></a>00158                 fprintf(stderr, 
<a name="l00159"></a>00159                         <span class="stringliteral">"COFF aux section: size=%u, nrel=%u, nln_ents=%u, cksum=%u, sect_id=%u, comdat=%u, res1=%u, res2=%u\n"</span>, 
<a name="l00160"></a>00160                         size, nrel, nln_ents, cksum, sect_id, comdat, res1, res2);
<a name="l00161"></a>00161             }
<a name="l00162"></a>00162             
<a name="l00163"></a>00163         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>==3<span class="comment">/*static*/</span> &amp;&amp; (<a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &amp; 0xf)==0<span class="comment">/*null*/</span> &amp;&amp;
<a name="l00164"></a>00164                    <a class="code" href="classSgAsmGenericSymbol.html#8064321abd72e56a26566584fc4879a6">get_value</a>()==0 &amp;&amp; NULL!=fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>()-&gt;<a class="code" href="classSgAsmGenericFile.html#759b63e0c3ed5edd2d91b392f78f60cc">get_section_by_name</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>)) {
<a name="l00165"></a>00165             <span class="comment">/* COMDAT section */</span>
<a name="l00166"></a>00166             <span class="comment">/*FIXME: not implemented yet*/</span>
<a name="l00167"></a>00167             fprintf(stderr, <span class="stringliteral">"COFF aux comdat %s: (FIXME) not implemented yet\n"</span>, <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str());
<a name="l00168"></a>00168             <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(stderr, (<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>) symtab-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>()+(idx+1)*COFFSymbol_disk_size, <span class="stringliteral">"    "</span>, <a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         } <span class="keywordflow">else</span> {
<a name="l00171"></a>00171             fprintf(stderr, <span class="stringliteral">"COFF aux unknown %s: (FIXME) st_storage_class=%u, st_type=0x%02x, st_section_num=%d\n"</span>, 
<a name="l00172"></a>00172                     <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str(), <a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>, <a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a>, <a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>);
<a name="l00173"></a>00173             <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(stderr, symtab-&gt;<a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>()+(idx+1)*COFFSymbol_disk_size, <span class="stringliteral">"    "</span>, <a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>);
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="comment">/* Encode a symbol back into disk format */</span>
<a name="l00180"></a>00180 <span class="keywordtype">void</span> *
<a name="l00181"></a><a class="code" href="classSgAsmCoffSymbol.html#e8c368a5e6d06c44c8af07a5f3e78012">00181</a> <a class="code" href="classSgAsmCoffSymbol.html#e8c368a5e6d06c44c8af07a5f3e78012">SgAsmCoffSymbol::encode</a>(<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html">COFFSymbol_disk</a> *disk)<span class="keyword"> const</span>
<a name="l00182"></a>00182 <span class="keyword"></span>{
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (0 == <a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a>) {
<a name="l00184"></a>00184         <span class="comment">/* Name is stored in entry */</span>
<a name="l00185"></a>00185         memset(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#9161b7b81ff0468a0e52a1b6b0fb241c">st_name</a>, 0, <span class="keyword">sizeof</span>(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#9161b7b81ff0468a0e52a1b6b0fb241c">st_name</a>));
<a name="l00186"></a>00186         ROSE_ASSERT(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.size() &lt;= <span class="keyword">sizeof</span>(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#9161b7b81ff0468a0e52a1b6b0fb241c">st_name</a>));
<a name="l00187"></a>00187         memcpy(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#9161b7b81ff0468a0e52a1b6b0fb241c">st_name</a>, <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.c_str(), <a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>.size());
<a name="l00188"></a>00188     } <span class="keywordflow">else</span> {
<a name="l00189"></a>00189         <span class="comment">/* Name is an offset into the string table */</span>
<a name="l00190"></a>00190         disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#946adc0608ac1dbee52ab88aaa515c31">st_zero</a> = 0;
<a name="l00191"></a>00191         <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmCoffSymbol.html#26f2c2fca1a237627ff0e47ae43bbc68">p_st_name_offset</a>, &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#3e98e089bbf38a4439bdf6e68482194a">st_offset</a>));
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     
<a name="l00194"></a>00194  <span class="comment">// host_to_le(get_value(),          &amp;(disk-&gt;st_value));</span>
<a name="l00195"></a>00195     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmGenericSymbol.html#a044bbe0b7b989c70f60be19822d4fd1">p_value</a>,              &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#fa59fcbed0658fccfcebccdfe8abac83">st_value</a>));
<a name="l00196"></a>00196     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>,     &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#32bbe59329652cae4ad6b1dae7a31047">st_section_num</a>));
<a name="l00197"></a>00197     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a>,            &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#1024651741bdd5d0cce04ccbb941568d">st_type</a>));
<a name="l00198"></a>00198     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>,   &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#c6dbce0aa5d6f05f011cdd74829e0097">st_storage_class</a>));
<a name="l00199"></a>00199     <a class="code" href="classSgAsmExecutableFileFormat.html#c3659677b8e31f8bfd99434c3beb7c29">host_to_le</a>(<a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a>, &amp;(disk-&gt;<a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html#093817fdd62a95b2e900cb82309f89fd">st_num_aux_entries</a>));
<a name="l00200"></a>00200     <span class="keywordflow">return</span> disk;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <span class="comment">/* Print some debugging info */</span>
<a name="l00204"></a>00204 <span class="keywordtype">void</span>
<a name="l00205"></a><a class="code" href="classSgAsmCoffSymbol.html#83cf74afabe12d27a64ddb41d176e67f">00205</a> <a class="code" href="classSgAsmCoffSymbol.html#83cf74afabe12d27a64ddb41d176e67f">SgAsmCoffSymbol::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00206"></a>00206 <span class="keyword"></span>{
<a name="l00207"></a>00207     <span class="keywordtype">char</span> p[4096], ss[128], tt[128];
<a name="l00208"></a>00208     <span class="keyword">const</span> <span class="keywordtype">char</span> *s=NULL, *t=NULL;
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00210"></a>00210         sprintf(p, <span class="stringliteral">"%sCOFFSymbol[%zd]."</span>, prefix, idx);
<a name="l00211"></a>00211     } <span class="keywordflow">else</span> {
<a name="l00212"></a>00212         sprintf(p, <span class="stringliteral">"%sCOFFSymbol."</span>, prefix);
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <a class="code" href="classSgAsmGenericSymbol.html#edaac505ee94e672ad5fcef5fb3ee513">SgAsmGenericSymbol::dump</a>(f, p, -1);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>) {
<a name="l00221"></a>00221       <span class="keywordflow">case</span> 0:  s = <span class="stringliteral">"external, not assigned"</span>;    <span class="keywordflow">break</span>;
<a name="l00222"></a>00222       <span class="keywordflow">case</span> -1: s = <span class="stringliteral">"absolute value"</span>;            <span class="keywordflow">break</span>;
<a name="l00223"></a>00223       <span class="keywordflow">case</span> -2: s = <span class="stringliteral">"general debug, no section"</span>; <span class="keywordflow">break</span>;
<a name="l00224"></a>00224       <span class="keywordflow">default</span>: sprintf(ss, <span class="stringliteral">"%d"</span>, <a class="code" href="classSgAsmCoffSymbol.html#c2f537f72ee4572544825b08815e7672">p_st_section_num</a>); s = ss; <span class="keywordflow">break</span>;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     fprintf(f, <span class="stringliteral">"%s%-*s = %s\n"</span>, p, w, <span class="stringliteral">"st_section_num"</span>, s);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &amp; 0xf0) {
<a name="l00229"></a>00229       <span class="keywordflow">case</span> 0x00: s = <span class="stringliteral">"none"</span>;     <span class="keywordflow">break</span>;
<a name="l00230"></a>00230       <span class="keywordflow">case</span> 0x10: s = <span class="stringliteral">"pointer"</span>;  <span class="keywordflow">break</span>;
<a name="l00231"></a>00231       <span class="keywordflow">case</span> 0x20: s = <span class="stringliteral">"function"</span>; <span class="keywordflow">break</span>;
<a name="l00232"></a>00232       <span class="keywordflow">case</span> 0x30: s = <span class="stringliteral">"array"</span>;    <span class="keywordflow">break</span>;
<a name="l00233"></a>00233       <span class="keywordflow">default</span>:
<a name="l00234"></a>00234         sprintf(ss, <span class="stringliteral">"%u"</span>, <a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &gt;&gt; 8);
<a name="l00235"></a>00235         s = ss;
<a name="l00236"></a>00236         <span class="keywordflow">break</span>;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &amp; 0xf) {
<a name="l00239"></a>00239       <span class="keywordflow">case</span> 0x00: t = <span class="stringliteral">"none"</span>;            <span class="keywordflow">break</span>;
<a name="l00240"></a>00240       <span class="keywordflow">case</span> 0x01: t = <span class="stringliteral">"void"</span>;            <span class="keywordflow">break</span>;
<a name="l00241"></a>00241       <span class="keywordflow">case</span> 0x02: t = <span class="stringliteral">"char"</span>;            <span class="keywordflow">break</span>;
<a name="l00242"></a>00242       <span class="keywordflow">case</span> 0x03: t = <span class="stringliteral">"short"</span>;           <span class="keywordflow">break</span>;
<a name="l00243"></a>00243       <span class="keywordflow">case</span> 0x04: t = <span class="stringliteral">"int"</span>;             <span class="keywordflow">break</span>;
<a name="l00244"></a>00244       <span class="keywordflow">case</span> 0x05: t = <span class="stringliteral">"long"</span>;            <span class="keywordflow">break</span>;
<a name="l00245"></a>00245       <span class="keywordflow">case</span> 0x06: t = <span class="stringliteral">"float"</span>;           <span class="keywordflow">break</span>;
<a name="l00246"></a>00246       <span class="keywordflow">case</span> 0x07: t = <span class="stringliteral">"double"</span>;          <span class="keywordflow">break</span>;
<a name="l00247"></a>00247       <span class="keywordflow">case</span> 0x08: t = <span class="stringliteral">"struct"</span>;          <span class="keywordflow">break</span>;
<a name="l00248"></a>00248       <span class="keywordflow">case</span> 0x09: t = <span class="stringliteral">"union"</span>;           <span class="keywordflow">break</span>;
<a name="l00249"></a>00249       <span class="keywordflow">case</span> 0x0a: t = <span class="stringliteral">"enum"</span>;            <span class="keywordflow">break</span>;
<a name="l00250"></a>00250       <span class="keywordflow">case</span> 0x0b: t = <span class="stringliteral">"enum member"</span>;     <span class="keywordflow">break</span>;
<a name="l00251"></a>00251       <span class="keywordflow">case</span> 0x0c: t = <span class="stringliteral">"byte"</span>;            <span class="keywordflow">break</span>;
<a name="l00252"></a>00252       <span class="keywordflow">case</span> 0x0d: t = <span class="stringliteral">"2-byte word"</span>;     <span class="keywordflow">break</span>;
<a name="l00253"></a>00253       <span class="keywordflow">case</span> 0x0e: t = <span class="stringliteral">"unsigned int"</span>;    <span class="keywordflow">break</span>;
<a name="l00254"></a>00254       <span class="keywordflow">case</span> 0x0f: t = <span class="stringliteral">"4-byte unsigned"</span>; <span class="keywordflow">break</span>;
<a name="l00255"></a>00255       <span class="keywordflow">default</span>:
<a name="l00256"></a>00256         sprintf(tt, <span class="stringliteral">"%u"</span>, <a class="code" href="classSgAsmCoffSymbol.html#f8e1e7cb0857404cdb9b31301017633d">p_st_type</a> &amp; 0xf);
<a name="l00257"></a>00257         t = tt;
<a name="l00258"></a>00258         <span class="keywordflow">break</span>;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     fprintf(f, <span class="stringliteral">"%s%-*s = %s / %s\n"</span>,          p, w, <span class="stringliteral">"st_type"</span>, s, t);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">switch</span> (<a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>) {
<a name="l00263"></a>00263       <span class="keywordflow">case</span> 0:    s = <span class="stringliteral">"none"</span>;            t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00264"></a>00264       <span class="keywordflow">case</span> 1:    s = <span class="stringliteral">"auto variable"</span>;   t = <span class="stringliteral">"stack frame offset"</span>;                <span class="keywordflow">break</span>;
<a name="l00265"></a>00265       <span class="keywordflow">case</span> 2:    s = <span class="stringliteral">"external"</span>;        t = <span class="stringliteral">"size or section offset"</span>;            <span class="keywordflow">break</span>;
<a name="l00266"></a>00266       <span class="keywordflow">case</span> 3:    s = <span class="stringliteral">"static"</span>;          t = <span class="stringliteral">"offset in section or section name"</span>; <span class="keywordflow">break</span>;
<a name="l00267"></a>00267       <span class="keywordflow">case</span> 4:    s = <span class="stringliteral">"register"</span>;        t = <span class="stringliteral">"register number"</span>;                   <span class="keywordflow">break</span>;
<a name="l00268"></a>00268       <span class="keywordflow">case</span> 5:    s = <span class="stringliteral">"extern_def"</span>;      t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00269"></a>00269       <span class="keywordflow">case</span> 6:    s = <span class="stringliteral">"label"</span>;           t = <span class="stringliteral">"offset in section"</span>;                 <span class="keywordflow">break</span>;
<a name="l00270"></a>00270       <span class="keywordflow">case</span> 7:    s = <span class="stringliteral">"label(undef)"</span>;    t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00271"></a>00271       <span class="keywordflow">case</span> 8:    s = <span class="stringliteral">"struct member"</span>;   t = <span class="stringliteral">"member number"</span>;                     <span class="keywordflow">break</span>;
<a name="l00272"></a>00272       <span class="keywordflow">case</span> 9:    s = <span class="stringliteral">"formal arg"</span>;      t = <span class="stringliteral">"argument number"</span>;                   <span class="keywordflow">break</span>;
<a name="l00273"></a>00273       <span class="keywordflow">case</span> 10:   s = <span class="stringliteral">"struct tag"</span>;      t = <span class="stringliteral">"tag name"</span>;                          <span class="keywordflow">break</span>;
<a name="l00274"></a>00274       <span class="keywordflow">case</span> 11:   s = <span class="stringliteral">"union member"</span>;    t = <span class="stringliteral">"member number"</span>;                     <span class="keywordflow">break</span>;
<a name="l00275"></a>00275       <span class="keywordflow">case</span> 12:   s = <span class="stringliteral">"union tag"</span>;       t = <span class="stringliteral">"tag name"</span>;                          <span class="keywordflow">break</span>;
<a name="l00276"></a>00276       <span class="keywordflow">case</span> 13:   s = <span class="stringliteral">"typedef"</span>;         t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00277"></a>00277       <span class="keywordflow">case</span> 14:   s = <span class="stringliteral">"static(undef)"</span>;   t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00278"></a>00278       <span class="keywordflow">case</span> 15:   s = <span class="stringliteral">"enum tag"</span>;        t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00279"></a>00279       <span class="keywordflow">case</span> 16:   s = <span class="stringliteral">"enum member"</span>;     t = <span class="stringliteral">"member number"</span>;                     <span class="keywordflow">break</span>;
<a name="l00280"></a>00280       <span class="keywordflow">case</span> 17:   s = <span class="stringliteral">"register param"</span>;  t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00281"></a>00281       <span class="keywordflow">case</span> 18:   s = <span class="stringliteral">"bit field"</span>;       t = <span class="stringliteral">"bit number"</span>;                        <span class="keywordflow">break</span>;
<a name="l00282"></a>00282       <span class="keywordflow">case</span> 19:   s = <span class="stringliteral">"auto arg"</span>;        t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00283"></a>00283       <span class="keywordflow">case</span> 20:   s = <span class="stringliteral">"dummy entry (EOB)"</span>; t=<span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00284"></a>00284       <span class="keywordflow">case</span> 100:  s = <span class="stringliteral">"block(bb,eb)"</span>;    t = <span class="stringliteral">"relocatable address"</span>;               <span class="keywordflow">break</span>;
<a name="l00285"></a>00285       <span class="keywordflow">case</span> 101:  s = <span class="stringliteral">"function"</span>;        t = <span class="stringliteral">"nlines or size"</span>;                    <span class="keywordflow">break</span>;
<a name="l00286"></a>00286       <span class="keywordflow">case</span> 102:  s = <span class="stringliteral">"struct end"</span>;      t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00287"></a>00287       <span class="keywordflow">case</span> 103:  s = <span class="stringliteral">"file"</span>;            t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00288"></a>00288       <span class="keywordflow">case</span> 104:  s = <span class="stringliteral">"section/line#"</span>;   t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00289"></a>00289       <span class="keywordflow">case</span> 105:  s = <span class="stringliteral">"weak extern"</span>;     t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00290"></a>00290       <span class="keywordflow">case</span> 106:  s = <span class="stringliteral">"ext in dmert pub lib"</span>;t=<span class="stringliteral">""</span>;                                <span class="keywordflow">break</span>;
<a name="l00291"></a>00291       <span class="keywordflow">case</span> 107:  s = <span class="stringliteral">"CLR token"</span>;       t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00292"></a>00292       <span class="keywordflow">case</span> 0xff: s = <span class="stringliteral">"end of function"</span>; t = <span class="stringliteral">""</span>;                                  <span class="keywordflow">break</span>;
<a name="l00293"></a>00293       <span class="keywordflow">default</span>:
<a name="l00294"></a>00294         sprintf(ss, <span class="stringliteral">"%u"</span>, <a class="code" href="classSgAsmCoffSymbol.html#ede2d27e7b02d8d90497cb624137eaa1">p_st_storage_class</a>);
<a name="l00295"></a>00295         s = ss;
<a name="l00296"></a>00296         t = <span class="stringliteral">""</span>;  
<a name="l00297"></a>00297         <span class="keywordflow">break</span>;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299     fprintf(f, <span class="stringliteral">"%s%-*s = %s\n"</span>,               p, w, <span class="stringliteral">"st_storage_class"</span>, s);
<a name="l00300"></a>00300     fprintf(f, <span class="stringliteral">"%s%-*s = \"%s\"\n"</span>,           p, w, <span class="stringliteral">"st_name"</span>, <a class="code" href="escape_8h.html#fe2eed2102b5e1df8cf454304111f5ca">escapeString</a>(<a class="code" href="classSgAsmCoffSymbol.html#50cca8a92045805655d54bbc5a049d6a">p_st_name</a>).c_str());
<a name="l00301"></a>00301     fprintf(f, <span class="stringliteral">"%s%-*s = %u\n"</span>,               p, w, <span class="stringliteral">"st_num_aux_entries"</span>, <a class="code" href="classSgAsmCoffSymbol.html#20f273b9f38f31454f31fb56a29632da">p_st_num_aux_entries</a>);
<a name="l00302"></a>00302     fprintf(f, <span class="stringliteral">"%s%-*s = %zu bytes\n"</span>,        p, w, <span class="stringliteral">"aux_data"</span>, <a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>.size());
<a name="l00303"></a>00303     <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(f, 0, std::string(p)+<span class="stringliteral">"aux_data at "</span>, <a class="code" href="classSgAsmCoffSymbol.html#ed157d662af5ca3eee90d35d0803f909">p_aux_data</a>);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/* Constructor */</span>
<a name="l00307"></a>00307 <span class="keywordtype">void</span>
<a name="l00308"></a><a class="code" href="classSgAsmCoffSymbolTable.html#653c6e57ffe74c23cfa0ce9366882968">00308</a> <a class="code" href="classSgAsmCoffSymbolTable.html#653c6e57ffe74c23cfa0ce9366882968">SgAsmCoffSymbolTable::ctor</a>()
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00311"></a>00311     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"COFF Symbols"</span>));
<a name="l00312"></a>00312     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99bff8d9d960328227dc80f33f937ad3974">SP_SYMTAB</a>);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a> = <span class="keyword">new</span> <a class="code" href="classSgAsmCoffSymbolList.html">SgAsmCoffSymbolList</a>;
<a name="l00315"></a>00315     <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(<span class="keyword">this</span>);
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <a class="code" href="classSgAsmCoffSymbolTable.html">SgAsmCoffSymbolTable</a>*
<a name="l00319"></a><a class="code" href="classSgAsmCoffSymbolTable.html#43faa0ec0c268afb991868cb4464ef51">00319</a> <a class="code" href="classSgAsmCoffSymbolTable.html#43faa0ec0c268afb991868cb4464ef51">SgAsmCoffSymbolTable::parse</a>()
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="comment">/* Set the section size according to the number of entries indicated in the header. */</span>
<a name="l00322"></a>00322     <a class="code" href="classSgAsmPEFileHeader.html">SgAsmPEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmPEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00323"></a>00323     ROSE_ASSERT(fhdr!=NULL);
<a name="l00324"></a>00324     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#b3514a58aaaf140d5832e54324a932dc">get_e_coff_symtab</a>());
<a name="l00325"></a>00325     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5fbafa70d9ea34540ddbe0b27769c1c0">get_e_coff_nsyms</a>()*<a class="code" href="classSgAsmCoffSymbol.html#85c9d93350d1d1ef67888f729169a83d">SgAsmCoffSymbol::COFFSymbol_disk_size</a>);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <a class="code" href="classSgAsmGenericSection.html#06e6f2a4c28be5858d6a0b92573908d7">SgAsmGenericSection::parse</a>();
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">/* The string table immediately follows the symbols. The first four bytes of the string table are the size of the</span>
<a name="l00330"></a>00330 <span class="comment">     * string table in little endian. */</span>
<a name="l00331"></a>00331     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> strtab_offset = <a class="code" href="classSgAsmGenericSection.html#c260c8a8e746f7c854fa0b3c82d6d9d9">get_offset</a>() + fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5fbafa70d9ea34540ddbe0b27769c1c0">get_e_coff_nsyms</a>() * <a class="code" href="classSgAsmCoffSymbol.html#85c9d93350d1d1ef67888f729169a83d">SgAsmCoffSymbol::COFFSymbol_disk_size</a>;
<a name="l00332"></a>00332     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a> = <span class="keyword">new</span> <a class="code" href="classSgAsmGenericSection.html#cc540197e82d28a250a847aa70841df9">SgAsmGenericSection</a>(fhdr-&gt;<a class="code" href="classSgAsmGenericSection.html#3fd79ae169d298678808d6a07223de9a">get_file</a>(), fhdr);
<a name="l00333"></a>00333     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(strtab_offset);
<a name="l00334"></a>00334     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(<span class="keyword">sizeof</span>(uint32_t));
<a name="l00335"></a>00335     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">true</span>);
<a name="l00336"></a>00336     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(<span class="stringliteral">"COFF Symbol Strtab"</span>));
<a name="l00337"></a>00337     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99b5e4e227781163a73c3c08731e7a14f1e">SP_HEADER</a>);
<a name="l00338"></a>00338     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#06e6f2a4c28be5858d6a0b92573908d7">parse</a>();
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     uint32_t word;
<a name="l00341"></a>00341     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#7972615a2b9efd779655979b82b7b159">read_content</a>(0, &amp;word, <span class="keyword">sizeof</span> word);
<a name="l00342"></a>00342     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> strtab_size = <a class="code" href="classSgAsmExecutableFileFormat.html#87d4a6e97840dbea08194244feb4ca10">le_to_host</a>(word);
<a name="l00343"></a>00343     <span class="keywordflow">if</span> (strtab_size &lt; <span class="keyword">sizeof</span>(uint32_t))
<a name="l00344"></a>00344         <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"COFF symbol table string table size is less than four bytes"</span>);
<a name="l00345"></a>00345     <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>-&gt;<a class="code" href="classSgAsmGenericSection.html#1dc042ecd1817c173defc09cbd17bb55">extend</a>(strtab_size - <span class="keyword">sizeof</span>(uint32_t));
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">/* Parse symbols until we've parsed the required number or we run off the end of the section. */</span>
<a name="l00348"></a>00348     <span class="keywordflow">for</span> (size_t i = 0; i &lt; fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5fbafa70d9ea34540ddbe0b27769c1c0">get_e_coff_nsyms</a>(); i++) {
<a name="l00349"></a>00349         <span class="keywordflow">try</span> {
<a name="l00350"></a>00350             <a class="code" href="classSgAsmCoffSymbol.html">SgAsmCoffSymbol</a> *symbol = <span class="keyword">new</span> <a class="code" href="classSgAsmCoffSymbol.html">SgAsmCoffSymbol</a>(fhdr, <span class="keyword">this</span>, <a class="code" href="classSgAsmCoffSymbolTable.html#db7aeed61e9cd3b324d9dc663f843d45">p_strtab</a>, i);
<a name="l00351"></a>00351             i += symbol-&gt;get_st_num_aux_entries();
<a name="l00352"></a>00352             <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>().push_back(symbol);
<a name="l00353"></a>00353         } <span class="keywordflow">catch</span> (<span class="keyword">const</span> ShortRead &amp;e) {
<a name="l00354"></a>00354             fprintf(stderr, <span class="stringliteral">"SgAsmCoffSymbolTable::parse: warning: read past end of section \"%s\" [%d]\n"</span>
<a name="l00355"></a>00355                     <span class="stringliteral">"    symbol #%zu at file offset 0x%08"</span>PRIx64<span class="stringliteral">"\n"</span>
<a name="l00356"></a>00356                     <span class="stringliteral">"    skipping %zu symbols (including this one)\n"</span>,
<a name="l00357"></a>00357                     <a class="code" href="classSgAsmGenericSection.html#51a0421548dbe52e9f2dd06a0ba8d4a9">get_name</a>()-&gt;get_string(<span class="keyword">true</span>).c_str(), <a class="code" href="classSgAsmGenericSection.html#3affce63e89687a490938dde931e7125">get_id</a>(),
<a name="l00358"></a>00358                     i, e.offset,
<a name="l00359"></a>00359                     fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5fbafa70d9ea34540ddbe0b27769c1c0">get_e_coff_nsyms</a>()-i);
<a name="l00360"></a>00360             <span class="keywordflow">break</span>;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00369"></a>00369 size_t
<a name="l00370"></a><a class="code" href="classSgAsmCoffSymbolTable.html#cf0530eacccb869236f22ef5e9590ea6">00370</a> <a class="code" href="classSgAsmCoffSymbolTable.html#cf0530eacccb869236f22ef5e9590ea6">SgAsmCoffSymbolTable::get_nslots</a>()<span class="keyword"> const</span>
<a name="l00371"></a>00371 <span class="keyword"></span>{
<a name="l00372"></a>00372     size_t nsyms = <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>().size();
<a name="l00373"></a>00373     size_t nslots = nsyms;
<a name="l00374"></a>00374     <span class="keywordflow">for</span> (size_t i=0; i&lt;nsyms; i++) {
<a name="l00375"></a>00375         <a class="code" href="classSgAsmCoffSymbol.html">SgAsmCoffSymbol</a> *symbol = <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>()[i];
<a name="l00376"></a>00376         nslots += symbol-&gt;get_st_num_aux_entries();
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378     <span class="keywordflow">return</span> nslots;
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 <span class="comment">/* Write symbol table back to disk */</span>
<a name="l00382"></a>00382 <span class="keywordtype">void</span>
<a name="l00383"></a><a class="code" href="classSgAsmCoffSymbolTable.html#e3bbb83a33e39fb46c1c6a656d5083d1">00383</a> <a class="code" href="classSgAsmCoffSymbolTable.html#e3bbb83a33e39fb46c1c6a656d5083d1">SgAsmCoffSymbolTable::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00384"></a>00384 <span class="keyword"></span>{
<a name="l00385"></a>00385     <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos = 0; <span class="comment">/*section offset*/</span>
<a name="l00386"></a>00386     
<a name="l00387"></a>00387     <span class="keywordflow">for</span> (size_t i=0; i &lt; <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>().size(); i++) {
<a name="l00388"></a>00388         <a class="code" href="classSgAsmCoffSymbol.html">SgAsmCoffSymbol</a> *symbol = <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>()[i];
<a name="l00389"></a>00389         <a class="code" href="structSgAsmCoffSymbol_1_1COFFSymbol__disk.html">SgAsmCoffSymbol::COFFSymbol_disk</a> disk;
<a name="l00390"></a>00390         symbol-&gt;encode(&amp;disk);
<a name="l00391"></a>00391         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, <a class="code" href="classSgAsmCoffSymbol.html#85c9d93350d1d1ef67888f729169a83d">SgAsmCoffSymbol::COFFSymbol_disk_size</a>, &amp;disk);
<a name="l00392"></a>00392         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, (<a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>) spos, symbol-&gt;get_aux_data());
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbolTable.html#6c645585d4e9613f36804ad70b7c9b57">get_strtab</a>())
<a name="l00395"></a>00395         <a class="code" href="classSgAsmCoffSymbolTable.html#6c645585d4e9613f36804ad70b7c9b57">get_strtab</a>()-&gt;<a class="code" href="classSgAsmGenericSection.html#7452213ee05e2fdc50589d10a57d7763">unparse</a>(f);
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">/* Print some debugging info */</span>
<a name="l00399"></a>00399 <span class="keywordtype">void</span>
<a name="l00400"></a><a class="code" href="classSgAsmCoffSymbolTable.html#83cbb9e4ba78234d15a0b1de4e75e7f6">00400</a> <a class="code" href="classSgAsmCoffSymbolTable.html#83cbb9e4ba78234d15a0b1de4e75e7f6">SgAsmCoffSymbolTable::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00401"></a>00401 <span class="keyword"></span>{
<a name="l00402"></a>00402     <span class="keywordtype">char</span> p[4096];
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00404"></a>00404         sprintf(p, <span class="stringliteral">"%sCOFFSymtab[%zd]."</span>, prefix, idx);
<a name="l00405"></a>00405     } <span class="keywordflow">else</span> {
<a name="l00406"></a>00406         sprintf(p, <span class="stringliteral">"%sCOFFSymtab."</span>, prefix);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00413"></a>00413     fprintf(f, <span class="stringliteral">"%s%-*s = %zu symbols\n"</span>, p, w, <span class="stringliteral">"size"</span>, <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>().size());
<a name="l00414"></a>00414     <span class="keywordflow">for</span> (size_t i = 0; i &lt; <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>().size(); i++) {
<a name="l00415"></a>00415         <a class="code" href="classSgAsmCoffSymbolTable.html#a54af6133f8eb06d1adb4966760b99ba">p_symbols</a>-&gt;<a class="code" href="classSgAsmCoffSymbolList.html#99bdd0304e1061727edc840ca884aeed">get_symbols</a>()[i]-&gt;dump(f, p, i);
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmCoffSymbolTable.html#3ebe932fa7c7d985b8c07eec35ce9a08">variantT</a>() == <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464ed614a7734690a6118bd9956bc49ef5c">V_SgAsmCoffSymbolTable</a>) <span class="comment">//unless a base class</span>
<a name="l00419"></a>00419         <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(f, 0, std::string(p)+<span class="stringliteral">"data at "</span>, <a class="code" href="classSgAsmGenericSection.html#96573fffe8f4f825c56ead24cc89a474">p_data</a>);
<a name="l00420"></a>00420 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 20 Jan 2013 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
