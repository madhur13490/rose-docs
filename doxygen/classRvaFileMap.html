<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: RvaFileMap Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>RvaFileMap Class Reference</h1><!-- doxytag: class="RvaFileMap" --><code>#include &lt;<a class="el" href="RvaFileMap_8h-source.html">RvaFileMap.h</a>&gt;</code>
<p>
<a href="classRvaFileMap-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
An <a class="el" href="classRvaFileMap.html">RvaFileMap</a> is an efficient mapping from relative virtual addresses to file offsets. The mapping can be built piecemeal and the data structure will coalesce adjacent memory areas (provided they are also adjacent in the file). If an attempt is made to define a mapping from one virtual address to multiple file offsets then an exception is raised. We also store a base virtual address to make computations that use non-relative virtual addresses easier. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#f65e2c44e33bcff926bf219c52ed8353">RvaFileMap</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#edbebf4de7eb9b332317abfb1d061b2c">RvaFileMap</a> (<a class="el" href="classSgAsmGenericHeader.html">SgAsmGenericHeader</a> *header)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#6ca18e907cb0dd715027646ff936a7b6">insertMappedSections</a> (<a class="el" href="classSgAsmGenericHeader.html">SgAsmGenericHeader</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#7fc2a285cba713139326fb3c7a0d2800">insert</a> (<a class="el" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#29a021dac3ef0411b0918b967e24882c">insert</a> (<a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> elmt)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#d3c7291ed617d31e94a2f23191d3c5a8">erase</a> (<a class="el" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#7f28c5679749ce829966bc0479a9f839">erase</a> (<a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> elmt)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#87cf9181af8e268cf9b13a403906fdc2">findRVA</a> (<a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> rva) const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#78f6d0285acd4fb2934b8bbdd5f14e95">findVA</a> (<a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> va) const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const std::vector&lt; <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &gt; &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#8dbf4ab2bd6456f2a7a35db5dbc6361d">get_elements</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#f1ec85d40dfdcbd57ca4a731f95171d3">get_base_va</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#43b240892229b0ad9c7912f019343f85">read</a> (unsigned char *dst_buf, const unsigned char *src_buf, <a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> start_va, size_t desired) const </td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#891fa5e18cd18931eaf71566424793f7">consistent</a> (const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &amp;a, const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &amp;b)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#312f2f2b7ca17d308c334b09fb403756">sorted</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::vector&lt; <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#3d113919ff3b655dc7a5c74de85f0fd0">elements</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap.html#3780d8ac5d30c5be0c27973533efb2f5">base_va</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structRvaFileMap_1_1Exception.html">Exception</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="f65e2c44e33bcff926bf219c52ed8353"></a><!-- doxytag: member="RvaFileMap::RvaFileMap" ref="f65e2c44e33bcff926bf219c52ed8353" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RvaFileMap::RvaFileMap           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="edbebf4de7eb9b332317abfb1d061b2c"></a><!-- doxytag: member="RvaFileMap::RvaFileMap" ref="edbebf4de7eb9b332317abfb1d061b2c" args="(SgAsmGenericHeader *header)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RvaFileMap::RvaFileMap           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSgAsmGenericHeader.html">SgAsmGenericHeader</a> *&nbsp;</td>
          <td class="paramname"> <em>header</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="891fa5e18cd18931eaf71566424793f7"></a><!-- doxytag: member="RvaFileMap::consistent" ref="891fa5e18cd18931eaf71566424793f7" args="(const MapElement &amp;a, const MapElement &amp;b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool RvaFileMap::consistent           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns true only if <code>a</code> and <code>b</code> are separated by the same distance in memory as they are in the file. If <code>a</code> and <code>b</code> overlap and this function returns false, then at least one virtual address is being mapped to two file offsets. 
</div>
</div><p>
<a class="anchor" name="6ca18e907cb0dd715027646ff936a7b6"></a><!-- doxytag: member="RvaFileMap::insertMappedSections" ref="6ca18e907cb0dd715027646ff936a7b6" args="(SgAsmGenericHeader *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RvaFileMap::insertMappedSections           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSgAsmGenericHeader.html">SgAsmGenericHeader</a> *&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Inserts mappings for all mapped sections reachable by the specified file header, including the file header itself if it is mapped. 
</div>
</div><p>
<a class="anchor" name="7fc2a285cba713139326fb3c7a0d2800"></a><!-- doxytag: member="RvaFileMap::insert" ref="7fc2a285cba713139326fb3c7a0d2800" args="(SgAsmGenericSection *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RvaFileMap::insert           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Insert the specified section. If the section is not mapped then nothing is inserted. An exception is thrown if the operation would cause a relative virtual address to be mapped to multiple file offsets. Note that if an exception is thrown this <a class="el" href="classRvaFileMap.html">RvaFileMap</a> might be modified anyway. 
</div>
</div><p>
<a class="anchor" name="29a021dac3ef0411b0918b967e24882c"></a><!-- doxytag: member="RvaFileMap::insert" ref="29a021dac3ef0411b0918b967e24882c" args="(MapElement elmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RvaFileMap::insert           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>&nbsp;</td>
          <td class="paramname"> <em>elmt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Insert the specified map element. 
</div>
</div><p>
<a class="anchor" name="d3c7291ed617d31e94a2f23191d3c5a8"></a><!-- doxytag: member="RvaFileMap::erase" ref="d3c7291ed617d31e94a2f23191d3c5a8" args="(SgAsmGenericSection *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RvaFileMap::erase           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erases parts of the mapping that correspond to the virtual addresses of the specified section. If the section is not mapped then nothing is erased. It is possible to erase a unit of address space that was does not correspond precisely to a similar add() call. 
</div>
</div><p>
<a class="anchor" name="7f28c5679749ce829966bc0479a9f839"></a><!-- doxytag: member="RvaFileMap::erase" ref="7f28c5679749ce829966bc0479a9f839" args="(MapElement elmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RvaFileMap::erase           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>&nbsp;</td>
          <td class="paramname"> <em>elmt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erase parts of the mapping that correspond to the specified virtual address range. The addresses to be erased don't necessarily need to correspond to a similar add() call; for instance, it's possible to add a large address space and then erase parts of it to make holes. 
</div>
</div><p>
<a class="anchor" name="87cf9181af8e268cf9b13a403906fdc2"></a><!-- doxytag: member="RvaFileMap::findRVA" ref="87cf9181af8e268cf9b13a403906fdc2" args="(rose_addr_t rva) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>* RvaFileMap::findRVA           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>rva</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Search for the specified relative virtual address and return the map element that contains it. Returns null if the address is not mapped. 
</div>
</div><p>
<a class="anchor" name="78f6d0285acd4fb2934b8bbdd5f14e95"></a><!-- doxytag: member="RvaFileMap::findVA" ref="78f6d0285acd4fb2934b8bbdd5f14e95" args="(rose_addr_t va) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>* RvaFileMap::findVA           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>va</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Search for the specified virtual address and return the map element that contains it. Note that the map element has a _relative_ virtual address rather than a virtual address, and in order to get the virtual address the caller must add the value returned by the <a class="el" href="classRvaFileMap.html#f1ec85d40dfdcbd57ca4a731f95171d3">RvaFileMap::get_base_va()</a> method. 
</div>
</div><p>
<a class="anchor" name="8dbf4ab2bd6456f2a7a35db5dbc6361d"></a><!-- doxytag: member="RvaFileMap::get_elements" ref="8dbf4ab2bd6456f2a7a35db5dbc6361d" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::vector&lt;<a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>&gt;&amp; RvaFileMap::get_elements           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the currently defined map elements. 
</div>
</div><p>
<a class="anchor" name="f1ec85d40dfdcbd57ca4a731f95171d3"></a><!-- doxytag: member="RvaFileMap::get_base_va" ref="f1ec85d40dfdcbd57ca4a731f95171d3" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> RvaFileMap::get_base_va           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the base virtual address used to calculate the relative virtual addresses in the mappings. 
</div>
</div><p>
<a class="anchor" name="43b240892229b0ad9c7912f019343f85"></a><!-- doxytag: member="RvaFileMap::read" ref="43b240892229b0ad9c7912f019343f85" args="(unsigned char *dst_buf, const unsigned char *src_buf, rose_addr_t start_va, size_t desired) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t RvaFileMap::read           </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>dst_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&nbsp;</td>
          <td class="paramname"> <em>src_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>&nbsp;</td>
          <td class="paramname"> <em>start_va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>desired</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copies data from a contiguous region of the virtual address space into a user supplied buffer. The portion of the virtual address space to copy begins at <code>start_va</code> and continues for <code>desired</code> bytes. The data is copied from the <code>src_buf</code> to the <code>dst_buf</code> buffers. The return value is the number of bytes that were copied, which might be fewer than the number of bytes desired if the mapping does not include part of the address space requested. 
</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="312f2f2b7ca17d308c334b09fb403756"></a><!-- doxytag: member="RvaFileMap::sorted" ref="312f2f2b7ca17d308c334b09fb403756" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classRvaFileMap.html#312f2f2b7ca17d308c334b09fb403756">RvaFileMap::sorted</a><code> [mutable, private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3d113919ff3b655dc7a5c74de85f0fd0"></a><!-- doxytag: member="RvaFileMap::elements" ref="3d113919ff3b655dc7a5c74de85f0fd0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classRvaFileMap_1_1MapElement.html">MapElement</a>&gt; <a class="el" href="classRvaFileMap.html#3d113919ff3b655dc7a5c74de85f0fd0">RvaFileMap::elements</a><code> [mutable, private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3780d8ac5d30c5be0c27973533efb2f5"></a><!-- doxytag: member="RvaFileMap::base_va" ref="3780d8ac5d30c5be0c27973533efb2f5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Cxx__Grammar_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> <a class="el" href="classRvaFileMap.html#3780d8ac5d30c5be0c27973533efb2f5">RvaFileMap::base_va</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="RvaFileMap_8h-source.html">RvaFileMap.h</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Fri Aug 21 04:46:15 2009 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
