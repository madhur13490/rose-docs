<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: omp_lowering.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>omp_lowering.h</h1><a href="omp__lowering_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "astQuery.h"</span>
<a name="l00002"></a>00002 <span class="comment">//#include "sage3basic.h"</span>
<a name="l00003"></a>00003 
<a name="l00011"></a>00011 <span class="preprocessor">#ifndef OMP_LOWERING_H</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">#define OMP_LOWERING_H </span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="keyword">namespace </span>OmpSupport
<a name="l00014"></a>00014 {
<a name="l00015"></a>00015 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#7501a3bda788701ed37519c2e0f56a2f">patchUpSharedVariables</a>(<a class="code" href="classSgFile.html">SgFile</a>* );
<a name="l00021"></a>00021  <span class="comment">// TODO:  patchUpDefaultVariables(SgFile* );</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023  <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#109c3a085942e285df4d6a9b8d470f90">makeDataSharingExplicit</a>( <a class="code" href="classSgFile.html">SgFile</a>* );   
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">// last edited by Hongyi on 07/24/2012. </span>
<a name="l00027"></a>00027   
<a name="l00029"></a>00029   <span class="comment">// We support both Omni and GCC OpenMP runtime libraries</span>
<a name="l00030"></a><a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc10">00030</a>   <span class="keyword">enum</span> <a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc10">omp_rtl_enum</a> 
<a name="l00031"></a>00031   {
<a name="l00032"></a>00032     <a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc10f12bc592bdfb78759458c84c86b2cebf">e_gomp</a>,
<a name="l00033"></a>00033     <a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc10eb3a7478d9fd1eee2fc945b4eb9ac1b4">e_omni</a>,
<a name="l00034"></a>00034     <a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc1007cb5790e5364394b23de883fcbad67f">e_last_rtl</a>
<a name="l00035"></a>00035   };
<a name="l00036"></a>00036   <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#f8e89533a4c04bd31d7393781274f68e">nCounter</a>; <span class="comment">// translation generated variable counter, used to avoid name collision</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="keyword">extern</span> <a class="code" href="namespaceOmpSupport.html#bffc7f08fd77ecfd382fe54fd641dc10">omp_rtl_enum</a> <a class="code" href="namespaceOmpSupport.html#43438c01722b3b4802ce8d082a636759">rtl_type</a>; 
<a name="l00039"></a><a class="code" href="namespaceOmpSupport.html#517aeb9b0b29041f7d14636b9b643afb">00039</a>   <span class="keyword">typedef</span> std::map&lt;const SgVariableSymbol *, SgVariableSymbol *&gt; <a class="code" href="namespaceOmpSupport.html#517aeb9b0b29041f7d14636b9b643afb">VariableSymbolMap_t</a>;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#949516f6dba7524ecfe19cb4bacafbe8">commandLineProcessing</a>(std::vector&lt;std::string&gt; &amp;argvList);
<a name="l00042"></a>00042 
<a name="l00044"></a>00044   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#9ad14255713b507fc965732164024806">lower_omp</a>(<a class="code" href="classSgSourceFile.html">SgSourceFile</a>*);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00048"></a>00048   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#98e85da767f2a26695fdcd9d70c4adf3">insertRTLHeaders</a>(<a class="code" href="classSgSourceFile.html">SgSourceFile</a>*);
<a name="l00049"></a>00049 
<a name="l00051"></a>00051   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#404b0f71c1b780fec510bbd850fbcda1">insertRTLinitAndCleanCode</a>(<a class="code" href="classSgSourceFile.html">SgSourceFile</a>* ); 
<a name="l00052"></a>00052 
<a name="l00055"></a><a class="code" href="classOmpSupport_1_1translationDriver.html">00055</a>   <span class="keyword">class </span><a class="code" href="classOmpSupport_1_1translationDriver.html">translationDriver</a>: <span class="keyword">public</span> <a class="code" href="classAstSimpleProcessing.html">AstSimpleProcessing</a>
<a name="l00056"></a>00056   { 
<a name="l00057"></a>00057     <span class="keyword">protected</span>:
<a name="l00058"></a>00058       <span class="keywordtype">void</span> <a class="code" href="classOmpSupport_1_1translationDriver.html#2276de2535d68a0a77a47ccd6b99cdc8">visit</a>(<a class="code" href="classSgNode.html">SgNode</a>*);
<a name="l00059"></a>00059   }; <span class="comment">//translationDriver</span>
<a name="l00060"></a>00060 
<a name="l00062"></a>00062   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#2b151fb4117c4b6b8b0e774d6c358006">transOmpParallel</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00063"></a>00063 
<a name="l00065"></a>00065   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#547b91648d9a4437b6f6b410687aeda8">transOmpSections</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00066"></a>00066 
<a name="l00068"></a>00068   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#e015c3c4d380f148944d2cb9f2a8a305">transOmpTask</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00069"></a>00069 
<a name="l00071"></a>00071   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#8834de54bb3fee4a3f75e5aa7b7e60d4">transOmpLoop</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00072"></a>00072 
<a name="l00074"></a>00074   <span class="comment">//void transOmpDo(SgNode* node);</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00078"></a>00078   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#2d0cefae7b38c9b035dbbd2f5a417e80">transOmpBarrier</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00079"></a>00079 
<a name="l00081"></a>00081   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#dfc6ed0fb6cdc06e4b6cd3e0b50b9c0c">transOmpFlush</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00082"></a>00082 
<a name="l00084"></a>00084   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#88cd2daf13f11b87b823d673fa512f07">transOmpTaskwait</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00085"></a>00085 
<a name="l00087"></a>00087   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#91e377cd0e5da19d049a0d335419ba96">transOmpThreadprivate</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00088"></a>00088 
<a name="l00090"></a>00090   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#92d605f2c191dfe399343fd2af91d019">transOmpOrdered</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00092"></a>00092   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#2ce2fb3d01361a12fada8d678b2e1008">transOmpAtomic</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00094"></a>00094   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#101582626c5f4d0f5e38481522bbf1ad">transOmpCritical</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00096"></a>00096   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#3f911ebe755bc85aa73b25324bda24a8">transOmpMaster</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00098"></a>00098   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#b5784dbc40c3d9f01093ae944cf5208a">transOmpSingle</a>(<a class="code" href="classSgNode.html">SgNode</a>* node);
<a name="l00099"></a>00099 
<a name="l00101"></a>00101  <span class="comment">// It calls the ROSE AST outliner internally. </span>
<a name="l00102"></a>00102  <a class="code" href="classSgFunctionDeclaration.html">SgFunctionDeclaration</a>* <a class="code" href="namespaceOmpSupport.html#88e7c6a00a7f67b0e5a945611ac046e4">generateOutlinedTask</a>(<a class="code" href="classSgNode.html">SgNode</a>* node, std::string&amp; wrapper_name, std::set&lt;SgVariableSymbol*&gt;&amp; syms, std::set&lt;SgInitializedName*&gt;&amp; readOnlyVars);
<a name="l00103"></a>00103  
<a name="l00105"></a>00105   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#21a3ae424b905f4dc2ba9014e82cb503">transOmpVariables</a>(<a class="code" href="classSgStatement.html">SgStatement</a> * ompStmt, <a class="code" href="classSgBasicBlock.html">SgBasicBlock</a>* bb1, <a class="code" href="classSgExpression.html">SgExpression</a>* orig_loop_upper = NULL);
<a name="l00106"></a>00106 
<a name="l00108"></a>00108   <a class="code" href="Cxx__Grammar_8h.html#f5484e8d253ed1622192c3c08221ff2e">SgInitializedNamePtrList</a> <a class="code" href="namespaceOmpSupport.html#b29699a27a2737de726923e2f5f848e3">collectAllClauseVariables</a> (<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt);
<a name="l00109"></a>00109 
<a name="l00111"></a>00111   <a class="code" href="Cxx__Grammar_8h.html#f5484e8d253ed1622192c3c08221ff2e">SgInitializedNamePtrList</a> <a class="code" href="namespaceOmpSupport.html#5b41317a22c3a1d265c8752f50bb32d2">collectClauseVariables</a> (<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a>&amp; vt);
<a name="l00112"></a>00112 
<a name="l00114"></a>00114   <a class="code" href="Cxx__Grammar_8h.html#f5484e8d253ed1622192c3c08221ff2e">SgInitializedNamePtrList</a> <a class="code" href="namespaceOmpSupport.html#5b41317a22c3a1d265c8752f50bb32d2">collectClauseVariables</a> (<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> VariantVector&amp; vvt);
<a name="l00115"></a>00115 
<a name="l00117"></a>00117   <span class="keywordtype">bool</span> <a class="code" href="namespaceOmpSupport.html#7864c28768da6fc35abb5067d5b6c527">isInClauseVariableList</a>(<a class="code" href="classSgInitializedName.html">SgInitializedName</a>* var, <a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a>&amp; vt);
<a name="l00118"></a>00118 
<a name="l00120"></a>00120   <span class="keywordtype">bool</span> <a class="code" href="namespaceOmpSupport.html#7864c28768da6fc35abb5067d5b6c527">isInClauseVariableList</a>(<a class="code" href="classSgInitializedName.html">SgInitializedName</a>* var, <a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> VariantVector&amp; vvt);
<a name="l00121"></a>00121 
<a name="l00123"></a>00123   <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#773a1ba63936deb15ad4a861bb2ded77">replaceVariableReferences</a>(<a class="code" href="classSgNode.html">SgNode</a>* root, <a class="code" href="classSgVariableSymbol.html">SgVariableSymbol</a>* oldVar, <a class="code" href="classSgVariableSymbol.html">SgVariableSymbol</a>* newVar);
<a name="l00124"></a>00124 
<a name="l00126"></a>00126   <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#773a1ba63936deb15ad4a861bb2ded77">replaceVariableReferences</a>(<a class="code" href="classSgNode.html">SgNode</a>* root,  <a class="code" href="namespaceOmpSupport.html#517aeb9b0b29041f7d14636b9b643afb">VariableSymbolMap_t</a> varRemap);
<a name="l00127"></a>00127   <span class="comment">// I decided to reuse the existing Outliner work instead of coding a new one</span>
<a name="l00128"></a>00128   <span class="comment">//SgFunctionDeclaration* generateOutlinedFunction(SgNode* node);</span>
<a name="l00129"></a>00129   
<a name="l00131"></a>00131   <span class="keywordtype">void</span> <a class="code" href="namespaceOmpSupport.html#bc9c500b7f5bbc80a49cce076a5dd3b7">addClauseVariable</a>(<a class="code" href="classSgInitializedName.html">SgInitializedName</a>* var, <a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a>&amp; vt);
<a name="l00132"></a>00132 
<a name="l00134"></a>00134   <a class="code" href="classSgOmpVariablesClause.html">SgOmpVariablesClause</a>* <a class="code" href="namespaceOmpSupport.html#ad8cd703d8cc0a5b53db5780ed35f775">buildOmpVariableClause</a>(<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a> * clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a>&amp; vt);
<a name="l00135"></a>00135 
<a name="l00137"></a>00137   <span class="keywordtype">bool</span> <a class="code" href="namespaceOmpSupport.html#ecb7b3d9665847d1965d6b4c802272fd">hasClause</a>(<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a>* clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a> &amp; vt);
<a name="l00138"></a>00138 
<a name="l00140"></a>00140   Rose_STL_Container&lt;SgOmpClause*&gt;  <a class="code" href="namespaceOmpSupport.html#81bd5309bdbf0f69a4123eab1b23a796">getClause</a>(<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a>* clause_stmt, <span class="keyword">const</span> <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e3464">VariantT</a> &amp; vt);
<a name="l00141"></a>00141 
<a name="l00143"></a>00143   <span class="keywordtype">bool</span> <a class="code" href="namespaceOmpSupport.html#41e7dc6dc02ac38664033c6e3aba2d79">useStaticSchedule</a>(<a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a>* omp_loop);
<a name="l00144"></a>00144 
<a name="l00146"></a>00146   <a class="code" href="classSgOmpClause.html#c6be2cac5a261bcec8176fdedd62fb4e">SgOmpClause::omp_reduction_operator_enum</a> <a class="code" href="namespaceOmpSupport.html#04fdba2c69e22050d32513b9193d6f9f">getReductionOperationType</a>(<a class="code" href="classSgInitializedName.html">SgInitializedName</a>* init_name, <a class="code" href="classSgOmpClauseBodyStatement.html">SgOmpClauseBodyStatement</a>* clause_stmt);
<a name="l00147"></a>00147 
<a name="l00149"></a>00149   <a class="code" href="classSgExpression.html">SgExpression</a>* <a class="code" href="namespaceOmpSupport.html#9aec69da3b6b51fd8e295a2d4c8606a1">createInitialValueExp</a>(<a class="code" href="classSgOmpClause.html#c6be2cac5a261bcec8176fdedd62fb4e">SgOmpClause::omp_reduction_operator_enum</a> r_operator);
<a name="l00150"></a>00150 
<a name="l00152"></a>00152   std::string <a class="code" href="namespaceOmpSupport.html#0f0aaed5159e4b93cb3707c542109d3f">generateGOMPLoopStartFuncName</a> (<span class="keywordtype">bool</span> isOrdered, <a class="code" href="classSgOmpClause.html#785f813fa12ef0ef54b11396d0b1c55d">SgOmpClause::omp_schedule_kind_enum</a> s_kind);
<a name="l00153"></a>00153 
<a name="l00155"></a>00155   std::string <a class="code" href="namespaceOmpSupport.html#f936625c3e547a0b41be89e85974ac67">generateGOMPLoopNextFuncName</a> (<span class="keywordtype">bool</span> isOrdered, <a class="code" href="classSgOmpClause.html#785f813fa12ef0ef54b11396d0b1c55d">SgOmpClause::omp_schedule_kind_enum</a> s_kind);
<a name="l00156"></a>00156 
<a name="l00158"></a>00158   std::string <a class="code" href="namespaceOmpSupport.html#bd54e60feb0dcc01a470ef9bf0b514e1">toString</a>(<a class="code" href="classSgOmpClause.html#785f813fa12ef0ef54b11396d0b1c55d">SgOmpClause::omp_schedule_kind_enum</a> s_kind);
<a name="l00159"></a>00159 
<a name="l00161"></a>00161   <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#6c6aa01c618b4f1e3f48f52b0f064fc2">patchUpPrivateVariables</a>(<a class="code" href="classSgFile.html">SgFile</a>*);
<a name="l00162"></a>00162 
<a name="l00164"></a>00164   <span class="keywordtype">int</span> <a class="code" href="namespaceOmpSupport.html#237ad2378fc46979d00850193ae1b767">patchUpFirstprivateVariables</a>(<a class="code" href="classSgFile.html">SgFile</a>*);
<a name="l00165"></a>00165 
<a name="l00167"></a>00167   std::set&lt;SgInitializedName*&gt; <a class="code" href="namespaceOmpSupport.html#843697fdaa86dcaf061a566a899ff399">collectThreadprivateVariables</a>();
<a name="l00168"></a>00168 
<a name="l00170"></a>00170   <a class="code" href="classSgVariableDeclaration.html">SgVariableDeclaration</a> * <a class="code" href="namespaceOmpSupport.html#11f6c2558c6097ef8159e589b1c87970">buildAndInsertDeclarationForOmp</a>(<span class="keyword">const</span> std::string &amp;name, <a class="code" href="classSgType.html">SgType</a> *type, <a class="code" href="classSgInitializer.html">SgInitializer</a> *varInit, <a class="code" href="classSgBasicBlock.html">SgBasicBlock</a> *orig_scope);
<a name="l00172"></a>00172   <a class="code" href="classSgBasicBlock.html">SgBasicBlock</a>* <a class="code" href="namespaceOmpSupport.html#4c8e542fd545455f79d186bc3fb0107d">getEnclosingRegionOrFuncDefinition</a> (<a class="code" href="classSgNode.html">SgNode</a> *);
<a name="l00173"></a>00173 } <span class="comment">// end namespace OmpSupport  </span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="preprocessor">#endif //OMP_LOWERING_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 20 Jan 2013 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
