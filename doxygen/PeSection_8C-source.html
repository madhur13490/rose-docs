<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: PeSection.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>PeSection.C</h1><a href="PeSection_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Windows PE Sections (SgAsmPESection and related classes) */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="sage3basic_8h.html">sage3basic.h</a>"</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="comment">/* Pre-unparsing updates */</span>
<a name="l00006"></a>00006 <span class="keywordtype">bool</span>
<a name="l00007"></a><a class="code" href="classSgAsmPESection.html#532d1cc4f66aeea2c6b019d12b5c493a">00007</a> <a class="code" href="classSgAsmPESection.html#532d1cc4f66aeea2c6b019d12b5c493a">SgAsmPESection::reallocate</a>()
<a name="l00008"></a>00008 {
<a name="l00009"></a>00009     <span class="keywordtype">bool</span> reallocated = <span class="keyword">false</span>;
<a name="l00010"></a>00010 
<a name="l00011"></a>00011     <a class="code" href="classSgAsmPESectionTableEntry.html">SgAsmPESectionTableEntry</a> *shdr = <a class="code" href="classSgAsmPESection.html#33d2b45d5ab0d24c5e974c25bbfce675">get_section_entry</a>();
<a name="l00012"></a>00012     <span class="keywordflow">if</span> (shdr)
<a name="l00013"></a>00013         shdr-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#b5a161c95ebc0aa64899cab6f3471e28">update_from_section</a>(<span class="keyword">this</span>);
<a name="l00014"></a>00014     
<a name="l00015"></a>00015     <span class="keywordflow">return</span> reallocated;
<a name="l00016"></a>00016 }
<a name="l00017"></a>00017 
<a name="l00021"></a>00021 <a class="code" href="classSgAsmPESection.html">SgAsmPESection</a> *
<a name="l00022"></a><a class="code" href="classSgAsmPESection.html#1727668d2bb7c9fbb473082bced0c562">00022</a> <a class="code" href="classSgAsmPESection.html#1727668d2bb7c9fbb473082bced0c562">SgAsmPESection::init_from_section_table</a>(<a class="code" href="classSgAsmPESectionTableEntry.html">SgAsmPESectionTableEntry</a> *entry, <span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024     ROSE_ASSERT(entry);
<a name="l00025"></a>00025     ROSE_ASSERT(<span class="keywordtype">id</span>&gt;=0);
<a name="l00026"></a>00026     
<a name="l00027"></a>00027     <a class="code" href="classSgAsmPEFileHeader.html">SgAsmPEFileHeader</a> *fhdr = dynamic_cast&lt;SgAsmPEFileHeader*&gt;(<a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>());
<a name="l00028"></a>00028     ROSE_ASSERT(fhdr!=NULL);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030     <a class="code" href="classSgAsmGenericSection.html#bd79e1fdc74752945b618fe54c823dbb">set_synthesized</a>(<span class="keyword">false</span>);
<a name="l00031"></a>00031     <a class="code" href="classSgAsmGenericSection.html#2e2791a32dac7b4876e5722e3d13fb1c">set_name</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmBasicString.html">SgAsmBasicString</a>(entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#17751e7ba0bf89e382c5759f74c3bf3a">get_name</a>()));
<a name="l00032"></a>00032     <a class="code" href="classSgAsmGenericSection.html#52e9f6981456f7cd726ff2e3fe759ac9">set_id</a>(<span class="keywordtype">id</span>);
<a name="l00033"></a>00033     <a class="code" href="classSgAsmGenericSection.html#e8c89426ad50752c05024f979405c34e">set_purpose</a>(<a class="code" href="classSgAsmGenericSection.html#7a0f20a22abc6e3e645a6ee57e19b99bb01207376662e6874fa78f096efc00f3">SP_PROGRAM</a>);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="comment">/* File mapping */</span>
<a name="l00036"></a>00036     <a class="code" href="classSgAsmGenericSection.html#70af70aef42fe6ffb0372c1613c249e3">set_offset</a>(entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#ed22333463bf362d635ed9d9e15b7e4c">get_physical_offset</a>());
<a name="l00037"></a>00037     <a class="code" href="classSgAsmGenericSection.html#17bc8bfa80ac58ac6510e80de4af5ee0">set_size</a>(entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#88a6774acc974538c8c8cde03b05a782">get_physical_size</a>());
<a name="l00038"></a>00038     <a class="code" href="classSgAsmGenericSection.html#4634c545d480e0dc4a20379b4376397a">set_file_alignment</a>(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5ef3992925ef684f8d5ef33470eb0fe7">get_e_file_align</a>());
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <span class="comment">/* Memory mapping */</span>
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#1051e8dce16e83809e246d7779b2c404">get_rva</a>() &gt; 0) {
<a name="l00042"></a>00042         <a class="code" href="classSgAsmGenericSection.html#6e6cab1e9039308526f86e8d43727473">set_mapped_preferred_rva</a>(entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#1051e8dce16e83809e246d7779b2c404">get_rva</a>());
<a name="l00043"></a>00043         <a class="code" href="classSgAsmGenericSection.html#db598a0f1a89918b3d7748c9e39f215a">set_mapped_actual_va</a>(0); <span class="comment">/*will be asigned by BinaryLoader*/</span>
<a name="l00044"></a>00044         <a class="code" href="classSgAsmGenericSection.html#be5685a58a633903a76aca2423e3b9da">set_mapped_size</a>(entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#82b9e7bc4ca0179e87e6e574b7963b0c">get_virtual_size</a>());
<a name="l00045"></a>00045         <a class="code" href="classSgAsmGenericSection.html#b0d90cb66d0d0148b7b0faaa799384b6">set_mapped_alignment</a>(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5d2fc4731f9a3814eb432cc93e154f2e">get_e_section_align</a>());
<a name="l00046"></a>00046         <a class="code" href="classSgAsmGenericSection.html#3a2c9dfd9d359523db1d416d240c6a26">set_mapped_rperm</a>((entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#ab1fdfeb5ad435d0e9f7b38bfa0fe02d">get_flags</a>() &amp; <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c694285bd2b6577b47f6b3b4a3225bf55b">SgAsmPESectionTableEntry::OF_READABLE</a>)
<a name="l00047"></a>00047                          == <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c694285bd2b6577b47f6b3b4a3225bf55b">SgAsmPESectionTableEntry::OF_READABLE</a>);
<a name="l00048"></a>00048         <a class="code" href="classSgAsmGenericSection.html#7deab31aa0c9acad0d4d9512c2b151de">set_mapped_wperm</a>((entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#ab1fdfeb5ad435d0e9f7b38bfa0fe02d">get_flags</a>() &amp; <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c61d40767a1decff91cae96bab10ee6a38">SgAsmPESectionTableEntry::OF_WRITABLE</a>)
<a name="l00049"></a>00049                          == <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c61d40767a1decff91cae96bab10ee6a38">SgAsmPESectionTableEntry::OF_WRITABLE</a>);
<a name="l00050"></a>00050         <a class="code" href="classSgAsmGenericSection.html#e86d1ee27cba377fc3e01b488706440a">set_mapped_xperm</a>((entry-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#ab1fdfeb5ad435d0e9f7b38bfa0fe02d">get_flags</a>() &amp; <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c629b2c1b1140c03d54e9a8401cf269e6a">SgAsmPESectionTableEntry::OF_EXECUTABLE</a>)
<a name="l00051"></a>00051                          == <a class="code" href="classSgAsmPESectionTableEntry.html#0b8978072b9a845c31dec0694aa3e1c629b2c1b1140c03d54e9a8401cf269e6a">SgAsmPESectionTableEntry::OF_EXECUTABLE</a>);
<a name="l00052"></a>00052     } <span class="keywordflow">else</span> {
<a name="l00053"></a>00053         <a class="code" href="classSgAsmGenericSection.html#6e6cab1e9039308526f86e8d43727473">set_mapped_preferred_rva</a>(0);
<a name="l00054"></a>00054         <a class="code" href="classSgAsmGenericSection.html#db598a0f1a89918b3d7748c9e39f215a">set_mapped_actual_va</a>(0); <span class="comment">/*will be assigned by Loader*/</span>
<a name="l00055"></a>00055         <a class="code" href="classSgAsmGenericSection.html#be5685a58a633903a76aca2423e3b9da">set_mapped_size</a>(0);
<a name="l00056"></a>00056         <a class="code" href="classSgAsmGenericSection.html#3a2c9dfd9d359523db1d416d240c6a26">set_mapped_rperm</a>(<span class="keyword">false</span>);
<a name="l00057"></a>00057         <a class="code" href="classSgAsmGenericSection.html#7deab31aa0c9acad0d4d9512c2b151de">set_mapped_wperm</a>(<span class="keyword">false</span>);
<a name="l00058"></a>00058         <a class="code" href="classSgAsmGenericSection.html#e86d1ee27cba377fc3e01b488706440a">set_mapped_xperm</a>(<span class="keyword">false</span>);
<a name="l00059"></a>00059         <a class="code" href="classSgAsmGenericSection.html#b0d90cb66d0d0148b7b0faaa799384b6">set_mapped_alignment</a>(fhdr-&gt;<a class="code" href="classSgAsmPEFileHeader.html#5d2fc4731f9a3814eb432cc93e154f2e">get_e_section_align</a>());
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061     
<a name="l00062"></a>00062     <span class="comment">/* Add section table entry to section */</span>
<a name="l00063"></a>00063     <a class="code" href="classSgAsmPESection.html#6bc1a661a1ec8a0068db45c95ccdcbc4">set_section_entry</a>(entry);
<a name="l00064"></a>00064     entry-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(<span class="keyword">this</span>);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* Print some debugging info. */</span>
<a name="l00070"></a>00070 <span class="keywordtype">void</span>
<a name="l00071"></a><a class="code" href="classSgAsmPESection.html#162c9cbb50a5949b55a18393365744bf">00071</a> <a class="code" href="classSgAsmPESection.html#162c9cbb50a5949b55a18393365744bf">SgAsmPESection::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00072"></a>00072 <span class="keyword"></span>{
<a name="l00073"></a>00073     <span class="keywordtype">char</span> p[4096];
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00075"></a>00075         sprintf(p, <span class="stringliteral">"%sPESection[%zd]."</span>, prefix, idx);
<a name="l00076"></a>00076     } <span class="keywordflow">else</span> {
<a name="l00077"></a>00077         sprintf(p, <span class="stringliteral">"%sPESection."</span>, prefix);
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <a class="code" href="classSgAsmGenericSection.html#8e0b7abed9dcc21961ab57a422cd0a87">SgAsmGenericSection::dump</a>(f, p, -1);
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmPESection.html#dea25654ea0f4c376215d0fbeab3c555">p_section_entry</a>)
<a name="l00082"></a>00082         <a class="code" href="classSgAsmPESection.html#dea25654ea0f4c376215d0fbeab3c555">p_section_entry</a>-&gt;<a class="code" href="classSgAsmPESectionTableEntry.html#5b14ae2521d1f135bc6883bf23218b95">dump</a>(f, p, -1);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmPESection.html#09492c123c863bc6f41aa1ee57eaf3c6">variantT</a>() == <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e346451f2f9423e8f2dd715aa5413c2447b90">V_SgAsmPESection</a>) <span class="comment">//unless a base class</span>
<a name="l00085"></a>00085         <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(f, 0, std::string(p)+<span class="stringliteral">"data at "</span>, <a class="code" href="classSgAsmGenericSection.html#96573fffe8f4f825c56ead24cc89a474">p_data</a>);
<a name="l00086"></a>00086 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 20 Jan 2013 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
