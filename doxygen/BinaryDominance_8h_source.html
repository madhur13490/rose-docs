<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ROSE: BinaryDominance.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ROSE
   &#160;<span id="projectnumber">0.9.5a</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('BinaryDominance_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">BinaryDominance.h</div>  </div>
</div>
<div class="contents">
<a href="BinaryDominance_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef ROSE_BinaryAnalysis_Dominance_H</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define ROSE_BinaryAnalysis_Dominance_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="BinaryControlFlow_8h.html">BinaryControlFlow.h</a>&quot;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;boost/graph/depth_first_search.hpp&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;boost/graph/reverse_graph.hpp&gt;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="keyword">namespace </span>BinaryAnalysis {
<a name="l00010"></a>00010 
<a name="l00093"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html">00093</a>     <span class="keyword">class </span><a class="code" href="classBinaryAnalysis_1_1Dominance.html" title="Class for calculating dominance on control flow graphs.">Dominance</a> {
<a name="l00094"></a>00094     <span class="keyword">public</span>:
<a name="l00095"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a85761cc274d3548c02e50690dc471e2f">00095</a>         <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a85761cc274d3548c02e50690dc471e2f">Dominance</a>(): <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>(NULL) {}
<a name="l00096"></a>00096 
<a name="l00129"></a>00129         <span class="keyword">typedef</span> boost::adjacency_list&lt;boost::setS,      <span class="comment">/* edge storage */</span>
<a name="l00130"></a>00130                                       boost::vecS,      <span class="comment">/* vertex storage */</span>
<a name="l00131"></a>00131                                       boost::bidirectionalS,
<a name="l00132"></a>00132                                       boost::property&lt;boost::vertex_name_t, SgAsmBlock*&gt;
<a name="l00133"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad456be2c92fb7d272dce83216e388de6">00133</a>                                      &gt; <a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad456be2c92fb7d272dce83216e388de6" title="The default dominance graph type.">Graph</a>;
<a name="l00134"></a>00134 
<a name="l00148"></a>00148         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00149"></a><a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html">00149</a>         <span class="keyword">struct </span><a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap</a>: <span class="keyword">public</span> std::vector&lt;typename boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor&gt; {
<a name="l00150"></a>00150         };
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="comment">/**********************************************************************************************************************</span>
<a name="l00155"></a>00155 <span class="comment">         *                                      Methods that operate on the AST</span>
<a name="l00156"></a>00156 <span class="comment">         **********************************************************************************************************************/</span>
<a name="l00157"></a>00157     <span class="keyword">public</span>:
<a name="l00158"></a>00158 
<a name="l00166"></a>00166         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#af93c7f30845c2ced2803cf18ab228d41" title="Clears immediate dominator pointers in a subtree.">clear_ast</a>(<a class="code" href="classSgNode.html" title="This class represents the base class for all IR nodes within Sage III.">SgNode</a> *ast);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00182"></a>00182         <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph&gt;
<a name="l00183"></a>00183         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9aa8ead7b57080f9d411a508da6e36ae" title="Applies dominator information to the AST.">apply_to_ast</a>(<span class="keyword">const</span> DominanceGraph &amp;idg);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00186"></a>00186         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9aa8ead7b57080f9d411a508da6e36ae" title="Applies dominator information to the AST.">apply_to_ast</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg, <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;relation_map);
<a name="l00201"></a>00201         <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph&gt;
<a name="l00202"></a>00202         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a8e2f15a2351e1d2f165d51aaa63d2ab2" title="Cache vertex descriptors in AST.">cache_vertex_descriptors</a>(<span class="keyword">const</span> DominanceGraph&amp;);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 
<a name="l00221"></a>00221         <span class="keywordtype">bool</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a51ace9ec99d31dac859f6c8cf8ff8d6f" title="Checks that dominance relationships are consistent in an AST.">is_consistent</a>(<a class="code" href="classSgNode.html" title="This class represents the base class for all IR nodes within Sage III.">SgNode</a> *ast, std::set&lt;SgAsmBlock*&gt; *bad_blocks=NULL);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">/**********************************************************************************************************************</span>
<a name="l00226"></a>00226 <span class="comment">         *                                      Methods that build relationships</span>
<a name="l00227"></a>00227 <span class="comment">         **********************************************************************************************************************/</span>
<a name="l00228"></a>00228     <span class="keyword">public</span>:
<a name="l00229"></a>00229 
<a name="l00246"></a>00246         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00247"></a>00247         <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a>
<a name="l00248"></a>00248         <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a6b5ae96e29adcc801d064e95da2e0e50" title="Builds a relation map for immediate dominator.">build_idom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00249"></a>00249                                      <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00252"></a>00252         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a6b5ae96e29adcc801d064e95da2e0e50" title="Builds a relation map for immediate dominator.">build_idom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00253"></a>00253                                           <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00254"></a>00254                                           <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;idom<span class="comment">/*out*/</span>);
<a name="l00272"></a>00272         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00273"></a>00273         <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a>
<a name="l00274"></a>00274         <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a0ef969e65ed21a1cbe149960ff028a02" title="Builds a relation map for immediate post dominator.">build_postdom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00275"></a>00275                                         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00278"></a>00278         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a0ef969e65ed21a1cbe149960ff028a02" title="Builds a relation map for immediate post dominator.">build_postdom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00279"></a>00279                                              <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00280"></a>00280                                              <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;idom<span class="comment">/*out*/</span>);
<a name="l00285"></a>00285         <span class="comment">/**********************************************************************************************************************</span>
<a name="l00286"></a>00286 <span class="comment">         *                                      Methods that build graphs</span>
<a name="l00287"></a>00287 <span class="comment">         **********************************************************************************************************************/</span>
<a name="l00288"></a>00288     <span class="keyword">public</span>:
<a name="l00289"></a>00289 
<a name="l00300"></a>00300         <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00301"></a>00301         DominanceGraph <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a80ab27c56d017d2953b44742064a6c50" title="Builds a dominance graph from a control flow graph.">build_idom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00302"></a>00302                                                  <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00305"></a>00305         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a80ab27c56d017d2953b44742064a6c50" title="Builds a dominance graph from a control flow graph.">build_idom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00306"></a>00306                                        <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00307"></a>00307                                        DominanceGraph &amp;dg<span class="comment">/*out*/</span>);
<a name="l00328"></a>00328         <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00329"></a>00329         DominanceGraph <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a983648abf1bc311c7a40826c4781fe30" title="Build a post dominator graph.">build_postdom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00330"></a>00330                                                     <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00333"></a>00333         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a983648abf1bc311c7a40826c4781fe30" title="Build a post dominator graph.">build_postdom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00334"></a>00334                                           <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00335"></a>00335                                           DominanceGraph &amp;pdg<span class="comment">/*out*/</span>);
<a name="l00340"></a>00340         <span class="comment">/**********************************************************************************************************************</span>
<a name="l00341"></a>00341 <span class="comment">         *                                      Miscellaneous methods</span>
<a name="l00342"></a>00342 <span class="comment">         **********************************************************************************************************************/</span>
<a name="l00343"></a>00343     <span class="keyword">public</span>:
<a name="l00344"></a>00344 
<a name="l00354"></a>00354         <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00355"></a>00355         DominanceGraph <a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad3b86c46648e08808523f29703c5d087" title="Builds a dominance graph from a relation map.">build_graph_from_relation</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00356"></a>00356                                                  <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;relmap);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358         <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00359"></a>00359         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad3b86c46648e08808523f29703c5d087" title="Builds a dominance graph from a relation map.">build_graph_from_relation</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00360"></a>00360                                        <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;relmap,
<a name="l00361"></a>00361                                        DominanceGraph &amp;dg<span class="comment">/*out*/</span>);
<a name="l00368"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9f4b205396253d22a2bdd857ac1c4638">00368</a>         <span class="keywordtype">void</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9f4b205396253d22a2bdd857ac1c4638" title="Control debugging output.">set_debug</a>(FILE *<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>) { this-&gt;debug = <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>; }
<a name="l00369"></a>00369 
<a name="l00374"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#aab0a02321d6cdfc0d7df15b182ffd470">00374</a>         FILE *<a class="code" href="classBinaryAnalysis_1_1Dominance.html#aab0a02321d6cdfc0d7df15b182ffd470" title="Obtain debugging stream.">get_debug</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>; }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="keyword">protected</span>:
<a name="l00377"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9">00377</a>         FILE *<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>;                    
<a name="l00378"></a>00378     };
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="comment">/******************************************************************************************************************************</span>
<a name="l00384"></a>00384 <span class="comment"> *                              Function templates for methods that operate on the AST</span>
<a name="l00385"></a>00385 <span class="comment"> ******************************************************************************************************************************/</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph&gt;
<a name="l00388"></a>00388 <span class="keywordtype">void</span>
<a name="l00389"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9aa8ead7b57080f9d411a508da6e36ae">00389</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9aa8ead7b57080f9d411a508da6e36ae" title="Applies dominator information to the AST.">BinaryAnalysis::Dominance::apply_to_ast</a>(<span class="keyword">const</span> DominanceGraph &amp;idg)
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>)
<a name="l00392"></a>00392         fprintf(<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>, <span class="stringliteral">&quot;BinaryAnalysis::Dominance::apply_to_ast:\n&quot;</span>);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="keyword">typename</span> boost::graph_traits&lt;DominanceGraph&gt;::edge_iterator ei, ei_end;
<a name="l00395"></a>00395     <span class="keywordflow">for</span> (boost::tie(ei, ei_end)=edges(idg); ei!=ei_end; ++ei) {
<a name="l00396"></a>00396         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *dom_block = <span class="keyword">get</span>(boost::vertex_name, idg, source(*ei, idg));
<a name="l00397"></a>00397         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *sub_block = <span class="keyword">get</span>(boost::vertex_name, idg, target(*ei, idg));
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>) {
<a name="l00399"></a>00399             fprintf(<a class="code" href="classBinaryAnalysis_1_1Dominance.html#a998b3910251b42464e8861d5e63ddbf9" title="Debugging stream, or null.">debug</a>, <span class="stringliteral">&quot;  edge (d,s) = (%zu,%zu) = (0x%08&quot;</span>PRIx64<span class="stringliteral">&quot;, 0x%08&quot;</span>PRIx64<span class="stringliteral">&quot;)\n&quot;</span>,
<a name="l00400"></a>00400                     source(*ei, idg), target(*ei, idg), dom_block-&gt;<a class="code" href="classSgAsmStatement.html#a9d16f5ff82380f8b9c4071afe9f094a5">get_address</a>(), sub_block-&gt;<a class="code" href="classSgAsmStatement.html#a9d16f5ff82380f8b9c4071afe9f094a5">get_address</a>());
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402         sub_block-&gt;<a class="code" href="classSgAsmBlock.html#ab3589f716d477920c10e25ede1991d9f">set_immediate_dominator</a>(dom_block);
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00407"></a>00407 <span class="keywordtype">void</span>
<a name="l00408"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#ac26010897b0019f923918ee68246554d">00408</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a9aa8ead7b57080f9d411a508da6e36ae" title="Applies dominator information to the AST.">BinaryAnalysis::Dominance::apply_to_ast</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00409"></a>00409                                         <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;idom)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor CFG_Vertex;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413     assert(idom.size()&lt;=num_vertices(cfg));
<a name="l00414"></a>00414     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> subordinate=0; subordinate&lt;idom.size(); subordinate++) {
<a name="l00415"></a>00415         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *sub_block = <span class="keyword">get</span>(boost::vertex_name, cfg, (CFG_Vertex)subordinate);
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (sub_block &amp;&amp; idom[subordinate]!=boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex()) {
<a name="l00417"></a>00417             CFG_Vertex dominator = idom[subordinate];
<a name="l00418"></a>00418             <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *dom_block = <span class="keyword">get</span>(boost::vertex_name, cfg, dominator);
<a name="l00419"></a>00419             sub_block-&gt;<a class="code" href="classSgAsmBlock.html#ab3589f716d477920c10e25ede1991d9f">set_immediate_dominator</a>(dom_block);
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph&gt;
<a name="l00425"></a>00425 <span class="keywordtype">void</span>
<a name="l00426"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a8e2f15a2351e1d2f165d51aaa63d2ab2">00426</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a8e2f15a2351e1d2f165d51aaa63d2ab2" title="Cache vertex descriptors in AST.">BinaryAnalysis::Dominance::cache_vertex_descriptors</a>(<span class="keyword">const</span> DominanceGraph &amp;dg)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428     <span class="keyword">typename</span> boost::graph_traits&lt;DominanceGraph&gt;::vertex_iterator vi, vi_end;
<a name="l00429"></a>00429     <span class="keywordflow">for</span> (boost::tie(vi, vi_end)=vertices(dg); vi!=vi_end; ++vi) {
<a name="l00430"></a>00430         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *block = <span class="keyword">get</span>(boost::vertex_name, dg, *vi);
<a name="l00431"></a>00431         <span class="keywordflow">if</span> (block)
<a name="l00432"></a>00432             block-&gt;<a class="code" href="classSgAsmBlock.html#a74a6e0cfca3498557b3024ffcb21b8a6">set_cached_vertex</a>(*vi);
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">/******************************************************************************************************************************</span>
<a name="l00437"></a>00437 <span class="comment"> *                              Function templates for immediate dominators</span>
<a name="l00438"></a>00438 <span class="comment"> ******************************************************************************************************************************/</span>
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00442"></a>00442 <span class="keywordtype">void</span>
<a name="l00443"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a654ab2e6c0cc6be7319746a1ba95028f">00443</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a80ab27c56d017d2953b44742064a6c50" title="Builds a dominance graph from a control flow graph.">BinaryAnalysis::Dominance::build_idom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00444"></a>00444                                                      <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00445"></a>00445                                                      DominanceGraph &amp;result)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447     <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> idoms;
<a name="l00448"></a>00448     build_idom_relation_from_cfg(cfg, start, idoms);
<a name="l00449"></a>00449     build_graph_from_relation(cfg, idoms, result);
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00453"></a>00453 DominanceGraph
<a name="l00454"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a80ab27c56d017d2953b44742064a6c50">00454</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a80ab27c56d017d2953b44742064a6c50" title="Builds a dominance graph from a control flow graph.">BinaryAnalysis::Dominance::build_idom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00455"></a>00455                                                      <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     DominanceGraph dg;
<a name="l00458"></a>00458     build_idom_graph_from_cfg(cfg, start, dg);
<a name="l00459"></a>00459     <span class="keywordflow">return</span> dg;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00463"></a>00463 <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">BinaryAnalysis::Dominance::RelationMap&lt;ControlFlowGraph&gt;</a>
<a name="l00464"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a6b5ae96e29adcc801d064e95da2e0e50">00464</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a6b5ae96e29adcc801d064e95da2e0e50" title="Builds a relation map for immediate dominator.">BinaryAnalysis::Dominance::build_idom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00465"></a>00465                                                         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467     <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> idom;
<a name="l00468"></a>00468     build_idom_relation_from_cfg(cfg, start, idom);
<a name="l00469"></a>00469     <span class="keywordflow">return</span> idom;
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 <span class="comment">/* Loosely based on an algorithm from Rice University known to be O(n^2) where n is the number of vertices in the control flow</span>
<a name="l00473"></a>00473 <span class="comment"> * subgraph connected to the start vertex.  According to the Rice paper, their algorithm outperforms Lengauer-Tarjan on</span>
<a name="l00474"></a>00474 <span class="comment"> * typicall control flow graphs even though asymptotically, Lengauer-Tarjan is better.  The Rice algorithm is also much</span>
<a name="l00475"></a>00475 <span class="comment"> * simpler, as evidenced below.</span>
<a name="l00476"></a>00476 <span class="comment"> *</span>
<a name="l00477"></a>00477 <span class="comment"> * I&#39;ve added a few minor optimizations:</span>
<a name="l00478"></a>00478 <span class="comment"> *   (1) reverse post-order dfs is calculated once rather than each time through the loop.  Rice&#39;s analysis indicates that</span>
<a name="l00479"></a>00479 <span class="comment"> *       they also made this optimization, although their listed algorithm does not show it.</span>
<a name="l00480"></a>00480 <span class="comment"> *   (2) the first processed predecessor of the vertex under consideration is determined in the same loop that processes</span>
<a name="l00481"></a>00481 <span class="comment"> *       the other predecessors, while in the listed algorithm this was a separate operation.</span>
<a name="l00482"></a>00482 <span class="comment"> *   (3) self loops in the control flow graph are not processed, since they don&#39;t contribute to the dominance relation.</span>
<a name="l00483"></a>00483 <span class="comment"> *   (4) undefined state for idom(x) is represented by idom(x)==x.</span>
<a name="l00484"></a>00484 <span class="comment"> *   (5) nodes are labeled in reverse order from Rice, but traversed in the same order.  This simplifies the code a bit</span>
<a name="l00485"></a>00485 <span class="comment"> *       because the vertices are traversed according to the &quot;flowlist&quot; vector, and the index into the &quot;flowlist&quot; vector</span>
<a name="l00486"></a>00486 <span class="comment"> *       can serve as the node label.</span>
<a name="l00487"></a>00487 <span class="comment"> *</span>
<a name="l00488"></a>00488 <span class="comment"> * The set of dominators of vertex v, namely dom(v), is represented as a linked list stored as an array indexed by vertex</span>
<a name="l00489"></a>00489 <span class="comment"> * number. That is</span>
<a name="l00490"></a>00490 <span class="comment"> *      dom(v) = { v, idom(v), idom(idom(v)), ..., start }</span>
<a name="l00491"></a>00491 <span class="comment"> *</span>
<a name="l00492"></a>00492 <span class="comment"> * is stored in the idom array as:</span>
<a name="l00493"></a>00493 <span class="comment"> *</span>
<a name="l00494"></a>00494 <span class="comment"> *      dom(v) = { v, idom[v], idom[idom[v]], ..., start }</span>
<a name="l00495"></a>00495 <span class="comment"> *</span>
<a name="l00496"></a>00496 <span class="comment"> * This representation, combined with the fact that:</span>
<a name="l00497"></a>00497 <span class="comment"> *</span>
<a name="l00498"></a>00498 <span class="comment"> *      a ELEMENT_OF dom(v) implies dom(a) SUBSET_OF dom(v)</span>
<a name="l00499"></a>00499 <span class="comment"> *</span>
<a name="l00500"></a>00500 <span class="comment"> * allows us to perform intersection by simply walking the two sorted lists until we find an element in common, and including</span>
<a name="l00501"></a>00501 <span class="comment"> * that element an all subsequent elements in the intersection result.  The idom array uses the flow-list vertex numbering</span>
<a name="l00502"></a>00502 <span class="comment"> * produced by a post-order visitor of a depth-first search, and the nodes are processed from highest to lowest.</span>
<a name="l00503"></a>00503 <span class="comment"> */</span>
<a name="l00504"></a>00504 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00505"></a>00505 <span class="keywordtype">void</span>
<a name="l00506"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a4a43b268c7f26b0b1a2c5b165a863807">00506</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a6b5ae96e29adcc801d064e95da2e0e50" title="Builds a relation map for immediate dominator.">BinaryAnalysis::Dominance::build_idom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00507"></a>00507                                                         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00508"></a>00508                                                         <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;result)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor CFG_Vertex;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <span class="keyword">struct </span>debug_dom_set {
<a name="l00513"></a>00513         debug_dom_set(FILE *debug, <span class="keywordtype">size_t</span> vertex_i, <span class="keywordtype">size_t</span> idom_i,
<a name="l00514"></a>00514                       <span class="keyword">const</span> std::vector&lt;size_t&gt; &amp;domsets, <span class="keyword">const</span> std::vector&lt;CFG_Vertex&gt; &amp;flowlist) {
<a name="l00515"></a>00515             <span class="keywordflow">if</span> (debug) {
<a name="l00516"></a>00516                 fprintf(debug, <span class="stringliteral">&quot;{ #%zu(%zu)&quot;</span>, vertex_i, flowlist[vertex_i]);
<a name="l00517"></a>00517                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> d=idom_i; d!=vertex_i; vertex_i=d, d=domsets[d])
<a name="l00518"></a>00518                     fprintf(debug, <span class="stringliteral">&quot; #%zu(%zu)&quot;</span>, d, flowlist[d]);
<a name="l00519"></a>00519                 fprintf(debug, <span class="stringliteral">&quot; }&quot;</span>);
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522     };
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (debug) {
<a name="l00525"></a>00525         fprintf(debug, <span class="stringliteral">&quot;BinaryAnalysis::Dominance::build_idom_relation_from_cfg: starting at vertex %zu\n&quot;</span>, start);
<a name="l00526"></a>00526         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *block = <span class="keyword">get</span>(boost::vertex_name, cfg, start);
<a name="l00527"></a>00527         <a class="code" href="classSgAsmFunction.html">SgAsmFunction</a> *func = block ? block-&gt;<a class="code" href="classSgAsmBlock.html#abdd6257d93832cc2b0dcbdf07f9ccd3c">get_enclosing_function</a>() : NULL;
<a name="l00528"></a>00528         <span class="keywordflow">if</span> (func) {
<a name="l00529"></a>00529             fprintf(debug, <span class="stringliteral">&quot;  Vertex %zu is %s block of&quot;</span>, start, func-&gt;<a class="code" href="classSgAsmFunction.html#ae4b655e005eac45d3436c18438d8e5e4">get_entry_block</a>()==block?<span class="stringliteral">&quot;the entry&quot;</span>:<span class="stringliteral">&quot;a&quot;</span>);
<a name="l00530"></a>00530             <span class="keywordflow">if</span> (func-&gt;<a class="code" href="classSgAsmFunction.html#adfb6d9281f2d93a0ccc4974036ef2f1d">get_name</a>().empty()) {
<a name="l00531"></a>00531                 fprintf(debug, <span class="stringliteral">&quot; an unnamed function&quot;</span>);
<a name="l00532"></a>00532             } <span class="keywordflow">else</span> {
<a name="l00533"></a>00533                 fprintf(debug, <span class="stringliteral">&quot; function &lt;%s&gt;&quot;</span>, func-&gt;<a class="code" href="classSgAsmFunction.html#adfb6d9281f2d93a0ccc4974036ef2f1d">get_name</a>().c_str());
<a name="l00534"></a>00534             }
<a name="l00535"></a>00535             fprintf(debug, <span class="stringliteral">&quot; at 0x%08&quot;</span>PRIx64<span class="stringliteral">&quot;\n&quot;</span>, func-&gt;<a class="code" href="classSgAsmFunction.html#a6edeeb78e01e2af6e59a5c6f7b0088af">get_entry_va</a>());
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="comment">/* Initialize */</span>
<a name="l00540"></a>00540     std::vector&lt;size_t&gt; rflowlist; <span class="comment">/* reverse mapping; flowlist[i]==v implies rflowlist[v]==i */</span>
<a name="l00541"></a>00541     std::vector&lt;CFG_Vertex&gt; flowlist = <a class="code" href="classBinaryAnalysis_1_1ControlFlow.html" title="Binary control flow analysis.">ControlFlow</a>().<a class="code" href="classBinaryAnalysis_1_1ControlFlow.html#a6efa50703657c9b3521a9d3e961d265d" title="Orders nodes by depth first search reverse post order.">flow_order</a>(cfg, start, &amp;rflowlist);
<a name="l00542"></a>00542     std::vector&lt;size_t&gt; idom(flowlist.size());
<a name="l00543"></a>00543     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;flowlist.size(); i++)
<a name="l00544"></a>00544         idom[i] = i; <span class="comment">/* idom[i]==i implies idom[i] is unknown */</span>
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (debug) {
<a name="l00547"></a>00547         fprintf(debug, <span class="stringliteral">&quot;  CFG:\n&quot;</span>);
<a name="l00548"></a>00548         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_iterator vi, vi_end;
<a name="l00549"></a>00549         <span class="keywordflow">for</span> (boost::tie(vi, vi_end)=vertices(cfg); vi!=vi_end; ++vi) {
<a name="l00550"></a>00550             <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *block = <span class="keyword">get</span>(boost::vertex_name, cfg, *vi);
<a name="l00551"></a>00551             fprintf(debug, <span class="stringliteral">&quot;    %zu 0x%08&quot;</span>PRIx64<span class="stringliteral">&quot; --&gt; {&quot;</span>, (<span class="keywordtype">size_t</span>)(*vi), block?block-&gt;<a class="code" href="classSgAsmStatement.html#a9d16f5ff82380f8b9c4071afe9f094a5">get_address</a>():0);
<a name="l00552"></a>00552             <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::out_edge_iterator ei, ei_end;
<a name="l00553"></a>00553             <span class="keywordflow">for</span> (boost::tie(ei, ei_end)=out_edges(*vi, cfg); ei!=ei_end; ++ei) {
<a name="l00554"></a>00554                 fprintf(debug, <span class="stringliteral">&quot; %zu&quot;</span>, (<span class="keywordtype">size_t</span>)target(*ei, cfg));
<a name="l00555"></a>00555             }
<a name="l00556"></a>00556             fprintf(debug, <span class="stringliteral">&quot; }\n&quot;</span>);
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         fprintf(debug, <span class="stringliteral">&quot;  Note: notation #M(N) means CFG vertex N at position M in the flow list.\n&quot;</span>);
<a name="l00560"></a>00560         fprintf(debug, <span class="stringliteral">&quot;  Flowlist: {&quot;</span>);
<a name="l00561"></a>00561         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;flowlist.size(); i++) {
<a name="l00562"></a>00562             fprintf(debug, <span class="stringliteral">&quot; #%zu(%zu)&quot;</span>, i, (<span class="keywordtype">size_t</span>)flowlist[i]);
<a name="l00563"></a>00563             assert((<span class="keywordtype">size_t</span>)flowlist[i]&lt;rflowlist.size());
<a name="l00564"></a>00564             assert(rflowlist[flowlist[i]]==i);
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566         fprintf(debug, <span class="stringliteral">&quot; }\n&quot;</span>);
<a name="l00567"></a>00567     }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     <span class="comment">/* Iterative data flow */</span>
<a name="l00570"></a>00570     <span class="keywordtype">bool</span> changed;
<a name="l00571"></a>00571     <span class="keywordflow">do</span> {
<a name="l00572"></a>00572         changed = <span class="keyword">false</span>;
<a name="l00573"></a>00573         <span class="keywordflow">if</span> (debug)
<a name="l00574"></a>00574             fprintf(debug, <span class="stringliteral">&quot;  Next pass through vertices...\n&quot;</span>);
<a name="l00575"></a>00575         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> vertex_i=0; vertex_i&lt;flowlist.size(); vertex_i++) {
<a name="l00576"></a>00576             CFG_Vertex vertex = flowlist[vertex_i];
<a name="l00577"></a>00577             <span class="keywordflow">if</span> (debug) {
<a name="l00578"></a>00578                 fprintf(debug, <span class="stringliteral">&quot;    vertex #%zu(%zu)&quot;</span>, (<span class="keywordtype">size_t</span>)vertex_i, (<span class="keywordtype">size_t</span>)vertex);
<a name="l00579"></a>00579                 <span class="keywordflow">if</span> (vertex==start) {
<a name="l00580"></a>00580                     fprintf(debug, <span class="stringliteral">&quot; [skipping start vertex]\n&quot;</span>);
<a name="l00581"></a>00581                 } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582                     fprintf(debug, <span class="stringliteral">&quot; dominators are &quot;</span>);
<a name="l00583"></a>00583                     debug_dom_set(debug, vertex_i, idom[vertex_i], idom, flowlist);
<a name="l00584"></a>00584                     fprintf(debug, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00585"></a>00585                 }
<a name="l00586"></a>00586             }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588             <span class="keywordflow">if</span> (vertex!=start) {
<a name="l00589"></a>00589                 <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::in_edge_iterator pi, pi_end; <span class="comment">/*predecessors*/</span>
<a name="l00590"></a>00590                 <span class="keywordtype">size_t</span> new_idom = vertex_i; <span class="comment">/*undefined for now*/</span>
<a name="l00591"></a>00591                 <span class="keywordflow">for</span> (boost::tie(pi, pi_end)=in_edges(vertex, cfg); pi!=pi_end; ++pi) {
<a name="l00592"></a>00592                     CFG_Vertex predecessor = source(*pi, cfg);
<a name="l00593"></a>00593                     assert(predecessor&gt;=0 &amp;&amp; predecessor&lt;rflowlist.size());
<a name="l00594"></a>00594                     <span class="keywordtype">size_t</span> predecessor_i = rflowlist[predecessor];
<a name="l00595"></a>00595                     <span class="keywordflow">if</span> (debug)
<a name="l00596"></a>00596                         fprintf(debug, <span class="stringliteral">&quot;      pred #%zd(%zu)&quot;</span>, (<span class="keywordtype">size_t</span>)predecessor_i, (<span class="keywordtype">size_t</span>)predecessor);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598                     <span class="comment">/* It&#39;s possible that the predecessor lies outside the part of the CFG connected to the entry node. We</span>
<a name="l00599"></a>00599 <span class="comment">                     * should not consider those predecessors. */</span>
<a name="l00600"></a>00600                     <span class="keywordflow">if</span> (predecessor!=vertex &amp;&amp; predecessor_i!=boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex()) {
<a name="l00601"></a>00601                         <span class="keywordflow">if</span> (predecessor==start) {
<a name="l00602"></a>00602                             new_idom = predecessor_i;
<a name="l00603"></a>00603                             <span class="keywordflow">if</span> (debug) {
<a name="l00604"></a>00604                                 fprintf(debug, <span class="stringliteral">&quot;; new doms of #%zu(%zu) are &quot;</span>, vertex_i, vertex);
<a name="l00605"></a>00605                                 debug_dom_set(debug, vertex_i, predecessor_i, idom, flowlist);
<a name="l00606"></a>00606                             }
<a name="l00607"></a>00607                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idom[predecessor_i]!=predecessor_i) {
<a name="l00608"></a>00608                             <span class="keywordflow">if</span> (new_idom==vertex_i) {
<a name="l00609"></a>00609                                 new_idom = predecessor_i;
<a name="l00610"></a>00610                                 <span class="keywordflow">if</span> (debug) {
<a name="l00611"></a>00611                                     fprintf(debug, <span class="stringliteral">&quot;; new doms of #%zu(%zu) are &quot;</span>, vertex_i, vertex);
<a name="l00612"></a>00612                                     debug_dom_set(debug, vertex_i, predecessor_i, idom, flowlist);
<a name="l00613"></a>00613                                 }
<a name="l00614"></a>00614                             } <span class="keywordflow">else</span> {
<a name="l00615"></a>00615                                 <span class="keywordflow">if</span> (debug) {
<a name="l00616"></a>00616                                     fprintf(debug, <span class="stringliteral">&quot;; new doms of #%zu(%zu) are intersect(&quot;</span>, vertex_i, vertex);
<a name="l00617"></a>00617                                     debug_dom_set(debug, vertex_i, new_idom, idom, flowlist);
<a name="l00618"></a>00618                                     fprintf(debug, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00619"></a>00619                                     debug_dom_set(debug, vertex_i, predecessor_i, idom, flowlist);
<a name="l00620"></a>00620                                 }
<a name="l00621"></a>00621                                 <span class="keywordtype">size_t</span> f1=new_idom, f2=predecessor_i;
<a name="l00622"></a>00622                                 <span class="keywordflow">while</span> (f1!=f2) {
<a name="l00623"></a>00623                                     <span class="keywordflow">while</span> (f1 &gt; f2)
<a name="l00624"></a>00624                                         f1 = idom[f1];
<a name="l00625"></a>00625                                     <span class="keywordflow">while</span> (f2 &gt; f1)
<a name="l00626"></a>00626                                         f2 = idom[f2];
<a name="l00627"></a>00627                                 }
<a name="l00628"></a>00628                                 new_idom = f1;
<a name="l00629"></a>00629                                 <span class="keywordflow">if</span> (debug) {
<a name="l00630"></a>00630                                     fprintf(debug, <span class="stringliteral">&quot;) = &quot;</span>);
<a name="l00631"></a>00631                                     debug_dom_set(debug, vertex_i, new_idom, idom, flowlist);
<a name="l00632"></a>00632                                 }
<a name="l00633"></a>00633                             }
<a name="l00634"></a>00634                         }
<a name="l00635"></a>00635                     }
<a name="l00636"></a>00636                     <span class="keywordflow">if</span> (debug)
<a name="l00637"></a>00637                         fprintf(debug, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00638"></a>00638                 }
<a name="l00639"></a>00639                 <span class="keywordflow">if</span> (idom[vertex_i]!=new_idom) {
<a name="l00640"></a>00640                     idom[vertex_i] = new_idom;
<a name="l00641"></a>00641                     changed = <span class="keyword">true</span>;
<a name="l00642"></a>00642                 }
<a name="l00643"></a>00643             }
<a name="l00644"></a>00644         }
<a name="l00645"></a>00645     } <span class="keywordflow">while</span> (changed);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     <span class="comment">/* Build result relation */</span>
<a name="l00648"></a>00648     result.clear();
<a name="l00649"></a>00649     result.resize(num_vertices(cfg), boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex());
<a name="l00650"></a>00650     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;flowlist.size(); i++) {
<a name="l00651"></a>00651         <span class="keywordflow">if</span> (idom[i]!=i)
<a name="l00652"></a>00652             result[flowlist[i]] = flowlist[idom[i]];
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="keywordflow">if</span> (debug) {
<a name="l00656"></a>00656         fprintf(debug, <span class="stringliteral">&quot;  Final dom sets:\n&quot;</span>);
<a name="l00657"></a>00657         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> vertex_i=0; vertex_i&lt;flowlist.size(); vertex_i++) {
<a name="l00658"></a>00658             CFG_Vertex vertex = flowlist[vertex_i];
<a name="l00659"></a>00659             fprintf(debug, <span class="stringliteral">&quot;    #%zu(%zu) has dominators &quot;</span>, (<span class="keywordtype">size_t</span>)vertex_i, (<span class="keywordtype">size_t</span>)vertex);
<a name="l00660"></a>00660             debug_dom_set(debug, vertex_i, idom[vertex_i], idom, flowlist);
<a name="l00661"></a>00661             fprintf(debug, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663         fprintf(debug, <span class="stringliteral">&quot;  Final result:\n&quot;</span>);
<a name="l00664"></a>00664         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;result.size(); i++) {
<a name="l00665"></a>00665             <span class="keywordflow">if</span> (result[i]==boost::graph_traits&lt;ControlFlow::Graph&gt;::null_vertex()) {
<a name="l00666"></a>00666                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has no immediate dominator\n&quot;</span>, i);
<a name="l00667"></a>00667             } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has immediate dominator %zu\n&quot;</span>, i, result[i]);
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 <span class="comment">/******************************************************************************************************************************</span>
<a name="l00679"></a>00679 <span class="comment"> *                              Function templates for post dominators</span>
<a name="l00680"></a>00680 <span class="comment"> ******************************************************************************************************************************/</span>
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00683"></a>00683 <span class="keywordtype">void</span>
<a name="l00684"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a1053ea6cd763ad5059c2717b8b360343">00684</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a983648abf1bc311c7a40826c4781fe30" title="Build a post dominator graph.">BinaryAnalysis::Dominance::build_postdom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00685"></a>00685                                                         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00686"></a>00686                                                         DominanceGraph &amp;result)
<a name="l00687"></a>00687 {
<a name="l00688"></a>00688     <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> pdoms;
<a name="l00689"></a>00689     build_postdom_relation_from_cfg(cfg, start, pdoms);
<a name="l00690"></a>00690     build_graph_from_relation(cfg, pdoms, result);
<a name="l00691"></a>00691 }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00694"></a>00694 DominanceGraph
<a name="l00695"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a983648abf1bc311c7a40826c4781fe30">00695</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a983648abf1bc311c7a40826c4781fe30" title="Build a post dominator graph.">BinaryAnalysis::Dominance::build_postdom_graph_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00696"></a>00696                                                         <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     DominanceGraph dg;
<a name="l00699"></a>00699     build_postdom_graph_from_cfg(cfg, start, dg);
<a name="l00700"></a>00700     <span class="keywordflow">return</span> dg;
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00704"></a>00704 <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">BinaryAnalysis::Dominance::RelationMap&lt;ControlFlowGraph&gt;</a>
<a name="l00705"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a0ef969e65ed21a1cbe149960ff028a02">00705</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a0ef969e65ed21a1cbe149960ff028a02" title="Builds a relation map for immediate post dominator.">BinaryAnalysis::Dominance::build_postdom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00706"></a>00706                                                            <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start)
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708     <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> pdom;
<a name="l00709"></a>00709     build_postdom_relation_from_cfg(cfg, start, pdom);
<a name="l00710"></a>00710     <span class="keywordflow">return</span> pdom;
<a name="l00711"></a>00711 }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00714"></a>00714 <span class="keywordtype">void</span>
<a name="l00715"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a056a85801c0347eb096c58c644c0ec73">00715</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#a0ef969e65ed21a1cbe149960ff028a02" title="Builds a relation map for immediate post dominator.">BinaryAnalysis::Dominance::build_postdom_relation_from_cfg</a>(<span class="keyword">const</span> ControlFlowGraph &amp;_cfg,
<a name="l00716"></a>00716                                                            <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor start,
<a name="l00717"></a>00717                                                            <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;result)
<a name="l00718"></a>00718 {
<a name="l00719"></a>00719     ControlFlowGraph cfg = _cfg;        <span class="comment">/* we need our own copy since we might modify it */</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (debug) {
<a name="l00722"></a>00722         fprintf(debug, <span class="stringliteral">&quot;BinaryAnalysis::Dominance::build_postdom_relation_from_cfg: starting at vertex %zu\n&quot;</span>, start);
<a name="l00723"></a>00723         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *block = <span class="keyword">get</span>(boost::vertex_name, cfg, start);
<a name="l00724"></a>00724         <a class="code" href="classSgAsmFunction.html">SgAsmFunction</a> *func = block ? block-&gt;<a class="code" href="classSgAsmBlock.html#abdd6257d93832cc2b0dcbdf07f9ccd3c">get_enclosing_function</a>() : NULL;
<a name="l00725"></a>00725         <span class="keywordflow">if</span> (func) {
<a name="l00726"></a>00726             fprintf(debug, <span class="stringliteral">&quot;  Vertex %zu is %s block of&quot;</span>, start, func-&gt;<a class="code" href="classSgAsmFunction.html#ae4b655e005eac45d3436c18438d8e5e4">get_entry_block</a>()==block?<span class="stringliteral">&quot;the entry&quot;</span>:<span class="stringliteral">&quot;a&quot;</span>);
<a name="l00727"></a>00727             <span class="keywordflow">if</span> (func-&gt;<a class="code" href="classSgAsmFunction.html#adfb6d9281f2d93a0ccc4974036ef2f1d">get_name</a>().empty()) {
<a name="l00728"></a>00728                 fprintf(debug, <span class="stringliteral">&quot; an unnamed function&quot;</span>);
<a name="l00729"></a>00729             } <span class="keywordflow">else</span> {
<a name="l00730"></a>00730                 fprintf(debug, <span class="stringliteral">&quot; function &lt;%s&gt;&quot;</span>, func-&gt;<a class="code" href="classSgAsmFunction.html#adfb6d9281f2d93a0ccc4974036ef2f1d">get_name</a>().c_str());
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732             fprintf(debug, <span class="stringliteral">&quot; at 0x%08&quot;</span>PRIx64<span class="stringliteral">&quot;\n&quot;</span>, func-&gt;<a class="code" href="classSgAsmFunction.html#a6edeeb78e01e2af6e59a5c6f7b0088af">get_entry_va</a>());
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734     }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="comment">/* Does the graph have more than one return block?  By &quot;return&quot;, we mean any block whose control flow successor is possibly</span>
<a name="l00737"></a>00737 <span class="comment">     * outside the start node&#39;s function.  See ControlFlow::return_blocks(). */</span>
<a name="l00738"></a>00738     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor CFG_Vertex;
<a name="l00739"></a>00739     CFG_Vertex unique_exit;
<a name="l00740"></a>00740     <span class="keywordtype">bool</span> unique_exit_created = <span class="keyword">false</span>;
<a name="l00741"></a>00741     std::vector&lt;CFG_Vertex&gt; retblocks = <a class="code" href="classBinaryAnalysis_1_1ControlFlow.html" title="Binary control flow analysis.">ControlFlow</a>().<a class="code" href="classBinaryAnalysis_1_1ControlFlow.html#a6a96acd6e23f8cec283a20bed4086bae" title="Returns list of function return blocks.">return_blocks</a>(cfg, start);
<a name="l00742"></a>00742     <span class="keywordflow">if</span> (1==retblocks.size()) {
<a name="l00743"></a>00743         <span class="keywordflow">if</span> (debug)
<a name="l00744"></a>00744             fprintf(debug, <span class="stringliteral">&quot;  CFG has unique exit vertex %zu, block 0x%08&quot;</span>PRIx64<span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00745"></a>00745                     retblocks[0],
<a name="l00746"></a>00746                     <span class="keyword">get</span>(boost::vertex_name, cfg, retblocks[0])-&gt;get_address());
<a name="l00747"></a>00747         unique_exit = retblocks[0];
<a name="l00748"></a>00748     } <span class="keywordflow">else</span> {
<a name="l00749"></a>00749         assert(!retblocks.empty());
<a name="l00750"></a>00750         unique_exit = add_vertex(cfg);
<a name="l00751"></a>00751         unique_exit_created = <span class="keyword">true</span>;
<a name="l00752"></a>00752         put(boost::vertex_name, cfg, unique_exit, (<a class="code" href="classSgAsmBlock.html">SgAsmBlock</a>*)0); <span class="comment">/* vertex has no basic block */</span>
<a name="l00753"></a>00753         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;retblocks.size(); i++)
<a name="l00754"></a>00754             add_edge(retblocks[i], unique_exit, cfg);
<a name="l00755"></a>00755         <span class="keywordflow">if</span> (debug)
<a name="l00756"></a>00756             fprintf(debug, <span class="stringliteral">&quot;  CFG has %zu exit blocks. Added unique exit vertex %zu\n&quot;</span>, retblocks.size(), unique_exit);
<a name="l00757"></a>00757     }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="comment">/* Post dominance is the same as doing dominance, but on a reversed CFG, using the unique return vertex as the starting</span>
<a name="l00760"></a>00760 <span class="comment">     * point. */</span>
<a name="l00761"></a>00761     <span class="keywordflow">if</span> (debug)
<a name="l00762"></a>00762         fprintf(debug, <span class="stringliteral">&quot;  Calling build_idom_relation_from_cfg() on reversed CFG...\n&quot;</span>);
<a name="l00763"></a>00763     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::reverse_graph&lt;ControlFlowGraph&gt; ReversedControlFlowGraph;
<a name="l00764"></a>00764     ReversedControlFlowGraph rcfg(cfg);
<a name="l00765"></a>00765     <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ReversedControlFlowGraph&gt;</a> rrelation;
<a name="l00766"></a>00766     build_idom_relation_from_cfg(rcfg, unique_exit, rrelation);
<a name="l00767"></a>00767     <span class="keywordflow">if</span> (debug)
<a name="l00768"></a>00768         fprintf(debug, <span class="stringliteral">&quot;BinaryAnalysis::Dominance::build_postdom_relation_from_cfg() resuming...\n&quot;</span>);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     <span class="comment">/* Remove the unique exit vertex if appropriate. */</span>
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (unique_exit_created) {
<a name="l00772"></a>00772         assert(unique_exit+1==num_vertices(cfg));
<a name="l00773"></a>00773         rrelation.pop_back();
<a name="l00774"></a>00774         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;rrelation.size(); ++i) {
<a name="l00775"></a>00775             <span class="keywordflow">if</span> (rrelation[i]&gt;=rrelation.size())
<a name="l00776"></a>00776                 rrelation[i] = boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex();
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778     }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     <span class="comment">/* Intiailize the result vector. */</span>
<a name="l00781"></a>00781     result.assign(rrelation.begin(), rrelation.end());
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (debug) {
<a name="l00783"></a>00783         fprintf(debug, <span class="stringliteral">&quot;  Final result:\n&quot;</span>);
<a name="l00784"></a>00784         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;result.size(); i++) {
<a name="l00785"></a>00785             <span class="keywordflow">if</span> (result[i]==boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex()) {
<a name="l00786"></a>00786                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has no immediate post dominator\n&quot;</span>, i);
<a name="l00787"></a>00787             } <span class="keywordflow">else</span> {
<a name="l00788"></a>00788                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has immediate post dominator %zu\n&quot;</span>, i, result[i]);
<a name="l00789"></a>00789             }
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="comment">/******************************************************************************************************************************</span>
<a name="l00798"></a>00798 <span class="comment"> *                              Function templates for miscellaneous methods</span>
<a name="l00799"></a>00799 <span class="comment"> ******************************************************************************************************************************/</span>
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 <span class="keyword">template</span>&lt;<span class="keyword">class</span> DominanceGraph, <span class="keyword">class</span> ControlFlowGraph&gt;
<a name="l00802"></a>00802 DominanceGraph
<a name="l00803"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad3b86c46648e08808523f29703c5d087">00803</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad3b86c46648e08808523f29703c5d087" title="Builds a dominance graph from a relation map.">BinaryAnalysis::Dominance::build_graph_from_relation</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00804"></a>00804                                                      <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;relmap)
<a name="l00805"></a>00805 {
<a name="l00806"></a>00806     DominanceGraph g;
<a name="l00807"></a>00807     build_graph_from_relation(cfg, relmap, g);
<a name="l00808"></a>00808     <span class="keywordflow">return</span> g;
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ControlFlowGraph, <span class="keyword">class</span> DominanceGraph&gt;
<a name="l00812"></a>00812 <span class="keywordtype">void</span>
<a name="l00813"></a><a class="code" href="classBinaryAnalysis_1_1Dominance.html#a26007a764a213133aa42e0e37bcf12b9">00813</a> <a class="code" href="classBinaryAnalysis_1_1Dominance.html#ad3b86c46648e08808523f29703c5d087" title="Builds a dominance graph from a relation map.">BinaryAnalysis::Dominance::build_graph_from_relation</a>(<span class="keyword">const</span> ControlFlowGraph &amp;cfg,
<a name="l00814"></a>00814                                                      <span class="keyword">const</span> <a class="code" href="structBinaryAnalysis_1_1Dominance_1_1RelationMap.html" title="Vector representation of the dominance relation.">RelationMap&lt;ControlFlowGraph&gt;</a> &amp;relmap,
<a name="l00815"></a>00815                                                      DominanceGraph &amp;dg<span class="comment">/*out*/</span>)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::graph_traits&lt;DominanceGraph&gt;::vertex_descriptor D_Vertex;
<a name="l00818"></a>00818     <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_descriptor CFG_Vertex;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <span class="keywordflow">if</span> (debug) {
<a name="l00821"></a>00821         fprintf(debug, <span class="stringliteral">&quot;BinaryAnalysis::Dominance::build_graph_from_relation:\n&quot;</span>);
<a name="l00822"></a>00822         fprintf(debug, <span class="stringliteral">&quot;  building from this relation:\n&quot;</span>);
<a name="l00823"></a>00823         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;relmap.size(); i++) {
<a name="l00824"></a>00824             <span class="keywordflow">if</span> (relmap[i]==boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex()) {
<a name="l00825"></a>00825                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has no immediate dominator\n&quot;</span>, i);
<a name="l00826"></a>00826             } <span class="keywordflow">else</span> {
<a name="l00827"></a>00827                 fprintf(debug, <span class="stringliteral">&quot;    CFG vertex %zu has immediate dominator %zu\n&quot;</span>, i, relmap[i]);
<a name="l00828"></a>00828             }
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     dg.clear();
<a name="l00833"></a>00833     <span class="keyword">typename</span> boost::graph_traits&lt;ControlFlowGraph&gt;::vertex_iterator vi, vi_end;
<a name="l00834"></a>00834     <span class="keywordflow">for</span> (boost::tie(vi, vi_end)=vertices(cfg); vi!=vi_end; vi++) {
<a name="l00835"></a>00835         D_Vertex v = add_vertex(dg);
<a name="l00836"></a>00836         assert(v==*vi); <span class="comment">/* because relmap[] refers to CFG vertices; otherwise we need to map them */</span>
<a name="l00837"></a>00837         <a class="code" href="classSgAsmBlock.html">SgAsmBlock</a> *block = <span class="keyword">get</span>(boost::vertex_name, cfg, *vi);
<a name="l00838"></a>00838         put(boost::vertex_name, dg, v, block);
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840     <span class="keywordflow">for</span> (boost::tie(vi, vi_end)=vertices(cfg); vi!=vi_end; vi++) {
<a name="l00841"></a>00841         CFG_Vertex subordinate = *vi;
<a name="l00842"></a>00842         CFG_Vertex dominator = relmap[subordinate];
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (dominator!=boost::graph_traits&lt;ControlFlowGraph&gt;::null_vertex()) {
<a name="l00844"></a>00844             <span class="keywordflow">if</span> (debug)
<a name="l00845"></a>00845                 fprintf(debug, <span class="stringliteral">&quot;  adding edge (d,s) = (%zu,%zu)\n&quot;</span>, dominator, subordinate);
<a name="l00846"></a>00846             add_edge(dominator, subordinate, dg);
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="BinaryDominance_8h.html">BinaryDominance.h</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


    <li class="footer">Generated on Thu Dec 1 2011 16:31:13 for ROSE by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
