<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ROSE: ElfDynamicLinking.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>ElfDynamicLinking.C</h1><a href="ElfDynamicLinking_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ELF Dynamic Linking (SgAsmElfDynamicSection and related classes) */</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "<a class="code" href="sage3basic_8h.html">sage3basic.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include "stringify.h"</span>
<a name="l00004"></a>00004 
<a name="l00006"></a>00006 <span class="keywordtype">void</span>
<a name="l00007"></a><a class="code" href="classSgAsmElfDynamicEntry.html#a8efa110ad91f1c97e3e5c3c043cb82b">00007</a> <a class="code" href="classSgAsmElfDynamicEntry.html#a8efa110ad91f1c97e3e5c3c043cb82b">SgAsmElfDynamicEntry::ctor</a>(<a class="code" href="classSgAsmElfDynamicSection.html">SgAsmElfDynamicSection</a> *dynsec)
<a name="l00008"></a>00008 {
<a name="l00009"></a>00009     ROSE_ASSERT(dynsec!=NULL);
<a name="l00010"></a>00010 
<a name="l00011"></a>00011     <a class="code" href="classSgAsmElfDynamicEntry.html#1aa7208ae84dbf30db0562aa7b6eecd3">set_name</a>(NULL); <span class="comment">/*only defined for DT_NEEDED entries; see SgAsmDynamicSection::parse*/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013     ROSE_ASSERT(dynsec-&gt;<a class="code" href="classSgAsmElfDynamicSection.html#7fa54a35a7f4d1ea7eb2a16f6cec2053">get_entries</a>()!=NULL);
<a name="l00014"></a>00014     dynsec-&gt;<a class="code" href="classSgAsmElfDynamicSection.html#7fa54a35a7f4d1ea7eb2a16f6cec2053">get_entries</a>()-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().push_back(<span class="keyword">this</span>);
<a name="l00015"></a>00015     ROSE_ASSERT(dynsec-&gt;<a class="code" href="classSgAsmElfDynamicSection.html#7fa54a35a7f4d1ea7eb2a16f6cec2053">get_entries</a>()-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().size()&gt;0);
<a name="l00016"></a>00016     <a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(dynsec-&gt;<a class="code" href="classSgAsmElfDynamicSection.html#7fa54a35a7f4d1ea7eb2a16f6cec2053">get_entries</a>());
<a name="l00017"></a>00017 }
<a name="l00018"></a>00018 
<a name="l00020"></a>00020 <span class="keywordtype">void</span>
<a name="l00021"></a>00021 <a class="code" href="classSgAsmElfDynamicEntry.html#110a44f96f4402a2dc5a4c131e3d5869">SgAsmElfDynamicEntry::parse</a>(ByteOrder sex, <span class="keyword">const</span> Elf32DynamicEntry_disk *disk)
<a name="l00022"></a>00022 {
<a name="l00023"></a>00023     <a class="code" href="classSgAsmElfDynamicEntry.html#01f1c4ae7ff7b1df9bfe8ed3e1728dd0">p_d_tag</a> = (<a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f">EntryType</a>)<a class="code" href="classSgAsmExecutableFileFormat.html#52cc73212f6067429beb52b06b9ecc75">disk_to_host</a>(sex, disk-&gt;d_tag);
<a name="l00024"></a>00024     <a class="code" href="classSgAsmElfDynamicEntry.html#351a1eda42a7b97ad529d3b89d57f752">p_d_val</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#52cc73212f6067429beb52b06b9ecc75">disk_to_host</a>(sex, disk-&gt;d_val);
<a name="l00025"></a>00025 }
<a name="l00026"></a>00026 <span class="keywordtype">void</span>
<a name="l00027"></a>00027 <a class="code" href="classSgAsmElfDynamicEntry.html#110a44f96f4402a2dc5a4c131e3d5869">SgAsmElfDynamicEntry::parse</a>(ByteOrder sex, <span class="keyword">const</span> Elf64DynamicEntry_disk *disk)
<a name="l00028"></a>00028 {
<a name="l00029"></a>00029     <a class="code" href="classSgAsmElfDynamicEntry.html#01f1c4ae7ff7b1df9bfe8ed3e1728dd0">p_d_tag</a> = (<a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f">EntryType</a>)<a class="code" href="classSgAsmExecutableFileFormat.html#52cc73212f6067429beb52b06b9ecc75">disk_to_host</a>(sex, disk-&gt;d_tag);
<a name="l00030"></a>00030     <a class="code" href="classSgAsmElfDynamicEntry.html#351a1eda42a7b97ad529d3b89d57f752">p_d_val</a> = <a class="code" href="classSgAsmExecutableFileFormat.html#52cc73212f6067429beb52b06b9ecc75">disk_to_host</a>(sex, disk-&gt;d_val);
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00034"></a>00034 <span class="keywordtype">void</span> *
<a name="l00035"></a>00035 <a class="code" href="classSgAsmElfDynamicEntry.html#247b2a1d255c0115bb9be87b475cf8a9">SgAsmElfDynamicEntry::encode</a>(ByteOrder sex, Elf32DynamicEntry_disk *disk)<span class="keyword"> const</span>
<a name="l00036"></a>00036 <span class="keyword"></span>{
<a name="l00037"></a>00037     <a class="code" href="classSgAsmExecutableFileFormat.html#19727362aeeba713bc0cc666de3c3f13">host_to_disk</a>(sex, <a class="code" href="classSgAsmElfDynamicEntry.html#01f1c4ae7ff7b1df9bfe8ed3e1728dd0">p_d_tag</a>, &amp;(disk-&gt;d_tag));
<a name="l00038"></a>00038     <a class="code" href="classSgAsmExecutableFileFormat.html#19727362aeeba713bc0cc666de3c3f13">host_to_disk</a>(sex, <a class="code" href="classSgAsmElfDynamicEntry.html#351a1eda42a7b97ad529d3b89d57f752">p_d_val</a>.<a class="code" href="classrose__rva__t.html#6db820c59de54058c0fbc619f9cac510">get_rva</a>(), &amp;(disk-&gt;d_val));
<a name="l00039"></a>00039     <span class="keywordflow">return</span> disk;
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 <span class="keywordtype">void</span> *
<a name="l00042"></a>00042 <a class="code" href="classSgAsmElfDynamicEntry.html#247b2a1d255c0115bb9be87b475cf8a9">SgAsmElfDynamicEntry::encode</a>(ByteOrder sex, Elf64DynamicEntry_disk *disk)<span class="keyword"> const</span>
<a name="l00043"></a>00043 <span class="keyword"></span>{
<a name="l00044"></a>00044     <a class="code" href="classSgAsmExecutableFileFormat.html#19727362aeeba713bc0cc666de3c3f13">host_to_disk</a>(sex, <a class="code" href="classSgAsmElfDynamicEntry.html#01f1c4ae7ff7b1df9bfe8ed3e1728dd0">p_d_tag</a>, &amp;(disk-&gt;d_tag));
<a name="l00045"></a>00045     <a class="code" href="classSgAsmExecutableFileFormat.html#19727362aeeba713bc0cc666de3c3f13">host_to_disk</a>(sex, <a class="code" href="classSgAsmElfDynamicEntry.html#351a1eda42a7b97ad529d3b89d57f752">p_d_val</a>.<a class="code" href="classrose__rva__t.html#6db820c59de54058c0fbc619f9cac510">get_rva</a>(), &amp;(disk-&gt;d_val));
<a name="l00046"></a>00046     <span class="keywordflow">return</span> disk;
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00050"></a>00050 std::string
<a name="l00051"></a><a class="code" href="classSgAsmElfDynamicEntry.html#7784d57122dc86b81dd18665ee3e2375">00051</a> <a class="code" href="classSgAsmElfDynamicEntry.html#7784d57122dc86b81dd18665ee3e2375">SgAsmElfDynamicEntry::to_string</a>(<a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f">EntryType</a> t) 
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053 <span class="preprocessor">#ifndef _MSC_VER</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="stringify_8C.html#63ca42ece1f108cda23327c0dcf08993">stringifySgAsmElfDynamicEntryEntryType</a>(t);
<a name="l00055"></a>00055 <span class="preprocessor">#else</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>        ROSE_ASSERT(<span class="keyword">false</span>);
<a name="l00057"></a>00057         <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00058"></a>00058 <span class="preprocessor">#endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 }
<a name="l00061"></a>00061 
<a name="l00063"></a>00063 <span class="keywordtype">void</span>
<a name="l00064"></a><a class="code" href="classSgAsmElfDynamicEntry.html#1aa7208ae84dbf30db0562aa7b6eecd3">00064</a> <a class="code" href="classSgAsmElfDynamicEntry.html#1aa7208ae84dbf30db0562aa7b6eecd3">SgAsmElfDynamicEntry::set_name</a>(<a class="code" href="classSgAsmGenericString.html">SgAsmGenericString</a> *name)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     <span class="keywordflow">if</span> (name!=<a class="code" href="classSgAsmElfDynamicEntry.html#a6d7dcd16d9b9f63c89b43e6c601e5e2">p_name</a>) {
<a name="l00067"></a>00067         <span class="keywordflow">if</span> (<a class="code" href="classSgAsmElfDynamicEntry.html#a6d7dcd16d9b9f63c89b43e6c601e5e2">p_name</a>) {
<a name="l00068"></a>00068             p_name-&gt;set_parent(NULL);
<a name="l00069"></a>00069             <a class="code" href="namespaceSageInterface.html#57437bbbb806858dda0cea7444fbafef">SageInterface::deleteAST</a>(p_name);
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071         p_name = name;
<a name="l00072"></a>00072         <span class="keywordflow">if</span> (p_name)
<a name="l00073"></a>00073             p_name-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(<span class="keyword">this</span>);
<a name="l00074"></a>00074         <a class="code" href="classSgNode.html#67ae02f0cd73cb84cbef103cbb002301">set_isModified</a>(<span class="keyword">true</span>);
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00079"></a>00079 <span class="keywordtype">void</span>
<a name="l00080"></a><a class="code" href="classSgAsmElfDynamicEntry.html#279d2c33c9ae8aa75f26e03547f4008e">00080</a> <a class="code" href="classSgAsmElfDynamicEntry.html#279d2c33c9ae8aa75f26e03547f4008e">SgAsmElfDynamicEntry::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00081"></a>00081 <span class="keyword"></span>{
<a name="l00082"></a>00082     <span class="keywordtype">char</span> p[4096];
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00084"></a>00084         sprintf(p, <span class="stringliteral">"%sElfDynamicEntry[%zd]."</span>, prefix, idx);
<a name="l00085"></a>00085     } <span class="keywordflow">else</span> {
<a name="l00086"></a>00086         sprintf(p, <span class="stringliteral">"%sElfDynamicEntry."</span>, prefix);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088     <span class="keyword">const</span> <span class="keywordtype">int</span> w = std::max(1, <a class="code" href="Cxx__Grammar_8h.html#b09cd568db5adadb46869d1ae0f6db69">DUMP_FIELD_WIDTH</a>-(<span class="keywordtype">int</span>)strlen(p));
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordtype">char</span> label[256];
<a name="l00091"></a>00091     strcpy(label, <a class="code" href="classSgAsmElfDynamicEntry.html#7784d57122dc86b81dd18665ee3e2375">to_string</a>(<a class="code" href="classSgAsmElfDynamicEntry.html#01f1c4ae7ff7b1df9bfe8ed3e1728dd0">p_d_tag</a>).c_str());
<a name="l00092"></a>00092     <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *s=label; *s; s++) *s = tolower(*s);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     fprintf(f, <span class="stringliteral">"%s%-*s = %s"</span>, p, w, label, <a class="code" href="classSgAsmElfDynamicEntry.html#351a1eda42a7b97ad529d3b89d57f752">p_d_val</a>.<a class="code" href="classrose__rva__t.html#a1f79b3a8dcf863178435d33b90cbfe5">to_string</a>().c_str());
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmElfDynamicEntry.html#a6d7dcd16d9b9f63c89b43e6c601e5e2">p_name</a>)
<a name="l00096"></a>00096         fprintf(f, <span class="stringliteral">" \"%s\""</span>, <a class="code" href="classSgAsmElfDynamicEntry.html#a6d7dcd16d9b9f63c89b43e6c601e5e2">p_name</a>-&gt;<a class="code" href="classSgAsmGenericString.html#ba8bc51c8d891e4f8e8e87c45c62f7d5">get_string</a>(<span class="keyword">true</span>).c_str());
<a name="l00097"></a>00097     fputc(<span class="charliteral">'\n'</span>, f);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmElfDynamicEntry.html#79005638e3052261c9043ec30e95c605">p_extra</a>.size()&gt;0) {
<a name="l00100"></a>00100         fprintf(f, <span class="stringliteral">"%s%-*s = %zu bytes\n"</span>, p, w, <span class="stringliteral">"extra"</span>, <a class="code" href="classSgAsmElfDynamicEntry.html#79005638e3052261c9043ec30e95c605">p_extra</a>.size());
<a name="l00101"></a>00101         <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(f, 0, std::string(p)+<span class="stringliteral">"extra at "</span>, <a class="code" href="classSgAsmElfDynamicEntry.html#79005638e3052261c9043ec30e95c605">p_extra</a>);
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00106"></a>00106 <span class="keywordtype">void</span>
<a name="l00107"></a><a class="code" href="classSgAsmElfDynamicSection.html#16a7506f42656b65cb3e503cb2ffa6e1">00107</a> <a class="code" href="classSgAsmElfSection.html#777c5e1c2ac65fd5378fdf08364acf85">SgAsmElfDynamicSection::ctor</a>(<a class="code" href="classSgAsmElfStringSection.html">SgAsmElfStringSection</a> *strings)
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a> = <span class="keyword">new</span> <a class="code" href="classSgAsmElfDynamicEntryList.html">SgAsmElfDynamicEntryList</a>;
<a name="l00110"></a>00110     <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(<span class="keyword">this</span>);
<a name="l00111"></a>00111     ROSE_ASSERT(strings!=NULL);
<a name="l00112"></a>00112     <a class="code" href="classSgAsmElfSection.html#19ea328fdfe31bd968b930c88a49d07b">p_linked_section</a> = strings;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00116"></a>00116 <a class="code" href="classSgAsmElfDynamicSection.html">SgAsmElfDynamicSection</a> *
<a name="l00117"></a><a class="code" href="classSgAsmElfDynamicSection.html#55569c2d2659d3ef7360f82a8f1d6be8">00117</a> <a class="code" href="classSgAsmElfDynamicSection.html#55569c2d2659d3ef7360f82a8f1d6be8">SgAsmElfDynamicSection::parse</a>()
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119     <a class="code" href="classSgAsmGenericSection.html#06e6f2a4c28be5858d6a0b92573908d7">SgAsmElfSection::parse</a>();
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <a class="code" href="classSgAsmElfFileHeader.html">SgAsmElfFileHeader</a> *fhdr = <a class="code" href="classSgAsmElfSection.html#a430cf4e1e6376e12f3b5dc8363099c4">get_elf_header</a>();
<a name="l00122"></a>00122     ROSE_ASSERT(fhdr);
<a name="l00123"></a>00123     <a class="code" href="classSgAsmElfSectionTableEntry.html">SgAsmElfSectionTableEntry</a> *shdr = <a class="code" href="classSgAsmElfSection.html#9ef7cc77be330cde6c32ef598e312971">get_section_entry</a>();
<a name="l00124"></a>00124     ROSE_ASSERT(shdr);
<a name="l00125"></a>00125     <a class="code" href="classSgAsmElfStringSection.html">SgAsmElfStringSection</a> *strsec = dynamic_cast&lt;SgAsmElfStringSection*&gt;(<a class="code" href="classSgAsmElfSection.html#44bf34de24ece59722ba6a9b3861e0cb">get_linked_section</a>());
<a name="l00126"></a>00126     ROSE_ASSERT(strsec!=NULL);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     size_t entry_size, struct_size, extra_size, nentries;
<a name="l00129"></a>00129     <a class="code" href="classSgAsmElfDynamicSection.html#850fce8532821a96b809681aed0e41b3">calculate_sizes</a>(&amp;entry_size, &amp;struct_size, &amp;extra_size, &amp;nentries);
<a name="l00130"></a>00130     ROSE_ASSERT(entry_size==shdr-&gt;<a class="code" href="classSgAsmElfSectionTableEntry.html#2336763fad7e464207a6d19dec4e45d7">get_sh_entsize</a>());
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* Parse each entry */</span>
<a name="l00133"></a>00133     <span class="keywordflow">for</span> (size_t i=0; i&lt;nentries; i++) {
<a name="l00134"></a>00134         <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a> *entry=0;
<a name="l00135"></a>00135         <span class="keywordflow">if</span> (4==fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#23c52f8b2a00e850095a3454f91db39c">get_word_size</a>()) {
<a name="l00136"></a>00136             entry = <span class="keyword">new</span> <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a>(<span class="keyword">this</span>);
<a name="l00137"></a>00137             <a class="code" href="structSgAsmElfDynamicEntry_1_1Elf32DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf32DynamicEntry_disk</a> disk;
<a name="l00138"></a>00138             <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(i*entry_size, &amp;disk, struct_size);
<a name="l00139"></a>00139             entry-&gt;parse(fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#3269e8ea6c30182607e9d4ee79fc05a8">get_sex</a>(), &amp;disk);
<a name="l00140"></a>00140         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (8==fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#23c52f8b2a00e850095a3454f91db39c">get_word_size</a>()) {
<a name="l00141"></a>00141             entry = <span class="keyword">new</span> <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a>(<span class="keyword">this</span>);
<a name="l00142"></a>00142             <a class="code" href="structSgAsmElfDynamicEntry_1_1Elf64DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf64DynamicEntry_disk</a> disk;
<a name="l00143"></a>00143             <a class="code" href="classSgAsmGenericSection.html#e7516833466da3f886fafd0b1bc1f803">read_content_local</a>(i*entry_size, &amp;disk, struct_size);
<a name="l00144"></a>00144             entry-&gt;parse(fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#3269e8ea6c30182607e9d4ee79fc05a8">get_sex</a>(), &amp;disk);
<a name="l00145"></a>00145         } <span class="keywordflow">else</span> {
<a name="l00146"></a>00146             <span class="keywordflow">throw</span> FormatError(<span class="stringliteral">"unsupported ELF word size"</span>);
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (extra_size&gt;0)
<a name="l00149"></a>00149             entry-&gt;get_extra() = <a class="code" href="classSgAsmGenericSection.html#d28198dd7017a9d5f40f63890152de1e">read_content_local_ucl</a>(i*entry_size+struct_size, extra_size);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="comment">/* Set name */</span>
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (entry-&gt;get_d_tag()==<a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f5fa72b945142e033fc90cf148a5701f4">SgAsmElfDynamicEntry::DT_NEEDED</a>) {
<a name="l00153"></a>00153             ROSE_ASSERT(entry-&gt;get_name()==NULL);
<a name="l00154"></a>00154             <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a> *name = <span class="keyword">new</span> <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a>(strsec-&gt;<a class="code" href="classSgAsmElfStringSection.html#8b3438dd540f7aeb4dc27226f4eb9a07">get_strtab</a>(), entry-&gt;get_d_val().get_rva());
<a name="l00155"></a>00155             entry-&gt;set_name(name);
<a name="l00156"></a>00156             name-&gt;<a class="code" href="classSgNode.html#83017efa378d75b031330739c963749d">set_parent</a>(entry);
<a name="l00157"></a>00157 <span class="preprocessor">#if 1       </span><span class="comment">/* FIXME: Do we really want this stuff duplicated in the AST? [RPM 2008-12-12] */</span>
<a name="l00158"></a>00158             <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a> *name2 = <span class="keyword">new</span> <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a>(strsec-&gt;<a class="code" href="classSgAsmElfStringSection.html#8b3438dd540f7aeb4dc27226f4eb9a07">get_strtab</a>(), entry-&gt;get_d_val().get_rva());
<a name="l00159"></a>00159             fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#d95455ca65afdb0a5b8af2c04bb8f709">add_dll</a>(<span class="keyword">new</span> <a class="code" href="classSgAsmGenericDLL.html">SgAsmGenericDLL</a>(name2));
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>        }
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163     <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00167"></a>00167 <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a>
<a name="l00168"></a><a class="code" href="classSgAsmElfDynamicSection.html#850fce8532821a96b809681aed0e41b3">00168</a> <a class="code" href="classSgAsmElfDynamicSection.html#850fce8532821a96b809681aed0e41b3">SgAsmElfDynamicSection::calculate_sizes</a>(size_t *entsize, size_t *required, size_t *optional, size_t *entcount)<span class="keyword"> const</span>
<a name="l00169"></a>00169 <span class="keyword"></span>{
<a name="l00170"></a>00170     std::vector&lt;size_t&gt; extra_sizes;
<a name="l00171"></a>00171     <span class="keywordflow">for</span> (size_t i=0; i&lt;<a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().size(); i++)
<a name="l00172"></a>00172         extra_sizes.push_back(<a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>()[i]-&gt;get_extra().size());
<a name="l00173"></a>00173     <span class="keywordflow">return</span> <a class="code" href="classSgAsmElfDynamicSection.html#850fce8532821a96b809681aed0e41b3">calculate_sizes</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSgAsmElfDynamicEntry_1_1Elf32DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf32DynamicEntry_disk</a>),
<a name="l00174"></a>00174                            <span class="keyword">sizeof</span>(<a class="code" href="structSgAsmElfDynamicEntry_1_1Elf64DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf64DynamicEntry_disk</a>),
<a name="l00175"></a>00175                            extra_sizes,
<a name="l00176"></a>00176                            entsize, required, optional, entcount);
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178     
<a name="l00180"></a>00180 <span class="keywordtype">void</span>
<a name="l00181"></a><a class="code" href="classSgAsmElfDynamicSection.html#3001a47e08749626c87bda6834fdc603">00181</a> <a class="code" href="classSgAsmElfDynamicSection.html#3001a47e08749626c87bda6834fdc603">SgAsmElfDynamicSection::finish_parsing</a>() 
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183     <a class="code" href="classSgAsmElfFileHeader.html">SgAsmElfFileHeader</a> *fhdr = <a class="code" href="classSgAsmElfSection.html#a430cf4e1e6376e12f3b5dc8363099c4">get_elf_header</a>();
<a name="l00184"></a>00184     ROSE_ASSERT(fhdr!=NULL);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keywordflow">for</span> (size_t i=0; i&lt;<a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().size(); i++) {
<a name="l00187"></a>00187         <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a> *entry = <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>()[i];
<a name="l00188"></a>00188         <span class="keywordflow">switch</span> (entry-&gt;get_d_tag()) {
<a name="l00189"></a>00189           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f5fa72b945142e033fc90cf148a5701f4">SgAsmElfDynamicEntry::DT_NEEDED</a>:
<a name="l00190"></a>00190             <span class="keywordflow">break</span>;
<a name="l00191"></a>00191           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f35cb039d6f36c87503f26c2bdcd8c25d">SgAsmElfDynamicEntry::DT_PLTGOT</a>:
<a name="l00192"></a>00192           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f27a84fdd5ae67f547318c14ac2aca588">SgAsmElfDynamicEntry::DT_HASH</a>:
<a name="l00193"></a>00193           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f717ebbf417d71802158f8fc3e59b26f0">SgAsmElfDynamicEntry::DT_STRTAB</a>:
<a name="l00194"></a>00194           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fccb0acbe74c7057c1c74c759c3033cf0">SgAsmElfDynamicEntry::DT_SYMTAB</a>:
<a name="l00195"></a>00195           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f95f3fb54a405ee1c79ed522b5fb7d50f">SgAsmElfDynamicEntry::DT_RELA</a>:
<a name="l00196"></a>00196           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f389add914f0f669f7c210053e03ff1c8">SgAsmElfDynamicEntry::DT_INIT</a>:
<a name="l00197"></a>00197           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f92ec039dee74917f8b157f5b2a9c03e7">SgAsmElfDynamicEntry::DT_FINI</a>:
<a name="l00198"></a>00198           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f7e60cf4951f378c53ad3d8fef571d498">SgAsmElfDynamicEntry::DT_REL</a>:
<a name="l00199"></a>00199           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f741b97ba847cc37a2cac0b441b27acf6">SgAsmElfDynamicEntry::DT_DEBUG</a>:
<a name="l00200"></a>00200           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fe428701a1b0ad4a4e262ce3bd7de920f">SgAsmElfDynamicEntry::DT_JMPREL</a>:
<a name="l00201"></a>00201           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f9bebec7f862508918b820e995225b453">SgAsmElfDynamicEntry::DT_INIT_ARRAY</a>:
<a name="l00202"></a>00202           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f236911738b337fd6d8d78e87a1241ff1">SgAsmElfDynamicEntry::DT_FINI_ARRAY</a>:
<a name="l00203"></a>00203           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f0b79e28fc3c7d6a4c3904d0a101bcf89">SgAsmElfDynamicEntry::DT_PREINIT_ARRAY</a>:
<a name="l00204"></a>00204           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fe1a7bb952c7753e6beb4112f08e83c3d">SgAsmElfDynamicEntry::DT_GNU_HASH</a>:
<a name="l00205"></a>00205           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fb327c2e2e39e45132b796da9f5d3ca35">SgAsmElfDynamicEntry::DT_TLSDESC_PLT</a>:
<a name="l00206"></a>00206           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f108b23d4c86b0d1fe87dad242020aa42">SgAsmElfDynamicEntry::DT_TLSDESC_GOT</a>:
<a name="l00207"></a>00207           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f0d18febb62fc62d0c3118b5ac01ee1ad">SgAsmElfDynamicEntry::DT_GNU_CONFLICT</a>:
<a name="l00208"></a>00208           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f3c2414fbd7a0be8c8b0e079028c652a2">SgAsmElfDynamicEntry::DT_GNU_LIBLIST</a>:
<a name="l00209"></a>00209           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f33f54af021a031efead562c37b2f8861">SgAsmElfDynamicEntry::DT_CONFIG</a>:
<a name="l00210"></a>00210           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f5e704f135a331ef1b301c093ee522a52">SgAsmElfDynamicEntry::DT_DEPAUDIT</a>:
<a name="l00211"></a>00211           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fd1195af89eb08c9fcd0f459807e5abe3">SgAsmElfDynamicEntry::DT_AUDIT</a>:
<a name="l00212"></a>00212           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fe21c3e869c6416822c83c0ec0685e08d">SgAsmElfDynamicEntry::DT_PLTPAD</a>:
<a name="l00213"></a>00213           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f38d8d5650150734bc3463715cd454e76">SgAsmElfDynamicEntry::DT_MOVETAB</a>:
<a name="l00214"></a>00214           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fcbfbe7a001b6431cb388c766f421e0cf">SgAsmElfDynamicEntry::DT_SYMINFO</a>:
<a name="l00215"></a>00215           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fcf575ecefdb1899fdeb8f1ea372ef82a">SgAsmElfDynamicEntry::DT_VERSYM</a>:
<a name="l00216"></a>00216           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f0be676fb2cd919771e174984f3818277">SgAsmElfDynamicEntry::DT_VERDEF</a>:
<a name="l00217"></a>00217           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27fbe81af1c870d9ac56e8d1c4da827ffcf">SgAsmElfDynamicEntry::DT_VERNEED</a>:
<a name="l00218"></a>00218           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f4117af56020f5edd4ec5454a91296d90">SgAsmElfDynamicEntry::DT_AUXILIARY</a>:
<a name="l00219"></a>00219           <span class="keywordflow">case</span> <a class="code" href="classSgAsmElfDynamicEntry.html#4ecc9770f8dd6b8a85b401313f23c27f37b1630342fa9dab9c237dcea5dd3401">SgAsmElfDynamicEntry::DT_FILTER</a>: {
<a name="l00220"></a>00220               <span class="comment">/* d_val is relative to a section. We know that all ELF Sections (but perhaps not the ELF Segments) have been</span>
<a name="l00221"></a>00221 <span class="comment">               * created by this time. */</span>
<a name="l00222"></a>00222               ROSE_ASSERT(entry-&gt;get_d_val().get_section()==NULL);
<a name="l00223"></a>00223               <a class="code" href="Cxx__Grammar_8h.html#af7ee9051414ea5a9e6e9697fe2cc6e2">SgAsmGenericSectionPtrList</a> containers = fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#8d593aec9ce07a73dff9db9b4bc1454e">get_sections_by_rva</a>(entry-&gt;get_d_val().get_rva());
<a name="l00224"></a>00224               <a class="code" href="classSgAsmGenericSection.html">SgAsmGenericSection</a> *best = NULL;
<a name="l00225"></a>00225               <span class="keywordflow">for</span> (SgAsmGenericSectionPtrList::iterator i=containers.begin(); i!=containers.end(); ++i) {
<a name="l00226"></a>00226                   <span class="keywordflow">if</span> ((*i)-&gt;is_mapped()) {
<a name="l00227"></a>00227                       <span class="keywordflow">if</span> ((*i)-&gt;get_mapped_preferred_rva()==entry-&gt;get_d_val().get_rva()) {
<a name="l00228"></a>00228                           best = *i;
<a name="l00229"></a>00229                           <span class="keywordflow">break</span>;
<a name="l00230"></a>00230                       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!best) {
<a name="l00231"></a>00231                           best = *i;
<a name="l00232"></a>00232                       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*i)-&gt;get_mapped_size() &lt; best-&gt;<a class="code" href="classSgAsmGenericSection.html#8d1fa091242ab088e3cbe50d87fc25ba">get_mapped_size</a>()) {
<a name="l00233"></a>00233                           best = *i;
<a name="l00234"></a>00234                       }
<a name="l00235"></a>00235                   }
<a name="l00236"></a>00236               }
<a name="l00237"></a>00237               <span class="keywordflow">if</span> (best)
<a name="l00238"></a>00238                   entry-&gt;set_d_val(<a class="code" href="classrose__rva__t.html">rose_rva_t</a>(entry-&gt;get_d_val().get_rva(), best));
<a name="l00239"></a>00239               <span class="keywordflow">break</span>;
<a name="l00240"></a>00240           }
<a name="l00241"></a>00241           <span class="keywordflow">default</span>:
<a name="l00242"></a>00242             <span class="keywordflow">break</span>;
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00248"></a>00248 <span class="keywordtype">bool</span>
<a name="l00249"></a><a class="code" href="classSgAsmElfDynamicSection.html#f058c70bdabc4ab70cc7a1c2e539ae6e">00249</a> <a class="code" href="classSgAsmElfDynamicSection.html#f058c70bdabc4ab70cc7a1c2e539ae6e">SgAsmElfDynamicSection::reallocate</a>()
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <span class="keywordtype">bool</span> reallocated = <a class="code" href="classSgAsmElfSection.html#7706eaa9b1da9c2e5e7572b212e8eab9">SgAsmElfSection::reallocate</a>();
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <span class="comment">/* Update parts of the section and segment tables not updated by superclass */</span>
<a name="l00254"></a>00254     <a class="code" href="classSgAsmElfSectionTableEntry.html">SgAsmElfSectionTableEntry</a> *secent = <a class="code" href="classSgAsmElfSection.html#9ef7cc77be330cde6c32ef598e312971">get_section_entry</a>();
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (secent)
<a name="l00256"></a>00256         secent-&gt;<a class="code" href="classSgAsmElfSectionTableEntry.html#0760b39b83ede2bd4ba2f8844a488ea1">set_sh_type</a>(<a class="code" href="classSgAsmElfSectionTableEntry.html#eaa4750140522e9def9682c109c2ba1447043eaefb2c73aa7581a5df36aad9cb">SgAsmElfSectionTableEntry::SHT_DYNAMIC</a>);
<a name="l00257"></a>00257     <a class="code" href="classSgAsmElfSegmentTableEntry.html">SgAsmElfSegmentTableEntry</a> *segent = <a class="code" href="classSgAsmElfSection.html#c3f3608966ef3fb0a272a6e04c6e4e29">get_segment_entry</a>();
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (segent)
<a name="l00259"></a>00259         segent-&gt;<a class="code" href="classSgAsmElfSegmentTableEntry.html#f4c2ab4e78af37088d1a3ae6a6c33d63">set_type</a>(<a class="code" href="classSgAsmElfSegmentTableEntry.html#8e2b4156c6e414387854aab54d6727a7a293fa80dd1efaef8f6ad376e911d0af">SgAsmElfSegmentTableEntry::PT_DYNAMIC</a>);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="comment">/* Update entries with name offsets. The name should point to the string table to which the dynamic section links. */</span>
<a name="l00262"></a>00262     <span class="keywordflow">for</span> (size_t i=0; i&lt;<a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().size(); i++) {
<a name="l00263"></a>00263         <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a> *entry = <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>()[i];
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (entry-&gt;get_name()) {
<a name="l00265"></a>00265             <a class="code" href="classSgAsmElfStringSection.html">SgAsmElfStringSection</a> *strsec = dynamic_cast&lt;SgAsmElfStringSection*&gt;(<a class="code" href="classSgAsmElfSection.html#44bf34de24ece59722ba6a9b3861e0cb">get_linked_section</a>());
<a name="l00266"></a>00266             ROSE_ASSERT(strsec);
<a name="l00267"></a>00267             <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a> *stored_string = dynamic_cast&lt;SgAsmStoredString*&gt;(entry-&gt;get_name());
<a name="l00268"></a>00268             <span class="keywordflow">if</span> (!stored_string || stored_string-&gt;<a class="code" href="classSgAsmStoredString.html#74394a337215bcfec0a4f8cdba23c272">get_strtab</a>()!=strsec-&gt;get_strtab()) {
<a name="l00269"></a>00269                 <span class="comment">/* Not a stored string, or stored in the wrong string table. */</span>
<a name="l00270"></a>00270                 stored_string = <span class="keyword">new</span> <a class="code" href="classSgAsmStoredString.html">SgAsmStoredString</a>(strsec-&gt;get_strtab(), entry-&gt;get_name()-&gt;get_string());
<a name="l00271"></a>00271                 entry-&gt;get_name()-&gt;<a class="code" href="classSgAsmStoredString.html#2ba1b5ac080348f33e7748e140ff4c3a">set_string</a>(<span class="stringliteral">""</span>); <span class="comment">/*free old storage*/</span>
<a name="l00272"></a>00272                 entry-&gt;set_name(stored_string);
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274             entry-&gt;set_d_val(entry-&gt;get_name()-&gt;get_offset());
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277     
<a name="l00278"></a>00278     <span class="keywordflow">return</span> reallocated;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00282"></a>00282 <span class="keywordtype">void</span>
<a name="l00283"></a><a class="code" href="classSgAsmElfDynamicSection.html#bcbfc2034f21a5242a9942af66170d77">00283</a> <a class="code" href="classSgAsmElfDynamicSection.html#bcbfc2034f21a5242a9942af66170d77">SgAsmElfDynamicSection::unparse</a>(std::ostream &amp;f)<span class="keyword"> const</span>
<a name="l00284"></a>00284 <span class="keyword"></span>{
<a name="l00285"></a>00285     <a class="code" href="classSgAsmElfFileHeader.html">SgAsmElfFileHeader</a> *fhdr = <a class="code" href="classSgAsmElfSection.html#a430cf4e1e6376e12f3b5dc8363099c4">get_elf_header</a>();
<a name="l00286"></a>00286     ROSE_ASSERT(fhdr);
<a name="l00287"></a>00287     <a class="code" href="classSgAsmExecutableFileFormat.html#9f34e9e7666815ddeee9be5df5573a80">ByteOrder</a> sex = fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#3269e8ea6c30182607e9d4ee79fc05a8">get_sex</a>();
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     size_t entry_size, struct_size, extra_size, nentries;
<a name="l00290"></a>00290     <a class="code" href="classSgAsmElfDynamicSection.html#850fce8532821a96b809681aed0e41b3">calculate_sizes</a>(&amp;entry_size, &amp;struct_size, &amp;extra_size, &amp;nentries);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">/* Adjust the entry size stored in the ELF Section Table */</span>
<a name="l00293"></a>00293     <a class="code" href="classSgAsmElfSection.html#9ef7cc77be330cde6c32ef598e312971">get_section_entry</a>()-&gt;<a class="code" href="classSgAsmElfSectionTableEntry.html#d4f8b40b80fd40a7ce026db601e85911">set_sh_entsize</a>(entry_size);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="comment">/* Write each entry's required part followed by the optional part */</span>
<a name="l00296"></a>00296     <span class="keywordflow">for</span> (size_t i=0; i&lt;nentries; i++) {
<a name="l00297"></a>00297         <a class="code" href="structSgAsmElfDynamicEntry_1_1Elf32DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf32DynamicEntry_disk</a> disk32;
<a name="l00298"></a>00298         <a class="code" href="structSgAsmElfDynamicEntry_1_1Elf64DynamicEntry__disk.html">SgAsmElfDynamicEntry::Elf64DynamicEntry_disk</a> disk64;
<a name="l00299"></a>00299         <span class="keywordtype">void</span> *disk  = NULL;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a> *entry = <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>()[i];
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="keywordflow">if</span> (4==fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#23c52f8b2a00e850095a3454f91db39c">get_word_size</a>()) {
<a name="l00304"></a>00304             disk = entry-&gt;<a class="code" href="classSgAsmElfDynamicEntry.html#247b2a1d255c0115bb9be87b475cf8a9">encode</a>(sex, &amp;disk32);
<a name="l00305"></a>00305         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (8==fhdr-&gt;<a class="code" href="classSgAsmGenericHeader.html#23c52f8b2a00e850095a3454f91db39c">get_word_size</a>()) {
<a name="l00306"></a>00306             disk = entry-&gt;<a class="code" href="classSgAsmElfDynamicEntry.html#247b2a1d255c0115bb9be87b475cf8a9">encode</a>(sex, &amp;disk64);
<a name="l00307"></a>00307         } <span class="keywordflow">else</span> {
<a name="l00308"></a>00308             ROSE_ASSERT(!<span class="stringliteral">"unsupported word size"</span>);
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <a class="code" href="rosedefs_8h.html#03b4aab6bc70ede394422915678b18df">rose_addr_t</a> spos = i * entry_size;
<a name="l00312"></a>00312         spos = <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, struct_size, disk);
<a name="l00313"></a>00313         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="classSgAsmElfDynamicEntry.html#5b2402c487b0d9948dee8e87620fe8e7">get_extra</a>().size()&gt;0) {
<a name="l00314"></a>00314             ROSE_ASSERT(entry-&gt;<a class="code" href="classSgAsmElfDynamicEntry.html#5b2402c487b0d9948dee8e87620fe8e7">get_extra</a>().size()&lt;=extra_size);
<a name="l00315"></a>00315             <a class="code" href="classSgAsmGenericSection.html#8e0601bfbe531ff8973c2458543aaad6">write</a>(f, spos, entry-&gt;<a class="code" href="classSgAsmElfDynamicEntry.html#5b2402c487b0d9948dee8e87620fe8e7">get_extra</a>());
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <a class="code" href="classSgAsmGenericSection.html#5093c3cf64be87688030517c67370dae">unparse_holes</a>(f);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00323"></a>00323 <span class="keywordtype">void</span>
<a name="l00324"></a><a class="code" href="classSgAsmElfDynamicSection.html#b0d68c4a0118992d88788fa7628f8dfa">00324</a> <a class="code" href="classSgAsmElfDynamicSection.html#b0d68c4a0118992d88788fa7628f8dfa">SgAsmElfDynamicSection::dump</a>(FILE *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="SgUnaryOp_8docs.html#c6cf1576467b95ef29f025f8e47eea437afa939f8bd773f5f7e326990b07580c">prefix</a>, ssize_t idx)<span class="keyword"> const</span>
<a name="l00325"></a>00325 <span class="keyword"></span>{
<a name="l00326"></a>00326     <span class="keywordtype">char</span> p[4096];
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (idx&gt;=0) {
<a name="l00328"></a>00328         sprintf(p, <span class="stringliteral">"%sDynamicSection[%zd]."</span>, prefix, idx);
<a name="l00329"></a>00329     } <span class="keywordflow">else</span> {
<a name="l00330"></a>00330         sprintf(p, <span class="stringliteral">"%sDynamicSection."</span>, prefix);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <a class="code" href="classSgAsmElfSection.html#4fd8ef83c67a6b432974fab51f4122b7">SgAsmElfSection::dump</a>(f, p, -1);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">for</span> (size_t i=0; i&lt;<a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>().size(); i++) {
<a name="l00336"></a>00336         <a class="code" href="classSgAsmElfDynamicEntry.html">SgAsmElfDynamicEntry</a> *ent = <a class="code" href="classSgAsmElfDynamicSection.html#aa5c6b95f650e7534823be010b8f408d">p_entries</a>-&gt;<a class="code" href="classSgAsmElfDynamicEntryList.html#7ad77deaa74b2fa48fa105ed3eda36c2">get_entries</a>()[i];
<a name="l00337"></a>00337         ent-&gt;dump(f, p, i);
<a name="l00338"></a>00338         <a class="code" href="classSgAsmGenericSection.html#bc5de7522e1e2471a4962d4a1b7ae92f">dump_containing_sections</a>(f, std::string(p)+<span class="stringliteral">"..."</span>, ent-&gt;get_d_val(), <a class="code" href="classSgAsmGenericSection.html#92d6a3666a5f729199df4349729c19ff">get_header</a>()-&gt;<a class="code" href="classSgAsmGenericHeader.html#5cefae0c9db1832cd75642799bc33762">get_sections</a>()-&gt;<a class="code" href="classSgAsmGenericSectionList.html#239d407e4df928777b992e8fdfc6e685">get_sections</a>());
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (<a class="code" href="classSgAsmElfDynamicSection.html#b06fd69a98aaf2f100bf3e437d08a565">variantT</a>() == <a class="code" href="Cxx__Grammar_8h.html#adcb00b11de1167a498bced81d3e346468872d8943f6997b9331d865d7e8e887">V_SgAsmElfDynamicSection</a>) <span class="comment">//unless a base class</span>
<a name="l00342"></a>00342         <a class="code" href="classSgAsmExecutableFileFormat.html#548279193ba7eec2ae9ff2419c9e4d62">hexdump</a>(f, 0, std::string(p)+<span class="stringliteral">"data at "</span>, <a class="code" href="classSgAsmGenericSection.html#96573fffe8f4f825c56ead24cc89a474">p_data</a>);
<a name="l00343"></a>00343 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 20 Jan 2013 for ROSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
